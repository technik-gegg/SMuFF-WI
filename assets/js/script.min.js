window.innerWidth<768&&[].slice.call(document.querySelectorAll("[data-bss-disabled-mobile]")).forEach((function(e){e.classList.remove("animated"),e.removeAttribute("data-bss-hover-animate"),e.removeAttribute("data-aos")})),document.addEventListener("DOMContentLoaded",(function(){[].slice.call(document.querySelectorAll("[data-bss-tooltip]")).map((function(e){return new bootstrap.Tooltip(e)}));var e=document.querySelectorAll('[data-bs-toggle="toast"]');for(var t of e)t.addEventListener("click",(function(){var e=t.getAttribute("data-bs-target");if(e)try{var a=document.querySelector(e);if(!a)return;new bootstrap.Toast(a).show()}catch(e){console.error(e)}}));var a=document.querySelectorAll("[data-bss-chart]");for(var n of a)n.chart=new Chart(n,JSON.parse(n.dataset.bssChart))}),!1),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Sortable=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function a(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){var n,o,i;n=e,i=a[o=t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i}))}return e}function n(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],0<=t.indexOf(a)||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],0<=t.indexOf(a)||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var r=i(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),s=i(/Edge/i),l=i(/firefox/i),c=i(/safari/i)&&!i(/chrome/i)&&!i(/android/i),d=i(/iP(ad|od|hone)/i),u=i(/chrome/i)&&i(/android/i),p={capture:!1,passive:!1};function h(e,t,a){e.addEventListener(t,a,!r&&p)}function f(e,t,a){e.removeEventListener(t,a,!r&&p)}function g(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function m(e,t,a,n){if(e){a=a||document;do{if(null!=t&&(">"===t[0]?e.parentNode===a&&g(e,t):g(e,t))||n&&e===a)return e;if(e===a)break}while(e=(o=e).host&&o!==document&&o.host.nodeType?o.host:o.parentNode)}var o;return null}var v,b=/\s+/g;function $(e,t,a){if(e&&t)if(e.classList)e.classList[a?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(b," ").replace(" "+t+" "," ");e.className=(n+(a?" "+t:"")).replace(b," ")}}function w(e,t,a){var n=e&&e.style;if(n){if(void 0===a)return document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(a=e.currentStyle),void 0===t?a:a[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=a+("string"==typeof a?"":"px")}}function S(e,t){var a="";if("string"==typeof e)a=e;else do{var n=w(e,"transform");n&&"none"!==n&&(a=n+" "+a)}while(!t&&(e=e.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(a)}function y(e,t,a){if(e){var n=e.getElementsByTagName(t),o=0,i=n.length;if(a)for(;o<i;o++)a(n[o],o);return n}return[]}function C(){return document.scrollingElement||document.documentElement}function D(e,t,a,n,o){if(e.getBoundingClientRect||e===window){var i,s,l,c,d,u,p;if(p=e!==window&&e.parentNode&&e!==C()?(s=(i=e.getBoundingClientRect()).top,l=i.left,c=i.bottom,d=i.right,u=i.height,i.width):(l=s=0,c=window.innerHeight,d=window.innerWidth,u=window.innerHeight,window.innerWidth),(t||a)&&e!==window&&(o=o||e.parentNode,!r))do{if(o&&o.getBoundingClientRect&&("none"!==w(o,"transform")||a&&"static"!==w(o,"position"))){var h=o.getBoundingClientRect();s-=h.top+parseInt(w(o,"border-top-width")),l-=h.left+parseInt(w(o,"border-left-width")),c=s+i.height,d=l+i.width;break}}while(o=o.parentNode);if(n&&e!==window){var f=S(o||e),g=f&&f.a,m=f&&f.d;f&&(c=(s/=m)+(u/=m),d=(l/=g)+(p/=g))}return{top:s,left:l,bottom:c,right:d,width:p,height:u}}}function k(e,t,a){for(var n=I(e,!0),o=D(e)[t];n;){var i=D(n)[a];if(!("top"===a||"left"===a?i<=o:o<=i))return n;if(n===C())break;n=I(n,!1)}return!1}function T(e,t,a){for(var n=0,o=0,i=e.children;o<i.length;){if("none"!==i[o].style.display&&i[o]!==We.ghost&&i[o]!==We.dragged&&m(i[o],a.draggable,e,!1)){if(n===t)return i[o];n++}o++}return null}function x(e,t){for(var a=e.lastElementChild;a&&(a===We.ghost||"none"===w(a,"display")||t&&!g(a,t));)a=a.previousElementSibling;return a||null}function M(e,t){var a=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===We.clone||t&&!g(e,t)||a++;return a}function E(e){var t=0,a=0,n=C();if(e)do{var o=S(e),i=o.a,r=o.d;t+=e.scrollLeft*i,a+=e.scrollTop*r}while(e!==n&&(e=e.parentNode));return[t,a]}function I(e,t){if(!e||!e.getBoundingClientRect)return C();var a=e,n=!1;do{if(a.clientWidth<a.scrollWidth||a.clientHeight<a.scrollHeight){var o=w(a);if(a.clientWidth<a.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||a.clientHeight<a.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!a.getBoundingClientRect||a===document.body)return C();if(n||t)return a;n=!0}}}while(a=a.parentNode);return C()}function F(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function O(e,t){return function(){if(!v){var a=arguments;1===a.length?e.call(this,a[0]):e.apply(this,a),v=setTimeout((function(){v=void 0}),t)}}}function P(e,t,a){e.scrollLeft+=t,e.scrollTop+=a}function W(e){var t=window.Polymer,a=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):a?a(e).clone(!0)[0]:e.cloneNode(!0)}function N(e,t){w(e,"position","absolute"),w(e,"top",t.top),w(e,"left",t.left),w(e,"width",t.width),w(e,"height",t.height)}function A(e){w(e,"position",""),w(e,"top",""),w(e,"left",""),w(e,"width",""),w(e,"height","")}var R="Sortable"+(new Date).getTime();var _=[],L={initializeByDefault:!0},z={mount:function(e){for(var t in L)!L.hasOwnProperty(t)||t in e||(e[t]=L[t]);_.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),_.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var i=e+"Global";_.forEach((function(o){t[o.pluginName]&&(t[o.pluginName][i]&&t[o.pluginName][i](a({sortable:t},n)),t.options[o.pluginName]&&t[o.pluginName][e]&&t[o.pluginName][e](a({sortable:t},n)))}))},initializePlugins:function(e,a,n,o){for(var i in _.forEach((function(o){var i=o.pluginName;if(e.options[i]||o.initializeByDefault){var r=new o(e,a,e.options);r.sortable=e,r.options=e.options,e[i]=r,t(n,r.defaults)}})),e.options)if(e.options.hasOwnProperty(i)){var r=this.modifyOption(e,i,e.options[i]);void 0!==r&&(e.options[i]=r)}},getEventProperties:function(e,a){var n={};return _.forEach((function(o){"function"==typeof o.eventProperties&&t(n,o.eventProperties.call(a[o.pluginName],e))})),n},modifyOption:function(e,t,a){var n;return _.forEach((function(o){e[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[t]&&(n=o.optionListeners[t].call(e[o.pluginName],a))})),n}};function U(e){var t=e.sortable,n=e.rootEl,o=e.name,i=e.targetEl,l=e.cloneEl,c=e.toEl,d=e.fromEl,u=e.oldIndex,p=e.newIndex,h=e.oldDraggableIndex,f=e.newDraggableIndex,g=e.originalEvent,m=e.putSortable,v=e.extraEventProperties;if(t=t||n&&n[R]){var b,$=t.options,w="on"+o.charAt(0).toUpperCase()+o.substr(1);!window.CustomEvent||r||s?(b=document.createEvent("Event")).initEvent(o,!0,!0):b=new CustomEvent(o,{bubbles:!0,cancelable:!0}),b.to=c||n,b.from=d||n,b.item=i||n,b.clone=l,b.oldIndex=u,b.newIndex=p,b.oldDraggableIndex=h,b.newDraggableIndex=f,b.originalEvent=g,b.pullMode=m?m.lastPutMode:void 0;var S=a({},v,z.getEventProperties(o,t));for(var y in S)b[y]=S[y];n&&n.dispatchEvent(b),$[w]&&$[w].call(t,b)}}function B(e,t,o){var i=2<arguments.length&&void 0!==o?o:{},r=i.evt,s=n(i,["evt"]);z.pluginEvent.bind(We)(e,t,a({dragEl:H,parentEl:V,ghostEl:X,rootEl:q,nextEl:Y,lastDownEl:J,cloneEl:j,cloneHidden:K,dragStarted:de,putSortable:ne,activeSortable:We.active,originalEvent:r,oldIndex:Z,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te,hideGhostForTarget:Ie,unhideGhostForTarget:Fe,cloneNowHidden:function(){K=!0},cloneNowShown:function(){K=!1},dispatchSortableEvent:function(e){G({sortable:t,name:e,originalEvent:r})}},s))}function G(e){U(a({putSortable:ne,cloneEl:j,targetEl:H,rootEl:q,oldIndex:Z,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te},e))}var H,V,X,q,Y,J,j,K,Z,Q,ee,te,ae,ne,oe,ie,re,se,le,ce,de,ue,pe,he,fe,ge=!1,me=!1,ve=[],be=!1,$e=!1,we=[],Se=!1,ye=[],Ce="undefined"!=typeof document,De=d,ke=s||r?"cssFloat":"float",Te=Ce&&!u&&!d&&"draggable"in document.createElement("div"),xe=function(){if(Ce){if(r)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Me=function(e,t){var a=w(e),n=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),o=T(e,0,t),i=T(e,1,t),r=o&&w(o),s=i&&w(i),l=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+D(o).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+D(i).width;if("flex"===a.display)return"column"===a.flexDirection||"column-reverse"===a.flexDirection?"vertical":"horizontal";if("grid"===a.display)return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&r.float&&"none"!==r.float){var d="left"===r.float?"left":"right";return!i||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return o&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||n<=l&&"none"===a[ke]||i&&"none"===a[ke]&&n<l+c)?"vertical":"horizontal"},Ee=function(t){function a(e,t){return function(n,o,i,r){var s=n.options.group.name&&o.options.group.name&&n.options.group.name===o.options.group.name;if(null==e&&(t||s))return!0;if(null==e||!1===e)return!1;if(t&&"clone"===e)return e;if("function"==typeof e)return a(e(n,o,i,r),t)(n,o,i,r);var l=(t?n:o).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&-1<e.indexOf(l)}}var n={},o=t.group;o&&"object"==e(o)||(o={name:o}),n.name=o.name,n.checkPull=a(o.pull,!0),n.checkPut=a(o.put),n.revertClone=o.revertClone,t.group=n},Ie=function(){!xe&&X&&w(X,"display","none")},Fe=function(){!xe&&X&&w(X,"display","")};function Oe(e){if(H){var t=function(e,t){var a;return ve.some((function(n){if(!x(n)){var o=D(n),i=n[R].options.emptyInsertThreshold,r=e>=o.left-i&&e<=o.right+i,s=t>=o.top-i&&t<=o.bottom+i;return i&&r&&s?a=n:void 0}})),a}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);a.target=a.rootEl=t,a.preventDefault=void 0,a.stopPropagation=void 0,t[R]._onDragOver(a)}}}function Pe(e){H&&H.parentNode[R]._isOutsideThisEl(e.target)}function We(e,n){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=n=t({},n),e[R]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Me(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==We.supportPointer&&"PointerEvent"in window&&!c,emptyInsertThreshold:5};for(var i in z.initializePlugins(this,e,o),o)i in n||(n[i]=o[i]);for(var r in Ee(n),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!n.forceFallback&&Te,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?h(e,"pointerdown",this._onTapStart):(h(e,"mousedown",this._onTapStart),h(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(h(e,"dragover",this),h(e,"dragenter",this)),ve.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),t(this,function(){var e,t=[];return{captureAnimationState:function(){t=[],this.options.animation&&[].slice.call(this.el.children).forEach((function(e){if("none"!==w(e,"display")&&e!==We.ghost){t.push({target:e,rect:D(e)});var n=a({},t[t.length-1].rect);if(e.thisAnimationDuration){var o=S(e,!0);o&&(n.top-=o.f,n.left-=o.e)}e.fromRect=n}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var a in e)if(e.hasOwnProperty(a))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[a][n])return Number(a);return-1}(t,{target:e}),1)},animateAll:function(a){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof a&&a());var o=!1,i=0;t.forEach((function(e){var t=0,a=e.target,r=a.fromRect,s=D(a),l=a.prevFromRect,c=a.prevToRect,d=e.rect,u=S(a,!0);u&&(s.top-=u.f,s.left-=u.e),a.toRect=s,a.thisAnimationDuration&&F(l,s)&&!F(r,s)&&(d.top-s.top)/(d.left-s.left)==(r.top-s.top)/(r.left-s.left)&&(t=function(e,t,a,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-a.top,2)+Math.pow(t.left-a.left,2))*n.animation}(d,l,c,n.options)),F(s,r)||(a.prevFromRect=r,a.prevToRect=s,t||(t=n.options.animation),n.animate(a,d,s,t)),t&&(o=!0,i=Math.max(i,t),clearTimeout(a.animationResetTimer),a.animationResetTimer=setTimeout((function(){a.animationTime=0,a.prevFromRect=null,a.fromRect=null,a.prevToRect=null,a.thisAnimationDuration=null}),t),a.thisAnimationDuration=t)})),clearTimeout(e),o?e=setTimeout((function(){"function"==typeof a&&a()}),i):"function"==typeof a&&a(),t=[]},animate:function(e,t,a,n){if(n){w(e,"transition",""),w(e,"transform","");var o=S(this.el),i=o&&o.a,r=o&&o.d,s=(t.left-a.left)/(i||1),l=(t.top-a.top)/(r||1);e.animatingX=!!s,e.animatingY=!!l,w(e,"transform","translate3d("+s+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),w(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),w(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){w(e,"transition",""),w(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),n)}}}}())}function Ne(e,t,a,n,o,i,l,c){var d,u,p=e[R],h=p.options.onMove;return!window.CustomEvent||r||s?(d=document.createEvent("Event")).initEvent("move",!0,!0):d=new CustomEvent("move",{bubbles:!0,cancelable:!0}),d.to=t,d.from=e,d.dragged=a,d.draggedRect=n,d.related=o||t,d.relatedRect=i||D(t),d.willInsertAfter=c,d.originalEvent=l,e.dispatchEvent(d),h&&(u=h.call(p,d,l)),u}function Ae(e){e.draggable=!1}function Re(){Se=!1}function _e(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,a=t.length,n=0;a--;)n+=t.charCodeAt(a);return n.toString(36)}function Le(e){return setTimeout(e,0)}function ze(e){return clearTimeout(e)}Ce&&document.addEventListener("click",(function(e){if(me)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),me=!1}),!0),We.prototype={constructor:We,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(ue=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,H):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,a=this.el,n=this.options,o=n.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,s=(r||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,d=n.filter;if(function(e){ye.length=0;for(var t=e.getElementsByTagName("input"),a=t.length;a--;){var n=t[a];n.checked&&ye.push(n)}}(a),!H&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||n.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!c||!s||"SELECT"!==s.tagName.toUpperCase())&&!((s=m(s,n.draggable,a,!1))&&s.animated||J===s)){if(Z=M(s),ee=M(s,n.draggable),"function"==typeof d){if(d.call(this,e,s,this))return G({sortable:t,rootEl:l,name:"filter",targetEl:s,toEl:a,fromEl:a}),B("filter",t,{evt:e}),void(o&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(n){if(n=m(l,n.trim(),a,!1))return G({sortable:t,rootEl:n,name:"filter",targetEl:s,fromEl:a,toEl:a}),B("filter",t,{evt:e}),!0}))))return void(o&&e.cancelable&&e.preventDefault());n.handle&&!m(l,n.handle,a,!1)||this._prepareDragStart(e,r,s)}}},_prepareDragStart:function(e,t,a){var n,o=this,i=o.el,c=o.options,d=i.ownerDocument;if(a&&!H&&a.parentNode===i){var u=D(a);if(q=i,V=(H=a).parentNode,Y=H.nextSibling,J=a,ae=c.group,oe={target:We.dragged=H,clientX:(t||e).clientX,clientY:(t||e).clientY},le=oe.clientX-u.left,ce=oe.clientY-u.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,H.style["will-change"]="all",n=function(){B("delayEnded",o,{evt:e}),We.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!l&&o.nativeDraggable&&(H.draggable=!0),o._triggerDragStart(e,t),G({sortable:o,name:"choose",originalEvent:e}),$(H,c.chosenClass,!0))},c.ignore.split(",").forEach((function(e){y(H,e.trim(),Ae)})),h(d,"dragover",Oe),h(d,"mousemove",Oe),h(d,"touchmove",Oe),h(d,"mouseup",o._onDrop),h(d,"touchend",o._onDrop),h(d,"touchcancel",o._onDrop),l&&this.nativeDraggable&&(this.options.touchStartThreshold=4,H.draggable=!0),B("delayStart",this,{evt:e}),!c.delay||c.delayOnTouchOnly&&!t||this.nativeDraggable&&(s||r))n();else{if(We.eventCanceled)return void this._onDrop();h(d,"mouseup",o._disableDelayedDrag),h(d,"touchend",o._disableDelayedDrag),h(d,"touchcancel",o._disableDelayedDrag),h(d,"mousemove",o._delayedDragTouchMoveHandler),h(d,"touchmove",o._delayedDragTouchMoveHandler),c.supportPointer&&h(d,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(n,c.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){H&&Ae(H),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;f(e,"mouseup",this._disableDelayedDrag),f(e,"touchend",this._disableDelayedDrag),f(e,"touchcancel",this._disableDelayedDrag),f(e,"mousemove",this._delayedDragTouchMoveHandler),f(e,"touchmove",this._delayedDragTouchMoveHandler),f(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?h(document,"pointermove",this._onTouchMove):h(document,t?"touchmove":"mousemove",this._onTouchMove):(h(H,"dragend",this),h(q,"dragstart",this._onDragStart));try{document.selection?Le((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(ge=!1,q&&H){B("dragStarted",this,{evt:t}),this.nativeDraggable&&h(document,"dragover",Pe);var a=this.options;e||$(H,a.dragClass,!1),$(H,a.ghostClass,!0),We.active=this,e&&this._appendGhost(),G({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ie){this._lastX=ie.clientX,this._lastY=ie.clientY,Ie();for(var e=document.elementFromPoint(ie.clientX,ie.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ie.clientX,ie.clientY))!==t;)t=e;if(H.parentNode[R]._isOutsideThisEl(e),t)do{if(t[R]&&t[R]._onDragOver({clientX:ie.clientX,clientY:ie.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;e=t}while(t=t.parentNode);Fe()}},_onTouchMove:function(e){if(oe){var t=this.options,a=t.fallbackTolerance,n=t.fallbackOffset,o=e.touches?e.touches[0]:e,i=X&&S(X,!0),r=X&&i&&i.a,s=X&&i&&i.d,l=De&&fe&&E(fe),c=(o.clientX-oe.clientX+n.x)/(r||1)+(l?l[0]-we[0]:0)/(r||1),d=(o.clientY-oe.clientY+n.y)/(s||1)+(l?l[1]-we[1]:0)/(s||1);if(!We.active&&!ge){if(a&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(X){i?(i.e+=c-(re||0),i.f+=d-(se||0)):i={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");w(X,"webkitTransform",u),w(X,"mozTransform",u),w(X,"msTransform",u),w(X,"transform",u),re=c,se=d,ie=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!X){var e=this.options.fallbackOnBody?document.body:q,t=D(H,!0,De,!0,e),a=this.options;if(De){for(fe=e;"static"===w(fe,"position")&&"none"===w(fe,"transform")&&fe!==document;)fe=fe.parentNode;fe!==document.body&&fe!==document.documentElement?(fe===document&&(fe=C()),t.top+=fe.scrollTop,t.left+=fe.scrollLeft):fe=C(),we=E(fe)}$(X=H.cloneNode(!0),a.ghostClass,!1),$(X,a.fallbackClass,!0),$(X,a.dragClass,!0),w(X,"transition",""),w(X,"transform",""),w(X,"box-sizing","border-box"),w(X,"margin",0),w(X,"top",t.top),w(X,"left",t.left),w(X,"width",t.width),w(X,"height",t.height),w(X,"opacity","0.8"),w(X,"position",De?"absolute":"fixed"),w(X,"zIndex","100000"),w(X,"pointerEvents","none"),We.ghost=X,e.appendChild(X),w(X,"transform-origin",le/parseInt(X.style.width)*100+"% "+ce/parseInt(X.style.height)*100+"%")}},_onDragStart:function(e,t){var a=this,n=e.dataTransfer,o=a.options;B("dragStart",this,{evt:e}),We.eventCanceled?this._onDrop():(B("setupClone",this),We.eventCanceled||((j=W(H)).draggable=!1,j.style["will-change"]="",this._hideClone(),$(j,this.options.chosenClass,!1),We.clone=j),a.cloneId=Le((function(){B("clone",a),We.eventCanceled||(a.options.removeCloneOnHide||q.insertBefore(j,H),a._hideClone(),G({sortable:a,name:"clone"}))})),t||$(H,o.dragClass,!0),t?(me=!0,a._loopId=setInterval(a._emulateDragOver,50)):(f(document,"mouseup",a._onDrop),f(document,"touchend",a._onDrop),f(document,"touchcancel",a._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(a,n,H)),h(document,"drop",a),w(H,"transform","translateZ(0)")),ge=!0,a._dragStartId=Le(a._dragStarted.bind(a,t,e)),h(document,"selectstart",a),de=!0,c&&w(document.body,"user-select","none"))},_onDragOver:function(e){var t,n,o,i,r=this.el,s=e.target,l=this.options,c=l.group,d=We.active,u=ae===c,p=l.sort,h=ne||d,f=this,g=!1;if(!Se){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=m(s,l.draggable,r,!0),_("dragOver"),We.eventCanceled)return g;if(H.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||f._ignoreWhileAnimating===s)return z(!1);if(me=!1,d&&!l.disabled&&(u?p||(o=!q.contains(H)):ne===this||(this.lastPutMode=ae.checkPull(this,d,H,e))&&c.checkPut(this,d,H,e))){if(i="vertical"===this._getDirection(e,s),t=D(H),_("dragOverValid"),We.eventCanceled)return g;if(o)return V=q,L(),this._hideClone(),_("revert"),We.eventCanceled||(Y?q.insertBefore(H,Y):q.appendChild(H)),z(!0);var v=x(r,l.draggable);if(!v||function(e,t,a){var n=D(x(a.el,a.options.draggable));return t?e.clientX>n.right+10||e.clientX<=n.right&&e.clientY>n.bottom&&e.clientX>=n.left:e.clientX>n.right&&e.clientY>n.top||e.clientX<=n.right&&e.clientY>n.bottom+10}(e,i,this)&&!v.animated){if(v===H)return z(!1);if(v&&r===e.target&&(s=v),s&&(n=D(s)),!1!==Ne(q,r,H,t,s,n,e,!!s))return L(),r.appendChild(H),V=r,U(),z(!0)}else if(s.parentNode===r){n=D(s);var b,S,y,C=H.parentNode!==r,T=!function(e,t,a){var n=a?e.left:e.top,o=a?e.right:e.bottom,i=a?e.width:e.height,r=a?t.left:t.top,s=a?t.right:t.bottom,l=a?t.width:t.height;return n===r||o===s||n+i/2===r+l/2}(H.animated&&H.toRect||t,s.animated&&s.toRect||n,i),E=i?"top":"left",I=k(s,"top","top")||k(H,"top","top"),F=I?I.scrollTop:void 0;if(ue!==s&&(S=n[E],be=!1,$e=!T&&l.invertSwap||C),0!==(b=function(e,t,a,n,o,i,r,s){var l=n?e.clientY:e.clientX,c=n?a.height:a.width,d=n?a.top:a.left,u=n?a.bottom:a.right,p=!1;if(!r)if(s&&he<c*o){if(!be&&(1===pe?d+c*i/2<l:l<u-c*i/2)&&(be=!0),be)p=!0;else if(1===pe?l<d+he:u-he<l)return-pe}else if(d+c*(1-o)/2<l&&l<u-c*(1-o)/2)return function(e){return M(H)<M(e)?1:-1}(t);return(p=p||r)&&(l<d+c*i/2||u-c*i/2<l)?d+c/2<l?1:-1:0}(e,s,n,i,T?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,$e,ue===s)))for(var O=M(H);O-=b,(y=V.children[O])&&("none"===w(y,"display")||y===X););if(0===b||y===s)return z(!1);pe=b;var W=(ue=s).nextElementSibling,N=!1,A=Ne(q,r,H,t,s,n,e,N=1===b);if(!1!==A)return 1!==A&&-1!==A||(N=1===A),Se=!0,setTimeout(Re,30),L(),N&&!W?r.appendChild(H):s.parentNode.insertBefore(H,N?W:s),I&&P(I,0,F-I.scrollTop),V=H.parentNode,void 0===S||$e||(he=Math.abs(S-D(s)[E])),U(),z(!0)}if(r.contains(H))return z(!1)}return!1}function _(l,c){B(l,f,a({evt:e,isOwner:u,axis:i?"vertical":"horizontal",revert:o,dragRect:t,targetRect:n,canSort:p,fromSortable:h,target:s,completed:z,onMove:function(a,n){return Ne(q,r,H,t,a,D(a),e,n)},changed:U},c))}function L(){_("dragOverAnimationCapture"),f.captureAnimationState(),f!==h&&h.captureAnimationState()}function z(t){return _("dragOverCompleted",{insertion:t}),t&&(u?d._hideClone():d._showClone(f),f!==h&&($(H,ne?ne.options.ghostClass:d.options.ghostClass,!1),$(H,l.ghostClass,!0)),ne!==f&&f!==We.active?ne=f:f===We.active&&ne&&(ne=null),h===f&&(f._ignoreWhileAnimating=s),f.animateAll((function(){_("dragOverAnimationComplete"),f._ignoreWhileAnimating=null})),f!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(s===H&&!H.animated||s===r&&!s.animated)&&(ue=null),l.dragoverBubble||e.rootEl||s===document||(H.parentNode[R]._isOutsideThisEl(e.target),t||Oe(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function U(){Q=M(H),te=M(H,l.draggable),G({sortable:f,name:"change",toEl:r,newIndex:Q,newDraggableIndex:te,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){f(document,"mousemove",this._onTouchMove),f(document,"touchmove",this._onTouchMove),f(document,"pointermove",this._onTouchMove),f(document,"dragover",Oe),f(document,"mousemove",Oe),f(document,"touchmove",Oe)},_offUpEvents:function(){var e=this.el.ownerDocument;f(e,"mouseup",this._onDrop),f(e,"touchend",this._onDrop),f(e,"pointerup",this._onDrop),f(e,"touchcancel",this._onDrop),f(document,"selectstart",this)},_onDrop:function(e){var t=this.el,a=this.options;Q=M(H),te=M(H,a.draggable),B("drop",this,{evt:e}),V=H&&H.parentNode,Q=M(H),te=M(H,a.draggable),We.eventCanceled||(be=$e=ge=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),ze(this.cloneId),ze(this._dragStartId),this.nativeDraggable&&(f(document,"drop",this),f(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),c&&w(document.body,"user-select",""),w(H,"transform",""),e&&(de&&(e.cancelable&&e.preventDefault(),a.dropBubble||e.stopPropagation()),X&&X.parentNode&&X.parentNode.removeChild(X),(q===V||ne&&"clone"!==ne.lastPutMode)&&j&&j.parentNode&&j.parentNode.removeChild(j),H&&(this.nativeDraggable&&f(H,"dragend",this),Ae(H),H.style["will-change"]="",de&&!ge&&$(H,ne?ne.options.ghostClass:this.options.ghostClass,!1),$(H,this.options.chosenClass,!1),G({sortable:this,name:"unchoose",toEl:V,newIndex:null,newDraggableIndex:null,originalEvent:e}),q!==V?(0<=Q&&(G({rootEl:V,name:"add",toEl:V,fromEl:q,originalEvent:e}),G({sortable:this,name:"remove",toEl:V,originalEvent:e}),G({rootEl:V,name:"sort",toEl:V,fromEl:q,originalEvent:e}),G({sortable:this,name:"sort",toEl:V,originalEvent:e})),ne&&ne.save()):Q!==Z&&0<=Q&&(G({sortable:this,name:"update",toEl:V,originalEvent:e}),G({sortable:this,name:"sort",toEl:V,originalEvent:e})),We.active&&(null!=Q&&-1!==Q||(Q=Z,te=ee),G({sortable:this,name:"end",toEl:V,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){B("nulling",this),q=H=V=X=Y=j=J=K=oe=ie=de=Q=te=Z=ee=ue=pe=ne=ae=We.dragged=We.ghost=We.clone=We.active=null,ye.forEach((function(e){e.checked=!0})),ye.length=re=se=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":H&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],a=this.el.children,n=0,o=a.length,i=this.options;n<o;n++)m(e=a[n],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||_e(e));return t},sort:function(e,t){var a={},n=this.el;this.toArray().forEach((function(e,t){var o=n.children[t];m(o,this.options.draggable,n,!1)&&(a[e]=o)}),this),t&&this.captureAnimationState(),e.forEach((function(e){a[e]&&(n.removeChild(a[e]),n.appendChild(a[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return m(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var a=this.options;if(void 0===t)return a[e];var n=z.modifyOption(this,e,t);a[e]=void 0!==n?n:t,"group"===e&&Ee(a)},destroy:function(){B("destroy",this);var e=this.el;e[R]=null,f(e,"mousedown",this._onTapStart),f(e,"touchstart",this._onTapStart),f(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(f(e,"dragover",this),f(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),ve.splice(ve.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!K){if(B("hideClone",this),We.eventCanceled)return;w(j,"display","none"),this.options.removeCloneOnHide&&j.parentNode&&j.parentNode.removeChild(j),K=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(K){if(B("showClone",this),We.eventCanceled)return;H.parentNode!=q||this.options.group.revertClone?Y?q.insertBefore(j,Y):q.appendChild(j):q.insertBefore(j,H),this.options.group.revertClone&&this.animate(H,j),w(j,"display",""),K=!1}}else this._hideClone()}},Ce&&h(document,"touchmove",(function(e){(We.active||ge)&&e.cancelable&&e.preventDefault()})),We.utils={on:h,off:f,css:w,find:y,is:function(e,t){return!!m(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},throttle:O,closest:m,toggleClass:$,clone:W,index:M,nextTick:Le,cancelNextTick:ze,detectDirection:Me,getChild:T},We.get=function(e){return e[R]},We.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(We.utils=a({},We.utils,e.utils)),z.mount(e)}))},We.create=function(e,t){return new We(e,t)};var Ue,Be,Ge,He,Ve,Xe,qe=[],Ye=!(We.version="1.13.0");function Je(){qe.forEach((function(e){clearInterval(e.pid)})),qe=[]}function je(){clearInterval(Xe)}function Ke(e){var t=e.originalEvent,a=e.putSortable,n=e.dragEl,o=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(t){var l=a||o;r();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);s(),l&&!l.el.contains(d)&&(i("spill"),this.onSpill({dragEl:n,putSortable:a}))}}var Ze,Qe=O((function(e,t,a,n){if(t.scroll){var o,i=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,l=t.scrollSpeed,c=C(),d=!1;Be!==a&&(Be=a,Je(),Ue=t.scroll,o=t.scrollFn,!0===Ue&&(Ue=I(a,!0)));var u=0,p=Ue;do{var h,f=p,g=D(f),m=g.top,v=g.bottom,b=g.left,$=g.right,S=g.width,y=g.height,k=void 0,T=f.scrollWidth,x=f.scrollHeight,M=w(f),E=f.scrollLeft,F=f.scrollTop;h=f===c?(k=S<T&&("auto"===M.overflowX||"scroll"===M.overflowX||"visible"===M.overflowX),y<x&&("auto"===M.overflowY||"scroll"===M.overflowY||"visible"===M.overflowY)):(k=S<T&&("auto"===M.overflowX||"scroll"===M.overflowX),y<x&&("auto"===M.overflowY||"scroll"===M.overflowY));var O=k&&(Math.abs($-i)<=s&&E+S<T)-(Math.abs(b-i)<=s&&!!E),W=h&&(Math.abs(v-r)<=s&&F+y<x)-(Math.abs(m-r)<=s&&!!F);if(!qe[u])for(var N=0;N<=u;N++)qe[N]||(qe[N]={});qe[u].vx==O&&qe[u].vy==W&&qe[u].el===f||(qe[u].el=f,qe[u].vx=O,qe[u].vy=W,clearInterval(qe[u].pid),0==O&&0==W||(d=!0,qe[u].pid=setInterval(function(){n&&0===this.layer&&We.active._onTouchMove(Ve);var t=qe[this.layer].vy?qe[this.layer].vy*l:0,a=qe[this.layer].vx?qe[this.layer].vx*l:0;"function"==typeof o&&"continue"!==o.call(We.dragged.parentNode[R],a,t,e,Ve,qe[this.layer].el)||P(qe[this.layer].el,a,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==c&&(p=I(p,!1)));Ye=d}}),30);function et(){}function tt(){}et.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var n=T(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),a&&a.animateAll()},drop:Ke},t(et,{pluginName:"revertOnSpill"}),tt.prototype={onSpill:function(e){var t=e.dragEl,a=e.putSortable||this.sortable;a.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),a.animateAll()},drop:Ke},t(tt,{pluginName:"removeOnSpill"});var at,nt,ot,it,rt,st=[],lt=[],ct=!1,dt=!1,ut=!1;function pt(e,t){lt.forEach((function(a,n){var o=t.children[a.sortableIndex+(e?Number(n):0)];o?t.insertBefore(a,o):t.appendChild(a)}))}function ht(){st.forEach((function(e){e!==ot&&e.parentNode&&e.parentNode.removeChild(e)}))}return We.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?h(document,"dragover",this._handleAutoScroll):this.options.supportPointer?h(document,"pointermove",this._handleFallbackAutoScroll):t.touches?h(document,"touchmove",this._handleFallbackAutoScroll):h(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?f(document,"dragover",this._handleAutoScroll):(f(document,"pointermove",this._handleFallbackAutoScroll),f(document,"touchmove",this._handleFallbackAutoScroll),f(document,"mousemove",this._handleFallbackAutoScroll)),je(),Je(),clearTimeout(v),v=void 0},nulling:function(){Ve=Be=Ue=Ye=Xe=Ge=He=null,qe.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var a=this,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,i=document.elementFromPoint(n,o);if(Ve=e,t||s||r||c){Qe(e,this.options,i,t);var l=I(i,!0);!Ye||Xe&&n===Ge&&o===He||(Xe&&je(),Xe=setInterval((function(){var i=I(document.elementFromPoint(n,o),!0);i!==l&&(l=i,Je()),Qe(e,a.options,i,t)}),10),Ge=n,He=o)}else{if(!this.options.bubbleScroll||I(i,!0)===C())return void Je();Qe(e,this.options,I(i,!1),!1)}}},t(e,{pluginName:"scroll",initializeByDefault:!0})}),We.mount(tt,et),We.mount(new function(){function e(){this.defaults={swapClass:"sortable-swap-highlight"}}return e.prototype={dragStart:function(e){var t=e.dragEl;Ze=t},dragOverValid:function(e){var t=e.completed,a=e.target,n=e.onMove,o=e.activeSortable,i=e.changed,r=e.cancel;if(o.options.swap){var s=this.sortable.el,l=this.options;if(a&&a!==s){var c=Ze;Ze=!1!==n(a)?($(a,l.swapClass,!0),a):null,c&&c!==Ze&&$(c,l.swapClass,!1)}i(),t(!0),r()}},drop:function(e){var t=e.activeSortable,a=e.putSortable,n=e.dragEl,o=a||this.sortable,i=this.options;Ze&&$(Ze,i.swapClass,!1),Ze&&(i.swap||a&&a.options.swap)&&n!==Ze&&(o.captureAnimationState(),o!==t&&t.captureAnimationState(),function(e,t){var a,n,o=e.parentNode,i=t.parentNode;o&&i&&!o.isEqualNode(t)&&!i.isEqualNode(e)&&(a=M(e),n=M(t),o.isEqualNode(i)&&a<n&&n++,o.insertBefore(t,o.children[a]),i.insertBefore(e,i.children[n]))}(n,Ze),o.animateAll(),o!==t&&t.animateAll())},nulling:function(){Ze=null}},t(e,{pluginName:"swap",eventProperties:function(){return{swapItem:Ze}}})}),We.mount(new function(){function e(e){for(var t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));e.options.supportPointer?h(document,"pointerup",this._deselectMultiDrag):(h(document,"mouseup",this._deselectMultiDrag),h(document,"touchend",this._deselectMultiDrag)),h(document,"keydown",this._checkKeyDown),h(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(t,a){var n="";st.length&&nt===e?st.forEach((function(e,t){n+=(t?", ":"")+e.textContent})):n=a.textContent,t.setData("Text",n)}}}return e.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(e){var t=e.dragEl;ot=t},delayEnded:function(){this.isMultiDrag=~st.indexOf(ot)},setupClone:function(e){var t=e.sortable,a=e.cancel;if(this.isMultiDrag){for(var n=0;n<st.length;n++)lt.push(W(st[n])),lt[n].sortableIndex=st[n].sortableIndex,lt[n].draggable=!1,lt[n].style["will-change"]="",$(lt[n],this.options.selectedClass,!1),st[n]===ot&&$(lt[n],this.options.chosenClass,!1);t._hideClone(),a()}},clone:function(e){var t=e.sortable,a=e.rootEl,n=e.dispatchSortableEvent,o=e.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||st.length&&nt===t&&(pt(!0,a),n("clone"),o()))},showClone:function(e){var t=e.cloneNowShown,a=e.rootEl,n=e.cancel;this.isMultiDrag&&(pt(!1,a),lt.forEach((function(e){w(e,"display","")})),t(),rt=!1,n())},hideClone:function(e){var t=this,a=(e.sortable,e.cloneNowHidden),n=e.cancel;this.isMultiDrag&&(lt.forEach((function(e){w(e,"display","none"),t.options.removeCloneOnHide&&e.parentNode&&e.parentNode.removeChild(e)})),a(),rt=!0,n())},dragStartGlobal:function(e){e.sortable,!this.isMultiDrag&&nt&&nt.multiDrag._deselectMultiDrag(),st.forEach((function(e){e.sortableIndex=M(e)})),st=st.sort((function(e,t){return e.sortableIndex-t.sortableIndex})),ut=!0},dragStarted:function(e){var t=this,a=e.sortable;if(this.isMultiDrag){if(this.options.sort&&(a.captureAnimationState(),this.options.animation)){st.forEach((function(e){e!==ot&&w(e,"position","absolute")}));var n=D(ot,!1,!0,!0);st.forEach((function(e){e!==ot&&N(e,n)})),ct=dt=!0}a.animateAll((function(){ct=dt=!1,t.options.animation&&st.forEach((function(e){A(e)})),t.options.sort&&ht()}))}},dragOver:function(e){var t=e.target,a=e.completed,n=e.cancel;dt&&~st.indexOf(t)&&(a(!1),n())},revert:function(e){var t=e.fromSortable,a=e.rootEl,n=e.sortable,o=e.dragRect;1<st.length&&(st.forEach((function(e){n.addAnimationState({target:e,rect:dt?D(e):o}),A(e),e.fromRect=o,t.removeAnimationState(e)})),dt=!1,function(e,t){st.forEach((function(a,n){var o=t.children[a.sortableIndex+(e?Number(n):0)];o?t.insertBefore(a,o):t.appendChild(a)}))}(!this.options.removeCloneOnHide,a))},dragOverCompleted:function(e){var t=e.sortable,a=e.isOwner,n=e.insertion,o=e.activeSortable,i=e.parentEl,r=e.putSortable,s=this.options;if(n){if(a&&o._hideClone(),ct=!1,s.animation&&1<st.length&&(dt||!a&&!o.options.sort&&!r)){var l=D(ot,!1,!0,!0);st.forEach((function(e){e!==ot&&(N(e,l),i.appendChild(e))})),dt=!0}if(!a)if(dt||ht(),1<st.length){var c=rt;o._showClone(t),o.options.animation&&!rt&&c&&lt.forEach((function(e){o.addAnimationState({target:e,rect:it}),e.fromRect=it,e.thisAnimationDuration=null}))}else o._showClone(t)}},dragOverAnimationCapture:function(e){var a=e.dragRect,n=e.isOwner,o=e.activeSortable;if(st.forEach((function(e){e.thisAnimationDuration=null})),o.options.animation&&!n&&o.multiDrag.isMultiDrag){it=t({},a);var i=S(ot,!0);it.top-=i.f,it.left-=i.e}},dragOverAnimationComplete:function(){dt&&(dt=!1,ht())},drop:function(e){var t=e.originalEvent,a=e.rootEl,n=e.parentEl,o=e.sortable,i=e.dispatchSortableEvent,r=e.oldIndex,s=e.putSortable,l=s||this.sortable;if(t){var c=this.options,d=n.children;if(!ut)if(c.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),$(ot,c.selectedClass,!~st.indexOf(ot)),~st.indexOf(ot))st.splice(st.indexOf(ot),1),at=null,U({sortable:o,rootEl:a,name:"deselect",targetEl:ot,originalEvt:t});else{if(st.push(ot),U({sortable:o,rootEl:a,name:"select",targetEl:ot,originalEvt:t}),t.shiftKey&&at&&o.el.contains(at)){var u,p,h=M(at),f=M(ot);if(~h&&~f&&h!==f)for(u=h<f?(p=h,f):(p=f,h+1);p<u;p++)~st.indexOf(d[p])||($(d[p],c.selectedClass,!0),st.push(d[p]),U({sortable:o,rootEl:a,name:"select",targetEl:d[p],originalEvt:t}))}else at=ot;nt=l}if(ut&&this.isMultiDrag){if((n[R].options.sort||n!==a)&&1<st.length){var g=D(ot),m=M(ot,":not(."+this.options.selectedClass+")");if(!ct&&c.animation&&(ot.thisAnimationDuration=null),l.captureAnimationState(),!ct&&(c.animation&&(ot.fromRect=g,st.forEach((function(e){if(e.thisAnimationDuration=null,e!==ot){var t=dt?D(e):g;e.fromRect=t,l.addAnimationState({target:e,rect:t})}}))),ht(),st.forEach((function(e){d[m]?n.insertBefore(e,d[m]):n.appendChild(e),m++})),r===M(ot))){var v=!1;st.forEach((function(e){e.sortableIndex===M(e)||(v=!0)})),v&&i("update")}st.forEach((function(e){A(e)})),l.animateAll()}nt=l}(a===n||s&&"clone"!==s.lastPutMode)&&lt.forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)}))}},nullingGlobal:function(){this.isMultiDrag=ut=!1,lt.length=0},destroyGlobal:function(){this._deselectMultiDrag(),f(document,"pointerup",this._deselectMultiDrag),f(document,"mouseup",this._deselectMultiDrag),f(document,"touchend",this._deselectMultiDrag),f(document,"keydown",this._checkKeyDown),f(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(e){if(!(void 0!==ut&&ut||nt!==this.sortable||e&&m(e.target,this.options.draggable,this.sortable.el,!1)||e&&0!==e.button))for(;st.length;){var t=st[0];$(t,this.options.selectedClass,!1),st.shift(),U({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:t,originalEvt:e})}},_checkKeyDown:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},t(e,{pluginName:"multiDrag",utils:{select:function(e){var t=e.parentNode[R];t&&t.options.multiDrag&&!~st.indexOf(e)&&(nt&&nt!==t&&(nt.multiDrag._deselectMultiDrag(),nt=t),$(e,t.options.selectedClass,!0),st.push(e))},deselect:function(e){var t=e.parentNode[R],a=st.indexOf(e);t&&t.options.multiDrag&&~a&&($(e,t.options.selectedClass,!1),st.splice(a,1))}},eventProperties:function(){var e=this,t=[],a=[];return st.forEach((function(n){var o;t.push({multiDragElement:n,index:n.sortableIndex}),o=dt&&n!==ot?-1:dt?M(n,":not(."+e.options.selectedClass+")"):M(n),a.push({multiDragElement:n,index:o})})),{items:o(st),clones:[].concat(lt),oldIndicies:t,newIndicies:a}},optionListeners:{multiDragKey:function(e){return"ctrl"===(e=e.toLowerCase())?e="Control":1<e.length&&(e=e.charAt(0).toUpperCase()+e.substr(1)),e}}})}),We}));var swapSortable,toastMain,toastVersion,lastTemp1,lastTemp2,lastHumid1,lastHumid2,lastHeater1,MAX_TOOLS=12,autoScroll=!0,historyIndex=-1,swapTools=new Array(MAX_TOOLS),toolColors=new Array(MAX_TOOLS),feedLoadState=new Array(MAX_TOOLS),stepperMappings=new Array(MAX_TOOLS),isTestRunning=!1,boardOptions=new Array,hasMultiservo=!1,hasSpoolmotors=!1,hasTmc=!1,hasV6S=!1,hasDDE=!1,hasNeoPixels=!1,hasExtCtrl=!1,hasSharedStepper=!1,hasLidState=!1,hasEStopMux=!1,hasSerialDisplay=!1,hasDryer=!1,tmcStatusInterval=0,testCancelled=0,lastFWVersion=0,lastWIVersion=0,curFWVersion=0,isShowingLoading=!1,isShowingUnloading=!1,versionMismatch=new Array,uploadCancelled=!1,moveCarrierG1=!1,isFeederLoaded=!1,smuffIsIdle=!1,curMS=0,newStepsMM=0,msItem="",tmcNotUsed=0,lastDlgId=0,usrDlgSelection=new Array,gotDlgButton=!1,loggingStart=0,statusTime=0;const githubUrl="technik-gegg.github.io",githubPrefix="https://"+githubUrl+"/SMuFF-WI";var sitePrefix="",NeoPixelCmd="WI-CMD:NPX:",NeoPixelCmdHeat="HEAT\n",NeoPixelCmdHeating="HEATING\n",NeoPixelCmdCool="COOL\n",NeoPixelCmdClear="CLEAR\n",NeoPixelCmdBPM120="BPM:120\n",NeoPixelCmdBPM12="BPM:12\n",cmdHeatSent=!1,cmdHeatingSent=!1,cmdCoolSent=!0,cmdClearSent=!0,colorNames=[{label:"Aqua",value:0},{label:"Azure",value:0},{label:"Beige",value:0},{label:"Bisque",value:0},{label:"Black",value:0},{label:"Blue",value:0},{label:"Brown",value:0},{label:"BurlyWood",value:0},{label:"Chartreuse",value:0},{label:"Chocolate",value:0},{label:"Coral",value:0},{label:"Cornsilk",value:0},{label:"Crimson",value:0},{label:"Cyan",value:0},{label:"DimGray",value:0},{label:"FireBrick",value:0},{label:"Fuchsia",value:0},{label:"Gainsboro",value:0},{label:"Gold",value:0},{label:"Gray",value:0},{label:"Green",value:0},{label:"Honeydew",value:0},{label:"Indigo",value:0},{label:"Ivory",value:0},{label:"Khaki",value:0},{label:"Lavender",value:0},{label:"Lime",value:0},{label:"Linen",value:0},{label:"Magenta",value:0},{label:"Maroon",value:0},{label:"MintCream",value:0},{label:"MistyRose",value:0},{label:"Moccasin",value:0},{label:"Navy",value:0},{label:"Olive",value:0},{label:"Orange",value:0},{label:"Orchid",value:0},{label:"Pink",value:0},{label:"Plum",value:0},{label:"Purple",value:0},{label:"Red",value:0},{label:"Sienna",value:0},{label:"Silver",value:0},{label:"Tan",value:0},{label:"Turquoise",value:0},{label:"Transparent",value:0},{label:"Violet",value:0},{label:"White",value:0},{label:"Yellow",value:0}],materialNames=[{label:"PLA",value:0},{label:"PETG",value:0},{label:"PC",value:0},{label:"PA",value:0},{label:"ASA",value:0},{label:"ABS",value:0},{label:"CF",value:0},{label:"PVA",value:0},{label:"Flex",value:0},{label:"HIPS",value:0}];function showConnectingMessage(e,t,a=null){$("#connecting-message").fadeOut(e,(function(){$("#connecting-message").html(t).fadeIn(e),null!=a&&a()}))}function initUI(){hideElement("#swap-tools-template-container"),hideElement("#materials-tool-template"),hideElement("#history-items-template-container"),hideElement("#console-templates"),hideElement("#materials-template"),hideElement("#servomap-template"),$("#top-info, #sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-testrun, #sec-boardinfo, #sec-live-control, #sec-dryer").fadeOut("fast"),$("#content").css("padding-top","70px"),$("#nav-container").addClass("hidden"),$("#test-status").addClass("hidden"),$("#tmc-status").addClass("hidden"),$("#tmc-stat-0").addClass("hidden"),$("#tmc-stat-1").addClass("hidden"),$("#tmc-stat-2").addClass("hidden"),$("#tmc-stat-3").addClass("hidden"),hideElement("#toast-placement"),$("#btn-wizard").css("display","none"),$(".hasDuet3D").addClass("disabled"),$(".hasDuet3D").prop("disabled",!0),showChangesPending(!1),$("#tmcwarn-label").text(""),$("#version-label").text(""),$("#devname-label").text(""),$("#electronics-label").text(""),$("#mode-label").text(""),$("#console-text").text(""),$("#test-files").empty(),$("#test-files").append(new Option(localStorage.getItem("runningScript"),"")),$("#temp1-label").text("--"),$("#temp2-label").text("--"),$("#humidity1-label").text("--"),$("#humidity2-label").text("--"),$("#heater1-label").text("--"),$("#fan1-label").text("--"),$("#temp1-label-sec").text("--"),$("#temp2-label-sec").text("--"),$("#humidity1-label-sec").text("--"),$("#humidity2-label-sec").text("--"),$("#heater1-label-sec").text("--"),$("#heater1-target-label-sec").text("--"),$("#fan1-label-sec").text("--"),$("#fan2-label-sec").text("--"),sensor1Chart=document.querySelector("#ChartSensor1 > canvas").chart,sensor2Chart=document.querySelector("#ChartSensor2 > canvas").chart}function initUI2(){$("#relay-status").css("background-color",$(".card").css("color")),$("#relay-status").css("color",$(".card").css("background-color"))}function addSentGcode(e){if(null!=e){var t=$("#console-text-container"),a=$("#send-template").clone(!0);a.attr("id",""),a.removeClass("hidden"),a.text(e),t.append(a)}}async function addReceivedGcode(e){if(null!=e){$("#console-text-container span").length>3e3&&$("#console-text-container").find("span:first").remove();var t=$("#console-text-container"),a=$("#receive-template").clone(!0);a.attr("id",""),a.removeClass("hidden"),a.html(replaceTermAttr(e)),t.append(a),autoScroll&&(t[0].scrollTop=t[0].scrollHeight)}}function replaceTermAttr(e){var t=e.replace(/\x1b\[0m/g,"</span>");t=t.replace(/\x1b\[1m/g,'<span class="bold">');for(var a=/\x1b\[(\d+)m/g;m=a.exec(t);){var n="";m[1]>=30&&m[1]<=37?n="fgc"+m[1]:m[1]>=40&&m[1]<=47&&(n="bgc"+m[1]),t=t.replace(new RegExp("\\x1b\\["+m[1]+"m","g"),'<span class="'+n+'">')}return t}function createHistoryItem(e){if(null!=e){for(var t=0,a=$("#historyitemscontainer"),n=0;n<a.children().length;n++){var o=$(a.children()[n]).find("span").text();if(null!=o&&o.toUpperCase().trim()==e.toUpperCase().trim())return void(o.toUpperCase().trim()==e.toUpperCase().trim()&&(historyIndex=n));t++}var i=$("#history-item-template").clone(!0),r=i.find("span");r.attr("id",""),i.find("i").attr("id",""),r.text(e),i.attr("id","history-item-"+t),i.css("cursor","pointer"),a.append(i),historyIndex=a.children().length}}function showLoading(e){if(!seenError){var t=$("#tool-selection").val();if(-1!=t)showInfo(e?loadingFilament+t+loadingFilamentSpl+plzWait:loadingFilament+t+closeH2+plzWait),isShowingLoading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showUnloading(e){if(!seenError){var t=$("#tool-selection").val();if(-1!=t)showInfo(e?unloadingFilament+t+unloadingFilamentSpl+plzWait:unloadingFilament+t+closeH2+plzWait),isShowingUnloading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showPurging(e){if(""!=e){var t=e.matchAll(/([A-Z]:)(\d+.?\d*)/g),a=-1,n=0,o=0;for(const e of t)switch(e[1]){case"T:":a=parseInt(e[2]);break;case"L:":n=parseInt(e[2]);break;case"C:":o=parseFloat(e[2])}if(-1!=a){var i=purging1+a+purging2+n+purging3+o+purging4+plzWait;setTimeout((function(){showInfo(i)}),500)}}else cancelInfo()}$(document).ready((function(){if($("#update-note").addClass("d-none"),$("#platform").addClass("d-none"),sitePrefix="",!location.host.startsWith(githubUrl)){if(console.log("Host: ",location.host),location.host.startsWith("localhost")||location.host.startsWith("127.0.0.1"))hideElement("#btn-OTA");else{isStandalone=!0,console.log("Running in standalone mode...");var e=location.origin;$('img[src^="assets/"]').each((function(){var t=$(this).prop("id");if("smuff-image"!==t&&"logo"!==t){var a=$(this).prop("src").replace(e,githubPrefix);a.indexOf("/wi/")>-1&&(a=a.replace("/wi/","")),$(this).prop("src",a)}})),sitePrefix=githubPrefix,console.log("Image sources changed to Github...")}$.get("platform.txt",(function(e){$("#platform").text(e)})).fail((function(){location.host.startsWith("localhost")?$("#platform").text("Localhost"):$("#platform").text("Unknown Platform")})),$("#platform").removeClass("d-none"),curWIVersion=parseFloat($("#version-info").text().substring(1)),$.get(githubPrefix+"/wiversion.txt",(function(e){lastWIVersion=parseFloat(e),console.log("Lastest SMuFF-WI version: "+lastWIVersion),$("#update-note").text($("#update-note").text().replace("{VER}",lastWIVersion)),lastWIVersion>curWIVersion&&$("#update-note").removeClass("d-none")})).fail((function(){console.log("Not able to retrieve lastest SMuFF-WI version!"),$("#update-note").text(noWiVersion).removeClass("d-none")}))}$.get(githubPrefix+"/fwversion.txt",(function(e){console.log("Lastest SMuFF Firmware version: "+e),lastFWVersion=parseFloat(e)})),window.onscroll=function(){$(window).scrollTop()>35?($("#top-info").css("transform-origin","0 0"),$("#top-info").css("transform","scale(1, .65)"),$("#content").css("padding-top",hasDryer?"190px":"160px"),$("#settings-header").css("top","105px")):($("#top-info").css("transform","scale(1, 1)"),$("#content").css("padding-top",hasDryer?"230px":"200px"),$("#settings-header").css("top","200px"))};var t=$('<link href="'+$("#themes").val()+'" rel="stylesheet" />');if(t.appendTo("head"),null!=localStorage.getItem("Theme")){var a=localStorage.getItem("Theme");$("#themes").val(a),t.attr("href",a).promise().done((function(){initUI(),setTimeout((function(){initUI2()}),1e3)}))}else initUI(),initUI2(),initSensorCharts();for(var n=0;n<3;n++)versionMismatch[n]=0;$("#themes").on("change",(function(){t.attr("href",$(this).val()).promise().done((function(){setTimeout((function(){initUI2()}),1e3)})),localStorage.setItem("Theme",$(this).val())}));var o=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e)}));toastVersion=o[0],toastMain=o[1],swapSortable=Sortable.create(toolsswaplist,{swap:!0,swapClass:"swapping-highlight",animation:250,store:{get:function(e){},set:function(e){var t=swapSortable.toArray(),a=0;t.forEach((function(e){swapTools[a++]=parseInt(e.substring(3))}))}}});var i,r=Sortable.create(historyitemscontainer,{swap:!1,swapClass:"swapping-highlight",animation:250,store:{get:function(){var e=localStorage.getItem("CmdHistory");if(void 0!==e){var t=JSON.parse(e);null!=t&&t.forEach((function(e){createHistoryItem(e)}))}},set:function(){for(var e="[ ",t=$("#historyitemscontainer"),a=0;a<t.children().length;a++){e+='"'+$(t.children()[a]).find("span").text()+'"',a<t.children().length-1&&(e+=",")}e+=" ]",localStorage.setItem("CmdHistory",e),showToast(historySavedLocally)}}});$("#accordion-settings input, #accordion-settings select").on("change",(function(){showChangesPending(!0);var e=$(this).prop("id");e.startsWith("Close-")&&async function(e,t){initDone&&e==getCurrentTool()&&await sendGcode('M205P"ServoClose"S'+t+"I99")}(parseInt(e.substring(6)),$(this).val());if("Device"==e&&(""==$(this).val()?$("#devname-label").text(noName):$("#devname-label").text($(this).val())),$(this).hasClass("form-check-input")){var t=$(this).prop("checked");switch(e){case"UsePurge":setCheckmark($("#card-purge"),t);break;case"SendStats":setCheckmark($("#card-sendstat"),t);break;case"Revolver-UseServo":t&&(hasDDE||$("#Revolver-TMC-Mode").val(0).trigger("change"));break;case"UseCutter":t?$("#lvc-cutter").removeClass("visually-hidden"):$("#lvc-cutter").addClass("visually-hidden");break;case"UseSplitter":setSplitterOption();break;case"Dlvl-1":case"Dlvl-2":case"Dlvl-4":case"Dlvl-8":case"Dlvl-16":case"Dlvl-32":case"Dlvl-64":case"Dlvl-128":return void changeDebugLevel();case"UseDuet":t?($(".hasDuet3D").removeClass("disabled"),$(".hasDuet3D").prop("disabled",!1)):($(".hasDuet3D").addClass("disabled"),$(".hasDuet3D").prop("disabled",!0))}checkForChange($(this))&&sendChange($(this)),"EmulPrusa"==$(this).prop("id")&&initDone&&($(this).is(":checked")?$("#btn-load-to-nozzle").removeClass("disabled"):$("#btn-load-to-nozzle").addClass("disabled"))}})),$("#accordion-settings input").on("focusout",(async function(){showChangesPending(!0),checkForChange($(this))&&(sendChange($(this)),"Revolver-ServoClose"==$(this).prop("id")&&$("#servo-closed-modal").modal("show"))})),$("#accordion-settings select").on("focusin",(async function(){initDone&&$(this).prop("id").endsWith("TMC-MS")&&0==(curMS=$(this).val())&&(curMS=1)})),$("#accordion-settings select").on("change",(async function(){if(initDone&&$(this).prop("id").endsWith("TMC-MS")){var e=$(this).prop("id");msItem=e.substring(0,e.length-("TMC-MS".length+1));var t=$(this).val(),a=$("#"+msItem+"-StepsMM").val();0==t&&(t=1),newStepsMM=parseInt(a/curMS*t),$("#request-steps-per-mm").html(reqStepsMM.replace("{ITEM}",msItem).replace("{VAL}",newStepsMM)),isNaN(newStepsMM)||$("#ms-changed-modal").modal("show")}showChangesPending(!0),checkForChange($(this))&&sendChange($(this))})),$("#console-container").on("hide.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","closed")})),$("#console-container").on("show.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","opened")})),$("#toast-placement").on("hide.bs.toast",(function(){hideElement($(this).prop("id")),$(this).find(".toast").each((function(){$(this).removeClass("d-flex")}))})),$("#toast-placement").on("show.bs.toast",(function(){showElement($(this).prop("id")),$(this).find(".toast").each((function(){$(this).addClass("d-flex")}))})),"closed"==localStorage.getItem("Console")&&$("#console-container").toggleClass("show"),$("#btn-selector-settings").trigger("click"),$("#btn-settings-general").trigger("click"),$("#connect, #connecting-message, #smuff-image").on("click",(function(){isStandalone?showConnectingMessage("slow",connectingDevice,openWebSock):"serial"in navigator?showConnectingMessage("slow",connectingSMuFF,connectSerial):(showError(noWebSerial),showConnectingMessage("slow",connectionFailed,null))})),$(".navbar-nav#main .nav-item").on("click",(async function(){var e=$(this).data("section");if(void 0!==e)if("#disconnect"==e)isStandalone||await disconnectSerial(),showConnect();else if($("li.nav-item").removeClass("activeSection"),$(this).addClass("activeSection"),$(".section:not("+e+")").hide(),$(e).fadeIn("slow"),"#sec-statusinfo"==e)0==tmcStatusInterval&&(tmcStatusInterval=setInterval((function(){refreshTMCStats()}),750));else if("#sec-dryer"==e)$("#LogSensor1").is(":checked")?(showElement("#btn-clear-data-1, #btn-clear-data-1-sec"),showElement("#ChartSensor1",!0,!1),hideElement("#info-sensor-1, #info-sensor-1-sec",!1,!1)):(hideElement("#btn-clear-data-1, #btn-clear-data-1-sec"),hideElement("#ChartSensor1",!0,!1),showElement("#info-sensor-1, #info-sensor-1-sec",!1,!1)),$("#LogSensor2").is(":checked")?(showElement("#btn-clear-data-2, #btn-clear-data-2-sec"),showElement("#ChartSensor2",!0,!1),hideElement("#info-sensor-2, #info-sensor-2-sec",!1,!1)):(hideElement("#btn-clear-data-2, #btn-clear-data-2-sec"),hideElement("#ChartSensor2",!0,!1),showElement("#info-sensor-2, #info-sensor-2-sec",!1,!1)),$("#btn-dryer-sec").text(isDrying?stopDrying:startDrying),isFan1Dynamic?showElement("#fan1-dynamic-sec",!1,!1):hideElement("#fan1-dynamic-sec",!1,!1);else if("#sec-live-control"==e)for(var t=0;t<getToolCount();t++)setFeedLoadState($("#lvc-in-splitter-"+t),feedLoadState[t]);else 0!=tmcStatusInterval&&(clearInterval(tmcStatusInterval),tmcStatusInterval=0)})),$("#console-text-container").on("scroll",(function(){autoScroll=!($(this)[0].scrollTop+$(this).height()<$(this)[0].scrollHeight-20)})),$(".remove-history-entry").on("click",(function(){$(this).parent().remove()})),$("#gcode").keypress((function(e){13==e.which&&$("#btn-send-gcode").trigger("click")})),$("#gcode").keydown((function(e){var t=$("#historyitemscontainer");38==e.which&&(e.preventDefault(),--historyIndex<0&&(historyIndex=t.children().length-1),setGcodeHistory()),40==e.which&&(e.preventDefault(),++historyIndex>=t.children().length&&(historyIndex=0),setGcodeHistory())})),$("body").on("keydown",(function(e){var t=e.keyCode||e.which;t>=112&&t<=115&&(e.preventDefault(),sendPFKey(t-32)),e.ctrlKey&&"s"===e.key&&(e.preventDefault(),$("#btn-save-settings").trigger("click")),e.ctrlKey&&"r"===e.key&&(e.preventDefault(),$("#btn-reload-settings").trigger("click"))})),$("#version-info, #release-notes").on("click",(function(){$("#recent-changes-modal").modal("show")})),$("#logo, #smuff").on("click",(function(){location.href="https://sites.google.com/view/the-smuff/"})),$("#btn-send-gcode").on("click",(async function(){var e=$("#gcode").val();null!=e&&e.length>0&&(historyIndex=-1,createHistoryItem(e),sendGcode(e,!0,!0),await getResponse()),$("#gcode").val("")})),$("#btn-clear-gcode").on("click",(function(){$("#console-text-container").empty()})),$("#btn-pf1").on("click",(function(){sendPFKey(80)})),$("#btn-pf2").on("click",(function(){sendPFKey(81)})),$("#btn-pf3").on("click",(function(){sendPFKey(82)})),$("#btn-pf4").on("click",(function(){sendPFKey(83)})),$("#btn-home").on("click",(function(){sendGcode("G28",!0,!0),moveCarrierG1=!1})),$("#btn-motors-off").on("click",(function(){sendGcode("M18",!0,!0)})),$("#btn-tool-maint").on("click",(function(){sendGcode("TM",!0,!0)})),$("#btn-wipe").on("click",(function(){sendGcode("G12",!0,!0)})),$("#btn-cut").on("click",(function(){sendGcode("G12C",!0,!0)})),$("#btn-load").on("click",(async function(){sendGcode("M700",!0,!0),showLoading(!1),await getResponse(),cancelInfo()})),$("#btn-unload").on("click",(async function(){$("#UseCutter").is(":checked")&&animateCutter(!1),sendGcode("M701",!0,!0),showUnloading(!1),await getResponse(),cancelInfo(),$("#UseCutter").is(":checked")&&animateCutterEnd()})),$("#btn-load-to-nozzle").on("click",(function(){sendGcode("M700N",!0,!0),showLoading(!1)})),$("#btn-load-to-splitter").on("click",(async function(){sendGcode("M700S",!0,!0),showLoading(!0)})),$("#btn-unload-from-splitter").on("click",(async function(){sendGcode("M701S",!0,!0),showUnloading(!0)})),$("#btn-reset").on("click",(function(){sendGcode("M999",!0,!0)})),$("#btn-view-script").on("click",(async function(){var e=$("#test-files option:selected").text();""!=e&&(sendGcode('M20L"test/'+e+'.gcode"'),await getResponse(),""!=responseBuffer&&($("#script-name").text(e),$("#script-content").val(responseBuffer),$("#view-script-modal").modal("show")))})),$("#btn-run-test").on("click",(async function(){var e;if("stopped"==$(this).data("state")){var t=$("#test-files option:selected").text();localStorage.setItem("runningScript",t),sendGcode('M98P"'+t+'"',!0,!1),await getResponse(),e=!0,testCancelled=0}else localStorage.setItem("runningScript",""),sendChar(""),e=!1,testCancelled=(new Date).getTime();showTestRunning(e)})),$("#btn-save-settings").on("click",(function(){showToast(savingSettings),saveConfig(),removeValFeedback()})),$("#btn-reload-settings").on("click",(function(){showToast(reloadingSettings),requestInit(),removeValFeedback()})),$("#btn-reset-swaps").on("click",(function(){var e=swapSortable.toArray();e.sort(),swapSortable.sort(e,!0),swapSortable.save()})),$("#btn-save-swaps").on("click",(async function(){for(var e="{ ",t=MAX_TOOLS,a=0;a<t;a++)e+="'T"+a+"':"+swapTools[a],a<t-1&&(e+=",");sendGcode('M504P"Swaps"S"'+(e+="}")+'"',!1,!1),await getResponse()&&showToast(toolSwapsSaved)})),$("#btn-save-history").on("click",(function(){r.save()})),$("#btn-copy-to-clipboard").on("click",(async function(){var e="";$('#console-text-container span:not([class^="fgc"],[class^="bgc"])').each((function(){""!=$(this).text()&&($(this).hasClass("data-sent")&&(e+="[--- "),e+=$(this).text().replaceAll("\n",""),$(this).hasClass("data-sent")?e+=" ---]\n":e+="\n")})),await navigator.clipboard.writeText(e),showToast(copiedToClipboard)})),$("#btn-wizard").on("click",(function(){showWizard()})),$("#btn-OTA").on("click",(function(){hideElement("#upload-progress"),$("#esp-firmware-upload-modal").modal("show")})),$("#firmware-file").on("change",(function(e){1==e.target.files.length?($("#btn-upload-firmware").removeClass("disabled"),$("#btn-upload-firmware").prop("disabled",!1),i=e.target.files[0]):($("#btn-upload-firmware").addClass("disabled"),$("#btn-upload-firmware").prop("disabled",!0),i=null)})),$("#btn-upload-firmware").on("click",(function(){if(console.log(i),null!=i){var e=new FileReader;e.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:showToast(fileNotFound);break;case e.target.error.NOT_READABLE_ERR:ahowToast(fileNotReadable);break;case e.target.error.ABORT_ERR:break;default:showToast(fileReadError)}fwBuffer=null},e.onprogress=async function(e){e.loaded==e.total&&(await sendUploadRequest("firmware.tmp",e.total),console.log("file loaded completely"))},e.onabort=function(e){showToast(uploadAborted),fwBuffer=null},e.onloadstart=function(e){console.log(e.srcElement.readyState)},e.onload=async function(t){console.log(t.currentTarget.result),t.currentTarget.readyState==e.DONE&&($("#firmware-upload-modal").modal("show"),fwBuffer=new Uint8Array(t.currentTarget.result),setTimeout((function(){sendBuffer(fwBuffer)}),500))},e.readAsArrayBuffer(i)}})),$("#btn-modal-ok").on("click",(async function(){$("#restart-modal").modal("hide"),sendGcode("M999"),await getResponse()})),$("#btn-modal-wipe-ok").on("click",(async function(){$("#wipe-sequence-modal").modal("hide");var e="S"+$("#wipe-S").val()+"I"+$("#wipe-I").val()+"J"+$("#wipe-J").val()+"P"+$("#wipe-P").val()+"R"+$("#wipe-R").val();$("#WipeSeq").val(e),sendChange($("#WipeSeq"))})),$("#btn-servo-ok").on("click",(function(){$("#servo-closed-modal").modal("hide");var e=$("#Revolver-ServoClose").val();$('input[id^="Close-"]').each((async function(){$(this).val(e).trigger("focusout"),await getResponse()}))})),$("#btn-ms-changed-ok").on("click",(function(){$("#ms-changed-modal").modal("hide"),$('input[id="'+msItem+'-StepsMM"]').each((async function(){$(this).val(newStepsMM).trigger("focusout"),await getResponse()}))})),$("#btn-cancel-upload").on("click",(function(){uploadCancelled=!0})),$("#btn-usrmsg-modal-ok").on("click",(async function(){$("#usrmsg-modal").modal("hide")})),$("#btn-usrdlg-modal-1").on("click",(async function(){$("#usrdlg-modal").modal("hide"),gotDlgButton=!0,sendDialogResult(lastDlgId,1)})),$("#btn-usrdlg-modal-2").on("click",(async function(){$("#usrdlg-modal").modal("hide"),gotDlgButton=!0,sendDialogResult(lastDlgId,2)})),$("#btn-usrdlg-modal-3").on("click",(async function(){$("#usrdlg-modal").modal("hide"),gotDlgButton=!0,sendDialogResult(lastDlgId,3)})),$("#usrdlg-modal").on("hidden.bs.modal",(function(){gotDlgButton||sendDialogResult(lastDlgId,0)})),$("#file-input-firmware").on("input",(function(e){setDisabled(!1,"#btn-upload-esp-firmware"),e.target.files.length>0&&("firmware.bin"===e.target.files[0].name||"littlefs.bin"===e.target.files[0].name||"smuff.bin"===e.target.files[0].name)&&$("#btn-upload-esp-firmware").prop("disabled","").removeClass("disabled")})),$("#btn-upload-esp-firmware").on("click",(function(){showElement("#upload-progress",!1,!1),setDisabled(!0,"#btn-upload-esp-firmware"),$("#progress-esp-upload .progress-bar").css("width","0%").text("0%"),(new Upload).doUpload($("#upload-form")[0],"uploadBinary",(function(e){var t=0,a=e.loaded||e.position,n=e.total;e.lengthComputable&&(t=Math.ceil(a/n*100)),$("#progress-esp-upload .progress-bar").css("width",t+"%").text(t+"%")}),(function(e){console.log(uploadSuccess),$("#file-input-firmware")[0].value="",$("#uploading-label").text(uploadSuccess),setTimeout((function(){hideElement("#upload-progress",!1,!1),$("#esp-firmware-upload-modal").modal("hide"),showConnect(),window.location.reload(!0)}),8e3)}),(function(e){console.log(uploadFailed),$("#file-input-firmware")[0].value="",$("#uploading-label").text(uploadFailed)}))})),$("#card-relay").on("click",(async function(){if(hasSharedStepper&&!isTestRunning){var e="I"==$(this).find("span#state").data("state")?"E":"I";$(this).find("span#state").data("state",e),setRelayState(e),sendGcode("M17"+e,!0,!1),await getResponse()}})),$("#card-lid").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";hasLidState||setLidIcon(e),sendGcode("M280R"+e,!0,!1),await getResponse()}})),$("#card-purge").on("click",(async function(){if(!hasExtCtrl&&!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"UsePurge"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#card-sendstat").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"SendStats"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#tmc-status").on("click",(function(){$('.nav-item[data-section="#sec-statusinfo"]').trigger("click")})),$("#changes-pending").on("click",(function(){$('.nav-item[data-section="#sec-settings"]').trigger("click")})),$("#tool-selection").on("change",(async function(){if(moveCarrierG1=!1,$("#selector-pwr-off").addClass("hidden"),-1==$(this).val())sendGcode("G28X",!0,!1),moveCarrier(0),await getResponse();else{var e=parseInt($(this).val().substring(1));sendGcode($(this).val(),!0,!1),moveCarrier(e),await getResponse()}})),$("[id^=history-item-]").on("click",(function(){$("#gcode").focus(),$("#gcode").val($(this).find("span").text())})),$("#WipeSeq").on("focus, click",(function(){var e=$(this).val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const t of e)console.log(t[0]),$("#wipe-"+t[0].toUpperCase()[0]).val(t[0].substring(1));$("#wipe-sequence-modal").modal("show")})),$("#Revolver-ServoClose").on("change",(async function(){initDone&&(sendGcode('M205P"ServoClose"S'+$(this).val()+"I99"),await getResponse())})),$("#Revolver-ServoOpen").on("change",(async function(){initDone&&(sendGcode('M205P"ServoOpen"S'+$(this).val()+"I99"),await getResponse())}))}));var tmcStatusBusy=!1;async function refreshTMCStats(){!tmcStatusBusy&&initDone&&(tmcStatusBusy=!0,$("#tmc-stat-0").hasClass("hidden")||(sendGcode("M122W0"),await getResponse()),$("#tmc-stat-1").hasClass("hidden")||(sendGcode("M122W1"),await getResponse()),$("#tmc-stat-2").hasClass("hidden")||(sendGcode("M122W2"),await getResponse()),$("#tmc-stat-3").hasClass("hidden")||(sendGcode("M122W3"),await getResponse()),tmcStatusBusy=!1)}function showTestRunning(e){if(!(1==e&&testCancelled>0&&(new Date).getTime()-testCancelled<4e3)){var t=$("#btn-run-test"),a=$("#test-status"),n=localStorage.getItem("runningScript");e?"running"!=t.data("state")&&(t.data("state","running"),t.find("i").removeClass("fa-play"),t.find("i").addClass("fa-stop"),a.removeClass("hidden"),a.html('Test <i>"'+n+'"</i> is running&hellip;'),isTestRunning=!0,$('.nav-item[data-section="#sec-dashboard"]').addClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').addClass("hidden"),$('.nav-item[data-section="#sec-settings"]').addClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').addClass("hidden"),$('.nav-item[data-section="#sec-statusinfo"]').addClass("hidden"),setDisabled(!0,".sec-status"),$("#sec-status").hide("slow")):"stopped"!=t.data("state")&&(t.data("state","stopped"),t.find("i").removeClass("fa-stop"),t.find("i").addClass("fa-play"),a.addClass("hidden"),a.text(a.text().replace(n,"{TEST}")),isTestRunning=!1,$('.nav-item[data-section="#sec-dashboard"]').removeClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').removeClass("hidden"),$('.nav-item[data-section="#sec-settings"]').removeClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').removeClass("hidden"),hasTmc&&$('.nav-item[data-section="#sec-statusinfo"]').removeClass("hidden"),setDisabled(!1,".sec-status"),$("#sec-status").show("slow"))}}function setCheckmark(e,t){var a=$(e).find("i");a.data("state",t),"send-stat"!=a.prop("id")?(a.removeClass("fa-check-circle fa-times-circle icon-checked icon-unchecked"),a.addClass("0"==t?"fa-times-circle icon-unchecked":"fa-check-circle icon-checked")):(a.removeClass("fa-repeat fa-times-circle fa-spin"),a.addClass("0"==t?"fa-times-circle":"fa-repeat fa-spin"))}function hideConnect(){$("#sec-start").fadeOut("slow").promise().done((function(){$("#content").css("padding-top",hasDryer?"230px":"200px"),$("#content").scrollTop(0),$("#sec-dashboard, #top-info").fadeIn("fast"),$('li.nav-item[data-section="#sec-dashboard"]').addClass("activeSection"),$('li.nav-item[data-section!="#sec-dashboard"]').removeClass("activeSection")})),$("#nav-container").removeClass("hidden"),tmcNotUsed=0,hideStatusInfoNav(),$("#btn-wizard").css("display","block");var e=localStorage.getItem("LastWizardDevice");localStorage.getItem("ShowWizard")!==never&&(localStorage.getItem("ShowWizard")==no&&e==$("#devname-label").text()||showWizard())}function showConnect(){$("#sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-boardinfo, #sec-testrun, #sec-live-control, #top-info").fadeOut("fast").promise().done((function(){$("#content").css("padding-top","70px"),$("#sec-start").fadeIn("fast"),showConnectingMessage("slow",disconnected,null),setTimeout((function(){showConnectingMessage("slow",clickToConnect,null)}),2e3)})),$("#nav-container").addClass("hidden"),$("#btn-wizard").css("display","none")}async function sendChange(e){if(initDone){var t=buildM205Command(e);if(""!=t){e.removeClass("val-failed"),sendGcode(t);var a=await getResponse();e.addClass(a?"val-changed":"val-failed"),a||showToast(saveSettingFailed)}}}function setValue(e,t){try{if(void 0===e)return;for(var a of Object.keys(e)){var n,o=!1;t.indexOf("${key}")>-1?(n=t.replace("${key}",a),o=!0):n=t;var i=$("#"+n+(o?"":a));if(void 0!==i&&null!=i){if("checkbox"==i.prop("type")){var r,s;if("boolean"==typeof e[a])switch(r=e[a],e[a]){case!0:s=yes;break;case!1:s=no}else switch(e[a]){case 1:r=!0,s=high;break;case 0:r=!1,s=low;break;case"PWM":r=!1,s=pwm;break;case"OUTPUT":r=!0,s=output}i.prop("checked",r),i.attr("data-bs-original-title",s)}else if("color"==i.prop("type"))i.val("#"+e[a]);else{i.val(e[a]);var l=0;switch(a){case"LBtnDown":l=1;break;case"LBtnHold":l=2;break;case"RBtnDown":l=3;break;case"RBtnHold":l=4}l>0&&""!=e[a]&&$("#btn-pf"+l).text(pfButton+l+" ( "+e[a]+" )")}i.trigger("change")}else console.log("Control #"+a+" not found!");0}}catch(e){console.log("Failed to set value",e)}}function changeDebugLevel(){var e=0;$("#Dlvl-1").is(":checked")&&(e|=1),$("#Dlvl-2").is(":checked")&&(e|=2),$("#Dlvl-4").is(":checked")&&(e|=4),$("#Dlvl-8").is(":checked")&&(e|=8),$("#Dlvl-16").is(":checked")&&(e|=16),$("#Dlvl-32").is(":checked")&&(e|=32),$("#Dlvl-64").is(":checked")&&(e|=64),$("#Dlvl-128").is(":checked")&&(e|=128),console.log("Debug-Level: "+e),sendGcode("M111S"+e,!1,!1)}function setDebugLevel(e){var t=e.Level;$("#Dlvl-1").prop("checked",1&t),$("#Dlvl-2").prop("checked",2&t),$("#Dlvl-4").prop("checked",4&t),$("#Dlvl-8").prop("checked",8&t),$("#Dlvl-16").prop("checked",16&t),$("#Dlvl-32").prop("checked",32&t),$("#Dlvl-64").prop("checked",64&t),$("#Dlvl-128").prop("checked",128&t)}function setTMCstats(e){var t=e.TMCStatus.Axis;if(1==e.TMCStatus.InUse)for(var a of($("#tmc-stat-"+t).removeClass("hidden"),Object.keys(e.TMCStatus))){var n=$("#tmc-stat-"+t+"-"+a);"Version"==a&&(parseInt(e.TMCStatus[a])<1?versionMismatch[t]++:versionMismatch[t]>0&&versionMismatch[t]--),versionMismatch[t]>10&&(showToast(tmcVersionMismatch),$("#tmc-status").removeClass("hidden")),n.text(e.TMCStatus[a]),void 0!==n.parent().data("alert")&&("No"!=n.text()?(n.addClass("tmc-warning"),$("#tmc-status").removeClass("hidden")):(n.removeClass("tmc-warning"),$("#tmc-status").addClass("hidden")))}else $("#tmc-stat-"+t).addClass("hidden"),tmcNotUsed++;4==tmcNotUsed&&(hasTmc=!1,hideStatusInfoNav())}function setSettings(e,t){var a;try{if(a=JSON.parse(e),"Debug"==t&&(localStorage.setItem("DBG",e),setDebugLevel(a)),"TMC"==t&&(localStorage.setItem("TMC",e),setTMCstats(a)),"Basic"==t&&(localStorage.setItem("M503S1",e),setValue(a,""),setValue(a.Baudrates,"baudrate-")),"Steppers"==t&&(localStorage.setItem("M503S2",e),setValue(a.Selector,"Selector-"),setValue(a.Revolver,"Revolver-"),setValue(a.Feeder,"Feeder-")),"TMC Driver"==t&&(localStorage.setItem("M503S3",e),setValue(a.Selector,"Selector-TMC-"),setValue(a.Revolver,"Revolver-TMC-"),setValue(a.Feeder,"Feeder-TMC-")),"Servo mapping"==t&&(localStorage.setItem("M503S4",e),!hasV6S)){for(var n=getToolCount(),o=0;o<n;o++)setValue(a["T"+o],"${key}-"+o);setValue(a.Lid,"${key}-lid"),setValue(a.Wiper,"${key}-wiper"),setValue(a.Cutter,"${key}-cutter"),setValue(a.Spare1,"${key}-spare1"),setValue(a.Spare2,"${key}-spare2"),setValue(a.Relay,"${key}-relay"),setValue(a.Out6,"${key}-user1"),setValue(a.Out7,"${key}-user2")}if("Materials"==t){localStorage.setItem("M503S5",e);n=getToolCount();toolColors=new Array(n);for(o=0;o<n;o++)setValue(a["T"+o],"materials-tool-"+o+' [id="${key}-'+o+'"]'),toolColors[o]=$("#materials-tool-"+o+' [id="Color-'+o+'"]').val()}if("Tool swaps"==t){localStorage.setItem("M503S6",e);for(o=0;o<MAX_TOOLS;o++)swapTools[o]=a["T"+o];setupSwaps()}if("Revolver mapping"==t){localStorage.setItem("M503S7",e);for(o=0;o<MAX_TOOLS;o++)stepperMappings[o]=a["T"+o];hasV6S&&setupStepperMappings()}if("Dryer"==t&&(localStorage.setItem("M503S9",e),setValue(a,""),setValue(a.HumidityLevels,"HumidityLevel-"),setValue(a.DynFanSpeeds,"DynFanSpeed-")),"Feed State"==t){for(o=0;o<MAX_TOOLS;o++)feedLoadState[o]=0,void 0!==a["T"+o]&&(feedLoadState[o]=a["T"+o]);setTimeout((function(){for(var e=0;e<getToolCount();e++)setFeedLoadState($("#lvc-in-splitter-"+e),feedLoadState[e])}),750)}t=""}catch(a){return seenParserError=!0,console.log(a),msg='In Config type: "'+t+'" Data: ',console.log(msg),console.log(e),addReceivedGcode('<span class="bgc41">Critical Parser error!</span><br/><span class="fgc36">'+msg+'<br/></span><span class="fgc34">'+e+"<br/></span>"),void showToast(failedReadSettings)}}function addTestFiles(e){try{var t=JSON.parse(e);$("#test-files").empty(),null!=t&&t.forEach((function(e){var t=e.indexOf(".gcode");if(-1!=t){var a=e.substring(0,t);$("#test-files").append(new Option(a,""))}}))}catch(e){console.log(e),showToast(failedReadingTestFiles)}}function setRelayState(e){var t=e.substring(0,1),a=$("#card-relay").find("span#state");a.data("state",t),a.text(t)}function setFWInfo(e){hasTmc=!1,hasV6S=!1,hasDDE=!1,hasMultiservo=!1,hasDryer=!1;try{var t=e.split(":"),a=t[3].replace(" DATE","").trim();$("#version-label").text(t[2].replace(" ELECTRONICS","")),$("#electronics-label").text(a),$("#mode-label").text(t[5].replace(" OPTIONS","")),$("#acc-servo-pinmaps").addClass("d-none");try{if(t.length>5){console.log("Options: "+t[6]),$("#electronics-label").prop("title",t[6].replaceAll("|","; ")),boardOptions=t[6].split("|"),hasNeoPixels=!1,setDisabled(!0,".hasNeopixels"),setDisabled(!0,".hasBacklight"),setDisabled(!0,".hasTMC"),setDisabled(!0,".hasV6S"),setDisabled(!1,".has1stEndstop"),setDisabled(!1,".hasNotV6S"),setDisabled(!1,".hasPurge"),setDisabled(!0,".hasDDE"),setDisabled(!0,".hasSpoolmotors"),$("#acc-display").removeClass("hidden"),$("#acc-servo-pinmaps").addClass("d-none");for(var n=0;n<boardOptions.length;n++)boardOptions[n]=boardOptions[n].trim(),addSentGcode(boardOptions[n]),"MULTISERVO"==boardOptions[n]&&(hasMultiservo=!0,$("#acc-servo-pinmaps").removeClass("d-none")),"SPOOLMOTORS"==boardOptions[n]&&(hasSpoolmotors=!0,setDisabled(!1,".hasSpoolmotors")),"TMC"==boardOptions[n]&&(hasTmc=!0,setDisabled(!1,".hasTMC")),"V6S"==boardOptions[n]&&(hasV6S=!0,setDisabled(!1,".hasV6S"),setDisabled(!0,".hasNotV6S")),"DDE"==boardOptions[n]&&(hasDDE=!0,setDisabled(!1,".hasDDE"),setDisabled(!0,".hasNotDDE")),"NEOPIXELS"==boardOptions[n]&&(hasNeoPixels=!0,setDisabled(!1,".hasNeopixels")),"ESTOP-MUX"==boardOptions[n]&&(hasEStopMux=!0,setDisabled(!1,".has1stEndstop")),boardOptions[n].startsWith("MINIPANEL V2")&&setDisabled(!1,".hasBacklight"),"SERIAL-TFT"==boardOptions[n]&&(hasSerialDisplay=!0,$("#acc-display").addClass("hidden")),"DRYER"==boardOptions[n]&&(hasDryer=!0);if(hasDryer)showElement("#row-quickinfo2"),showElement("#timeout-div"),showElement("#btn-dryer"),showElement("#nav-item-dryer"),$("#acc-dryer").removeClass("d-none"),null==localStorage.getItem("DryerProfiles")&&createDefaultDryerProfiles();else hideElement("#row-quickinfo2"),hideElement("#timeout-div"),hideElement("#btn-dryer"),hideElement("#nav-item-dryer"),$("#acc-dryer").addClass("d-none");hasV6S||hasDDE?(showElement("#tmc-mode-revolver"),showElement("#tmc-section-revolver"),hasDDE&&($("#btn-revolver-settings").text(lidDDE),$(".hasDDE.servoOnly").removeClass("hidden")),hasV6S&&($("#btn-revolver-settings").text(lidV6S),$("#btn-servo-mappings").text(stepperMaps),$(".hasV6S.servoOnly").removeClass("hidden"))):(hideElement("#tmc-mode-revolver"),hideElement("#tmc-section-revolver"),$("#btn-revolver-settings").text(lidOnly),$("#btn-servo-mappings").text(servoMaps),hideElement(".hasV6S.hasDDE.servoOnly"))}}catch(e){console.log(e)}try{a=a.replaceAll(" ","_");var o=sitePrefix+"/assets/img/";isStandalone&&(o=githubPrefix+"/assets/img/"),$("#pins-image").prop("src",o+a+".png"),$("#dryer-image").prop("src",o+a+"_DryerWiring.png"),hasDDE?$("#wiring-image").prop("src",o+a+"_Wiring_DDE.png"):$("#wiring-image").prop("src",o+a+"_Wiring.png"),hasDryer?showElement("#slide-dryer-image",!1,!1):hideElement("#slide-dryer-image",!1,!1)}catch(e){hideBoardInfoNav()}hideStatusInfoNav(),(curFWVersion=parseFloat($("#version-label").text().trim().substring(1)))<2.26&&($("#version-label").addClass("version-warning"),$("#version-label").prop("title",fwWarning),showToast(fwWarning)),curFWVersion<lastFWVersion&&($("#latest-version-info").text(lastFWVersion),setTimeout((function(){toastVersion.show()}),3e3))}catch(e){console.log(e)}}function hideStatusInfoNav(){hasTmc||hideElement('.nav-item[data-section="#sec-statusinfo"] .nav-link')}function hideBoardInfoNav(){hasTmc||hideElement('.nav-item[data-section="#sec-boardinfo"] .nav-link')}function setStatus(e){var t=e.substring(14),a=0;statusTime++,hasLidState=!1;var n=t.matchAll(/([A-Z]{1,3}[\d|:]+).(\+?\w+|-?\d+|\-\w+)+/g);for(const e of n){var o="on"==e[2];switch(e[1]){case"T:":$("#tool-selection").val(e[2]),a=e[2];break;case"S:":setCheckmark($("#card-selector"),o),setSelectorLed(o);break;case"R:":setCheckmark($("#card-revolver"),o);break;case"F:":setCheckmark($("#card-feed1"),o),isFeederLoaded=o,setFeederLed(o);break;case"F2:":setCheckmark($("#card-feed2"),o);break;case"SD:":o?showSDWarning():cancelSDWarning();break;case"SC:":o&&setTimeout((function(){$("#btn-reload-settings").trigger("click")}),2e3);break;case"LID:":setLidIcon(o),hasLidState=!0;break;case"I:":smuffIsIdle=o;break;case"SPL:":-1!=(a=getCurrentTool())&&(feedLoadState[a]=e[2]);break;case"RLY:":setRelayState(e[2]);break;case"TMP1:":temperature1=parseFloat(e[2])/10,$("#temp1-label, #temp1-label-sec").text(temperature1.toFixed(1));break;case"TMP2:":temperature2=parseFloat(e[2])/10,$("#temp2-label, #temp2-label-sec").text(temperature2.toFixed(1));break;case"HUM1:":humidity1=parseFloat(e[2])/10,$("#humidity1-label, #humidity1-label-sec").text(humidity1.toFixed(1));break;case"HUM2:":humidity2=parseFloat(e[2])/10,$("#humidity2-label, #humidity2-label-sec").text(humidity2.toFixed(1));break;case"HT1:":heater1=parseFloat(e[2])/10,$("#heater1-label, #heater1-label-sec").text(heater1.toFixed(1));break;case"HTT1:":var i=parseFloat(e[2])/10;heater1Target!=i&&(heater1Target=i,$("#heater1-target-label, #heater1-target-label-sec").text(heater1Target.toFixed(1))),isDrying=heater1Target>0,isHeaterSet=heater1>=heater1Target-1&&heater1<heater1Target+3;break;case"TIM:":if((heaterTimeout=parseInt(e[2]))>0){var r=new Date(1e3*heaterTimeout).toISOString().substring(11,19);$("#timeout-label, #timeout-label-sec").text(r),showElement("#timeout-div")}else $("#timeout-label-sec").text("--:--:--"),hideElement("#timeout-div");break;case"HON:":(heaterOn=o)?($("#heating-div").addClass("heating"),showElement("#heating-icon")):($("#heating-div").removeClass("heating"),hideElement("#heating-icon"));break;case"DF1:":dryerFan1Speed=parseInt(e[2]),$("#fan1-label, #fan1-label-sec").text(dryerFan1Speed);break;case"DF2:":dryerFan2Speed=parseInt(e[2]),$("#fan2-label, #fan2-label-sec").text(dryerFan2Speed);break;case"HW:":o?(showHeaterWarning(),$("#heater1-label, #heater1-label-sec").addClass("tmc-warning"),$("#heater1-icon").addClass("tmc-warning")):($("#heater1-label, heater1-label-sec").removeClass("tmc-warning"),$("#heater1-icon").removeClass("tmc-warning"),cancelHeaterWarning())}}isDrying?($("#heater-column").addClass("drying"),$("#heater-status-sec").text(isHeaterSet?dryerDrying:dryerHeating),isStandalone&&(cmdCoolSent=!1,cmdClearSent=!1,heaterOn&&!cmdHeatingSent&&(sendWebSock(NeoPixelCmd+NeoPixelCmdHeating),cmdHeatingSent=!0,cmdHeatSent=!1),heaterOn||cmdHeatSent||(sendWebSock(NeoPixelCmd+NeoPixelCmdHeat),cmdHeatingSent=!1,cmdHeatSent=!0))):($("#heater-column").removeClass("drying"),$("#heater-status-sec").text(heater1<45?dryerIdle:dryerCooling),$("#btn-dryer-sec").text()!==startDrying&&$("#btn-dryer-sec").text(startDrying),isStandalone&&(cmdHeatingSent=!1,cmdHeatSent=!1,heater1<45&&!cmdClearSent&&(sendWebSock(NeoPixelCmd+NeoPixelCmdClear),cmdClearSent=!0),heater1>=45&&!cmdCoolSent&&(sendWebSock(NeoPixelCmd+NeoPixelCmdCool),cmdCoolSent=!0,cmdClearSent=!1))),0==loggingStart&&(loggingStart=new Date),$("#LogSensor1").is(":checked")&&(statusTime%5==0&&logSensor(1,temperature1,humidity1,heater1,heater1Target),lastHumid1=humidity1,lastTemp1=temperature1,lastHeater1=Math.ceil(heater1)),$("#LogSensor2").is(":checked")&&(statusTime%5==0&&logSensor(2,temperature2,humidity2),lastHumid2=humidity2,lastTemp2=temperature2),0==temperature1&&0==humidity1?hideElement("#sensor1-column"):showElement("#sensor1-column"),0==temperature2&&0==humidity2?hideElement("#sensor2-column"):showElement("#sensor2-column"),0==heater1?hideElement("#heater-column"):showElement("#heater-column"),0==temperature1&&0==temperature2&&0==humidity1&&0==humidity2&&0==heater1&&hideElement("#row-quickinfo2"),a=getCurrentTool(),moveCarrierG1||(smuffIsIdle||($('[id^="lvc-led-"]').each((function(){$(this).prop("id").endsWith(a)||setToolLed($(this),!1)})),-1!=a&&setToolLed($("#lvc-led-"+a),!0)),moveCarrier(-1==a?0:a)),setIdleAnimation(smuffIsIdle)}function hideElement(e,t=!0,a=!0){$(e).addClass("hidden"),t&&$(e).removeClass("d-flex"),a&&$(e).removeClass("d-inline")}function showElement(e,t=!0,a=!0){$(e).removeClass("hidden"),t&&$(e).addClass("d-flex"),a&&$(e).addClass("d-inline")}function setFeedLoadState(e,t){var a=e.width()*parseInt(t);void 0!==e&&e.scrollLeft()!=a&&e.animate({scrollLeft:a+"px"},600);var n=e.parent().find('img[id^="lvc-fitting-"]');2==t?n.attr("data-bs-original-title",ttpUnloadFromNozzle).tooltip("update"):1==t?n.attr("data-bs-original-title",ttpLoadToNozzle).tooltip("update"):16==t?n.attr("data-bs-original-title",ttpUnloadFromSelector).tooltip("update"):32==t?n.attr("data-bs-original-title",ttpUnloadFromNozzle).tooltip("update"):64==t?n.attr("data-bs-original-title",ttpUnloadFromDDE).tooltip("update"):n.attr("data-bs-original-title",ttpLoadToSplitter).tooltip("update")}function moveCarrier(e){var t=$("#lvc-slot-template").width(),a=$("#lvc-carrier").width();$("#lvc-carrier").css("right",a+e*t+"px")}function setToolLed(e,t,a,n){if(t){var o=$("#ToolColor").find(":selected").text();void 0!==a&&(o=a),$(e).css("opacity",1),$(e).css("background-color",o).fadeIn(smuffIsIdle?"fast":"slow")}else{if(hasNeoPixels)var i=0;void 0!==n?(i=parseFloat($(e).css("opacity"))-n,$(e).css("opacity",i<0?0:i)):$(e).css("opacity",0).fadeOut("fast")}}var idleAnimTimer=0;function setIdleAnimation(e){if(""!=$("#AnimBPM").val()&&hasNeoPixels){var t=getToolCount();if(-1!=t){var a=60/$("#AnimBPM").val()*1e3/t/3,n=getCurrentTool(),o=0,i=!0,r=!1;e?$("#IdleAnim").is(":checked")&&0==idleAnimTimer&&(idleAnimTimer=setInterval((async function(){if(n==t-1&&i?(i=!1,r=!0):0!=n||i||(i=!0,r=!0),$("#lvc-led-"+n).css("opacity")<=.15&&(r=!1),r||(i?n++:n--),$('[id^="lvc-led-"').each((function(){setToolLed($(this),!1,null,.2)})),!r){var e="hsl("+o+",80%,50%);";setToolLed($("#lvc-led-"+n),!0,e),(o+=5)>360&&(o=0)}}),a)):(0!=idleAnimTimer&&clearInterval(idleAnimTimer),idleAnimTimer=0)}}}function setTestResults(e){try{var t=JSON.parse(e.substring(15));$("#tst-elapsed").text(t.Elapsed),$("#tst-loopcnt").text(t.Loops),$("#tst-cmdcnt").text(t.Cmds),$("#tst-changes").text(t.ToolChanges),$("#tst-feederr").text(t.FeederErrors),$("#tst-stallselector").text(t.SelectorStalls),$("#tst-stallfeeder").text(t.FeederStalls);for(var a=t.FeedsOk.split("|"),n=t.FeedsMissed.split("|"),o=0;o<a.length;o++){var i=a[o].trim(),r=n[o].trim();i.length>0&&$("#tst-ok-"+o).text(i),r.length>0&&$("#tst-fail-"+o).text(r)}}catch(e){console.log(e)}}function showToast(e){$("#toast-message").html(e),toastMain.show()}function initWizard(){$("#wizard-device").val($("#Device").val()),$("#wizard-tools").val($("#Tools").val()),$("#wizard-bowden-len").val($("#BowdenLen").val()),$("#wizard-is-marlin").prop("checked",!1),$("#wizard-is-pmmu").prop("checked",$("#EmulPrusa").is(":checked")),$("#wizard-is-duet").prop("checked",$("#UseDuet").is(":checked")),$("#wizard-has-shared-stepper").prop("checked",$("#Feeder-SharedStepper").is(":checked")),$("#wizard-has-cutter").prop("checked",$("#UseCutter").is(":checked")),$("#wizard-selector-res09").prop("checked",!1),$("#wizard-feeder-res09").prop("checked",!1);var e=$("#electronics-label").text().trim();(e.endsWith("E3 V1.2")||e.endsWith("E3 V2.0")||e.endsWith("E3 V3.0"))&&$("#wizard-has-tmc2209").prop("checked",!0),"SMuFF"==$("#mode-label").text().trim()&&$("#wizard-is-marlin").prop("checked",!0),$("#wizard-is-marlin").trigger("change"),$("#wizard-is-pmmu").trigger("change"),$("#wizard-is-duet").trigger("change"),$("#wizard-has-shared-stepper").trigger("change"),$("#wizard-has-cutter").trigger("change"),$("#wizard-has-tmc2209").trigger("change"),$("#wizard-selector-res09").trigger("change"),$("#wizard-feeder-res09").trigger("change"),hasDDE?($("#wizard-dde-res09").trigger("change"),$("#wizard-dde-row").removeClass("hidden")):hideElement("#wizard-dde-row")}async function storeWizard(){var e=$("#wizard-device").val(),t=parseInt($("#wizard-tools").val()),a=parseFloat($("#wizard-bowden-len").val()),n=$("#wizard-is-pmmu").prop("checked"),o=$("#wizard-is-duet").prop("checked"),i=$("#wizard-has-shared-stepper").prop("checked"),r=$("#wizard-has-cutter").prop("checked"),s=$("#wizard-has-tmc2209").prop("checked"),l=$("#wizard-selector-res09").prop("checked"),c=$("#wizard-feeder-res09").prop("checked"),d=$("#wizard-dde-res09").prop("checked");setWizardOption("#Device",e),setWizardOption("#Tools",t),setWizardOption("#BowdenLen",a),setWizardBoolOption("#EmulPrusa",n),setWizardBoolOption("#Feeder-SharedStepper",i),setWizardBoolOption("#UseDuet",o),setWizardBoolOption("#UseCutter",r),s&&(setWizardListOption("#Selector-TMC-Mode",1),setWizardListOption("#Feeder-TMC-Mode",1),hasDDE&&setWizardListOption("#Revolver-TMC-Mode",1)),setWizardOption("#Selector-StepsMM",l?160:80),setWizardOption("#Feeder-StepsMM",c?820:410),hasDDE&&setWizardOption("#Revolver-StepsMM",d?820:410),$("#btn-save-settings").trigger("click")}function setWizardBoolOption(e,t){$(e).prop("checked")!=t&&$(e).trigger("click")}function setWizardOption(e,t){$(e).val()!=t&&$(e).val(t).trigger("focusout")}function setWizardListOption(e,t){$(e).val()!=t&&$(e).val(t).trigger("change")}function showWizard(){initWizard(),$("#wizard-modal").modal("show")}function hideWizard(){setTimeout((function(){$("#wizard-modal").modal("hide")}),500)}function resetWizard(){localStorage.setItem("ShowWizard",yes)}function showInfo(e){$("#info-message").html(e),$("#info-progressbar").css("width","0%").text("0%"),$("#info-modal").modal("show")}function cancelInfo(){$("#info-progressbar").css("width","100%").text("100%"),setTimeout((function(){$("#info-modal").modal("hide")}),500)}function showUserInfo(e){$("#user-message").html(e),$("#usrmsg-modal").modal("show")}function showError(e){$("#serious-error-message").html(e),$("#serious-error-modal").modal("show")}function cancelError(){setTimeout((function(){$("#serious-error-modal").modal("hide")}),500)}function showSDWarning(){$("#sd-warning").modal("show")}function cancelSDWarning(){setTimeout((function(){$("#sd-warning").modal("hide")}),500)}function showHeaterWarning(){$("#heater-warning").modal("show")}function cancelHeaterWarning(){setTimeout((function(){$("#heater-warning").modal("hide")}),500)}function showChangesPending(e){e?$("#changes-pending").show():$("#changes-pending").hide(),changesPending=e}function replaceId(e){return e=(e=(e=(e=(e=(e=(e=e.replace("Selector-","")).replace("Feeder-","")).replace("Revolver-","")).replace("TMC-","")).replace("Output-","")).replace("HumidityLevel-","")).replace("DynFanSpeed-","")}function normalizeId(e){var t=-1;return e.startsWith("Material-")&&(t=e.substring(9),e=e.substring(0,8)),e.startsWith("Color-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("PFactor-")&&(t=e.substring(8),e=e.substring(0,7)),e.startsWith("CValue-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Spool-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("CCW-")&&(t=e.substring(4),e=e.substring(0,3)),e.startsWith("Close-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("Output-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Mode-")&&(t=e.substring(5),e=e.substring(0,4)),e.startsWith("RevolverClose-")&&(t="T"+e.substring(14),e=e.substring(0,13)),e.startsWith("baudrate-")&&(t=e.substring(9),e=t),e.startsWith("HumidityLevel-")&&(t=e.substring(14),e=e.substring(0,13)+"s"),e.startsWith("DynFanSpeed-")&&(t=e.substring(12),e=e.substring(0,11)+"s"),[e,t]}function buildM205Command(e){var t,a=e.prop("id");if("M"==a&&"C"==a&&"CV"==a&&"PF"==a&&"O"==a&&"P"==a)return"";var n=e.prop("localName"),o=e.prop("type"),i=(e.attr("data-section"),e.attr("data-subsection"));if(""==a&&console.log(">>> No ID <<< for prop: "+n+" of type: "+o),"input"!=n&&"select"!=n||(t="text"==o?'"'+e.val()+'"':"color"==o?'"'+e.val().substring(1)+'"':"checkbox"==o?e.is(":checked")?1:0:isNaN(e.val())?null:e.val()),null!=t){const e=normalizeId(a=replaceId(a));a.startsWith("baudrate-")?(a="Baudrates",t='"'+t+'"'):a=e[0],idx=e[1];var r="",s="";if(void 0!==i){switch(i){case"Selector":r="X",s="I"+idx;break;case"Revolver":r="Y",s="I"+idx;break;case"Feeder":r="Z",s="I"+idx;break;case"User1":case"User2":s="M",a=i;break;case"HumidityLevels":case"DynFanSpeeds":s="I"+a,a=i}i.startsWith("T")&&(s="I"+i.substring(1))}return'M205P"'+a+'" S'+t+" "+r+s}return console.log("Skipping null value..."),""}function checkForChange(e){if(!initDone)return;var t=!1,a=replaceId(e.attr("id"));const n=normalizeId(a);if(a=n[0],idx=n[1],!a.startsWith("Dlvl-")){var o,i,r=e.attr("data-section"),s=e.attr("data-subsection"),l="checkbox"==e.prop("type"),c=JSON.parse(localStorage.getItem("M503"+r)),d="";if(void 0!==s?d=c[s][a]:void 0===(d=c[a])&&(d=c[idx],t=!0),void 0!==d){if(l?(e.tooltip("hide"),1==e.prop("checked")?"boolean"==typeof d?(o=!0,i=yes):"string"==typeof d?o=i=output:(o=1,i=high):"boolean"==typeof d?(o=!1,i=no):"string"==typeof d?o=i=pwm:(o=0,i=low),e.attr("data-bs-original-title",i),e.attr("aria-label",i)):o=e.val(),d!=o)try{return void 0!==s?c[s][a]=o:t?c[idx]=o:c[a]=o,localStorage.setItem("M503"+r,JSON.stringify(c)),!0}catch(e){console.log(e)}}else showToast(valUndefined+a+subSection+s+subSectionEnd),console.log("val undefined?!");return!1}}async function saveConfig(){sendGcode("M500"),getResponse()&&($("#restart-modal").modal("show"),showChangesPending(!1))}function removeValFeedback(){$("#accordion-settings input, #accordion-settings select").each((function(){$(this).removeClass("val-changed"),$(this).removeClass("val-failed")}))}function setGcodeHistory(){if(-1!=historyIndex){var e=$($("#historyitemscontainer").children())[historyIndex],t=$(e).find("span").text();$("#gcode").val(t),setTimeout((function(){$("#gcode").focus()}),100)}}function setLidIcon(e){var t=$("#card-lid").find("i");t.data("state",e),t.removeClass("fa-unlock fa-lock icon-unchecked icon-checked"),t.addClass("0"==e?"fa-unlock icon-unchecked":"fa-lock icon-checked"),setServoHorn(e)}function getCurrentTool(){var e=$("#tool-selection").val();return"-1"==e?-1:null!=e?parseInt(e.substring(1)):-1}function setServoHorn(e){var t=parseInt($("#Revolver-ServoOpen").val()),a=parseInt($("#Revolver-ServoClose").val()),n=getCurrentTool();-1!=n&&(a=parseInt($("#Close-"+n).val()));var o=e?90-a:90-t;if(!isNaN(o))if($("#lvc-horn").css({transform:"rotate("+o+"deg)"}),"#sec-live-control"==$(".nav-item.activeSection").data("section")){var i=e?a:t;$("#lvc-horn-image").attr("data-bs-original-title",i+" deg").tooltip("update")}else $("#sec-live-control .tooltip").each((function(){$(this).tooltip("hide")}))}async function recalculateSpeeds(){if(initDone){for(var e=[["Selector-MaxSpeed","X"],["Selector-AccelSpeed","X"],["Revolver-MaxSpeed","Y"],["Revolver-AccelSpeed","Y"],["Feeder-MaxSpeed","Z"],["Feeder-AccelSpeed","Z"],["Feeder-InsSpeed","Z"],["Feeder-PurgeSpeed","Z"]],t=0;t<e.length;t++){var a=$("#"+e[t][0]).val();if(""!=a)sendGcode('M205P"XlateSpeed"S'+a+e[t][1]),await getResponse()&&$("#"+e[t][0]).val(parseInt(xlatedSpeed));else console.log('Speed "'+e[t]+'" is not set!')}showToast(speedsTranslated)}}function setDisabled(e,t){var a=$(t+" input,"+t+" select"),n=$(t+" label,"+t+" span, "+t+" i, "+t+" div");e?(a.each((function(){$(this).attr("disabled","disabled"),$(this).css("opacity","0.5")})),n.each((function(){$(this).css("opacity","0.5")}))):(a.each((function(){$(this).removeAttr("disabled"),$(this).css("opacity","1")})),n.each((function(){$(this).css("opacity","1")})))}function setAutocompleteColors(e){new Autocomplete(e,{data:colorNames,maximumItems:5,treshold:1});$(e).on("focusout",(function(){$(this).parent().find()}))}function setAutocompleteMaterials(e){new Autocomplete(e,{data:materialNames,maximumItems:5,treshold:1})}async function sendUploadRequest(e,t){if(sendGcode('M997 P"/'+e+'" L'+t),!await getResponse())return showToast(uploadingFailed),!1;uploadCancelled=!1}async function sendUploadStart(){return sendGcode(String.fromCharCode(27,85),!1,!1),!!await getResponse()||(showToast(abortingUpload),!1)}async function sendBuffer(e){var t=e.length;$("#progress-upload .progress-bar").css("width","0%"),$("#progress-upload .progress-bar").text("0%");for(var a=0;a<t;a++){await sendChar(String.fromCharCode(e[a]));var n=parseFloat(a/t*100);if(a>0&&a%50==0&&await sleep(100),$("#progress-upload .progress-bar").css("width",n+"%"),$("#progress-upload .progress-bar").text(parseInt(n)+"%"),uploadCancelled)break;pauseTransmission&&await getResume()}$("#progress-upload .progress-bar").css("width","100%"),$("#progress-upload .progress-bar").text("100%"),$("#firmware-file").val(""),setTimeout((function(){$("#firmware-upload-modal").modal("hide")}),2e3)}function showUserMessage(e){try{var t=JSON.parse(e.replaceAll('""','"')).UserMessage;t.startsWith("SD-Card removed.")||showUserInfo(t)}catch(e){console.log("Can't show User Message because: ",e)}}function showUserDialog(e){try{var t=JSON.parse(e);lastDlgId=t.UserDialog.Id;var a=t.UserDialog.Title,n=t.UserDialog.Message,o=t.UserDialog.Action,i=t.UserDialog.Buttons;gotDlgButton=!1,$("#usrdlg-title").html('<i class="fa" fa-question-circle-o fa-2x mx-2></i>'+a.replaceAll("\\n"," ")),$("#usrdlg-message").text(n.replaceAll("\\n","<br/>")),$("#usrdlg-action").text(o.replaceAll("\\n","<br/>"));var r=i.split("|");$("#btn-usrdlg-modal-1").addClass("d-none"),$("#btn-usrdlg-modal-2").addClass("d-none"),$("#btn-usrdlg-modal-3").addClass("d-none"),r.length>=1&&($("#btn-usrdlg-modal-1").text(r[0].trim()),$("#btn-usrdlg-modal-1").removeClass("d-none")),r.length>=2&&($("#btn-usrdlg-modal-2").text(r[1].trim()),$("#btn-usrdlg-modal-2").removeClass("d-none")),r.length>=3&&($("#btn-usrdlg-modal-3").text(r[2].trim()),$("#btn-usrdlg-modal-3").removeClass("d-none")),$("#usrdlg-modal").modal("show")}catch(e){console.log("Can't show User Dialog because: ",e)}}function sendDialogResult(e,t){sendGcode('{ "UserDialog": { "Id": '+e+', "Button": '+t+" } }",!1,!1,!0)}var sensor1Chart,sensor2Chart,isStandalone=!1,initDone=!1,initStarted=!1,seenOk=!1,seenError=!1,seenParserError=!1,prevLine="",configType="",currentSerial=-1,xlatedSpeed=0,collectResponse=!1,responseBuffer="",isPurging=!1,isBooting=!1,pauseTransmission=!1,temperature1=0,temperature2=0,humidity1=0,humidity2=0,heater1=0,heater1Target=0,heaterOn=!1,heaterTimeout=0,dryerFan1Speed=0,dryerFan2Speed=0,isDrying=!1,isFan1Dynamic=!1,isHeaterSet=!1;function sleep(e){return new Promise((t=>setTimeout(t,e)))}function getResponse(){return new Promise((e=>gotOk(e)))}function getResume(){return new Promise((e=>gotXon(e)))}async function gotOk(e){for(var t=1e4;!seenOk;)await sleep(10),(t-=10)<=0&&e(!1);collectResponse=!1,e(!seenError)}async function gotXon(e){for(var t=1e4;pauseTransmission;)await sleep(10),(t-=10)<=0&&e(!1);e(!0)}async function connectHandler(){isTestRunning?($(".nav-item.activeSection").removeClass("activeSection"),$('.nav-item[data-section="#sec-testrun"]').trigger("click")):await requestInit()?hideConnect():(isStandalone||await disconnectSerial(),showConnect())}async function sendGcode(e,t,a,n=!0){if(console.log("Gcode: "+e),seenOk=!1,seenError=!1,0!=e.length){e.trim().toUpperCase().startsWith("M20L")&&(responseBuffer="",collectResponse=!0),e.trim().toUpperCase().startsWith("G1")&&(e.toUpperCase().indexOf("X")>-1&&$("#selector-pwr-off").addClass("hidden"),e.toUpperCase().indexOf("Z")>-1&&$("#feeder-pwr-off").addClass("hidden")),e.trim().toUpperCase().startsWith("M500")&&showChangesPending(!1);var o=e;n&&(e+="\r\n"),await(isStandalone?writeSerial(e):writeWebSerial(e)),await sleep(5),t&&addSentGcode(o),a&&$("#gcode").focus()}}async function sendChar(e){await(isStandalone?writeSerial(e):writeWebSerial(e))}function sendCharSync(e){isStandalone?writeSerial(e):writeWebSerial(e)}function sendPFKey(e){var t=String.fromCharCode(27,91,79,e);console.log("Seq: "+t),addSentGcode("[PF"+String.fromCharCode(e-31,93)),sendGcode(t,!1,!0)}async function sendInitSeq(e){var t=3,a=!1;do{if(sendGcode(e,!1,!1),await getResponse()&&!seenParserError){a=!0;break}showInfo(connectionFailedRetry),await sleep(1e3),cancelInfo(),t--}while(t>0);return a}async function requestTMCInit(){if(curFWVersion>=3.11)await sendInitSeq("M122W99");else{await sendInitSeq("M17");for(var e=0;e<4&&await sendInitSeq("M122W"+e);e++);}initDone=!0}async function requestInit(){try{if(1==initStarted)return!1;initStarted=!0,initDone=!1,addSentGcode(wiInitStart),showInfo(fetchingSettings);var e=!0;if(isStandalone&&(await sendInitSeq("M155S0")||(e=!1)),await sendInitSeq("M115")||(e=!1),e){var t=[];t=curFWVersion>=3.11?['M205P"WebInterface"S1',"M111W1","M503S0W",'M20S"/test" F"" W',"M155S1"]:['M205P"WebInterface"S1',"M111W1","M503S0W","M503S6W","M503S7W","M503S8W",'M20S"/test" F"" W','M205P"SendStats"S1'];for(var a=0;a<t.length;a++){var n=parseInt(100/t.length*(a+1));if($("#info-progressbar").css("width",n+"%").text(n+"%"),isTestRunning||initDone)break;if(!await sendInitSeq(t[a])){e=!1;break}}addSentGcode(wiInitEnd)}else addSentGcode(wiInitFailed);return cancelInfo(),showChangesPending(!1),initStarted=!1,hasTmc?setTimeout((function(){requestTMCInit()}),100):initDone=!0,e}catch(e){console.log(e)}return!1}function playSequence(e){try{var t;switch(JSON.parse(e).PlaySequence){case"Beep":t=$("#audio-beep");break;case"LongBeep":t=$("#audio-longbeep");break;case"Startup":t=$("#audio-startup");break;case"User":t=$("#audio-user");break;case"Dryer":t=$("#audio-dryer")}null!=t&&t[0].canPlayType("audio/ogg")&&t[0].play()}catch(e){console.log("Can't play audio because: ",e)}}async function parseResponse(e){if(prevLine=e,seenParserError=!1,isBooting){if(e.startsWith('{"PlaySequence'))return void playSequence(e);if("start"!=e)return $("#info-message").html(bootingMsg+"<br/><p>"+e.substring(11)+"</p>"),void addReceivedGcode(e.replaceAll(" ","&nbsp;"))}if(e.startsWith("ok")){if(seenOk=!0,(isShowingLoading||isShowingUnloading)&&((isShowingLoading&&!isPurging||isShowingUnloading)&&cancelInfo(),isShowingLoading=!1,isShowingUnloading=!1),!initDone)return}else if(e.startsWith("error:")||e.startsWith("echo: error"))seenError=!0,"BUSY"==e.substring(7)&&showToast(smuffBusy),console.log("Errors seen: "+seenError+" [ "+prevLine+" ]");else if("start"==e)isBooting=!1,cancelInfo(),initDone&&(setTimeout((function(){showInfo(fetchingSettings)}),1e3),requestInit());else if(e.indexOf("echo: ")>-1)if(e.indexOf(" dbg:")>-1)e.indexOf("setup start")>0&&(isBooting=!0,initDone=!0,showInfo(bootingMsg));else{if(e.indexOf(" Serial:")>-1)return currentSerial=parseInt(e.substring(e.indexOf(" Serial:")+9)),void $("#curSerial"+currentSerial).removeClass("hidden");if(e.indexOf(" states:")>-1)return void setStatus(e);if(e.indexOf(" testrun:")>-1)return setTestResults(e),void showTestRunning(!0);if(e.indexOf(" purging:")>-1)return void("done"==e.substring(e.indexOf(" purging:")+9)?(isPurging=!1,cancelInfo()):(isPurging=!0,showPurging(e.substring(e.indexOf(" purging:")+9))));if(e.indexOf(" speed:")>-1)return void(xlatedSpeed=e.substring(e.indexOf(" speed:")+7));if(e.indexOf(" update:")>-1){var t=e.indexOf(" update:")+8;return"done"==e.substring(t)&&console.log("Update done!"),"failed"==e.substring(t)&&console.log("Update failed!"),void("progress"==e.substring(t)&&(progress=e.substring(t+9),console.log("Update progress: "+progress+"%")))}if(e.indexOf(" WI-CMD:")>-1){t=e.indexOf(" WI-CMD:")+8;return void addReceivedGcode(e.replaceAll(" ","&nbsp;").replaceAll("\n","<br/>"))}if((e.indexOf(" INT")>-1||e.indexOf(" EXT")>-1)&&(setRelayState(e.substring(e.indexOf("echo: ")+6)),!initDone))return}else if(e.startsWith("FIRMWARE_NAME"))setFWInfo(e);else{if(e.startsWith("Unknown parameter 'WebInterface"))return initDone=!0,void showError("Apparently, this SMuFF-Firmware version is <b>less than 2.26</b>! Please update your firmware for this app.");if(e.startsWith("/*")){if(configType=e.replace("/*","").replace("*/","").trim(),!initDone)return void(configType.startsWith("Testscripts")&&(addTestFiles(configType.substring(12)),configType=""))}else if(e.startsWith('{"')){if(e.indexOf("UserMessage")>-1)return void showUserMessage(e);if(e.indexOf("UserDialog")>-1)return void showUserDialog(e);if(e.indexOf("PlaySequence")>-1)return void playSequence(e);if(e.indexOf("TMCStatus")>-1&&(configType="TMC"),setSettings(e,configType),!initDone)return}else for(var a=["M17","M111","M122","M155","M205","M503"],n=0;n<a.length;n++)if(e.startsWith(a[n])){if(initDone)break;return}}addReceivedGcode(e.replaceAll(" ","&nbsp;"))}var dryerProfiles,dryerProfilesJson,websock=null,firstWebSockInit=!0,webSockOpenFailed=!1,collectWSData="";function openWebSock(){(websock=new WebSocket("ws://"+location.host+":8080/smuff-wi")).onopen=function(e){console.log("WebSocket connection is open..."),webSockOpenFailed=!1,setTimeout((function(){firstWebSockInit&&(firstWebSockInit=!1),connectHandler()}),50)},websock.onerror=function(e){console.log("WebSocket has reported an error: ",e),webSockOpenFailed=!0},websock.onclose=function(e){var t=connectionClosed;firstWebSockInit=!0,e.wasClean?console.log("WebSocket connection has been closed normally!"):(console.log("WebSocket connection has been killed!"),console.log("Code: "+e.code,"See: https://datatracker.ietf.org/doc/html/rfc6455#section-7.4.1"),t=connectionFailed),showConnectingMessage("fast",t,null)},websock.onmessage=function(e){(collectWSData+=e.data).endsWith("\n")&&(parseIncomingData(collectWSData.substring(0,collectWSData.length-1)),collectWSData="")}}async function sendWebSock(e){null!==websock&&"undefined"!==websock&&1==websock.readyState||openWebSock(),waitForSocketConnection(websock,(function(){0==websock.bufferedAmount?websock.send(e):(console.log("Waiting for WebSocket buffer to empty..."),waitForBufferEmpty(websock,(function(){websock.send(e)})))}))}function waitForBufferEmpty(e,t){setTimeout((function(){0!=e.bufferedAmount?waitForBufferEmpty(e,t):null!=t&&t()}),150)}function waitForSocketConnection(e,t){setTimeout((function(){1!==e.readyState?waitForSocketConnection(e,t):null!=t&&t()}),50)}var chartTooltips={callbacks:{label:tooltipLabelCb,afterLabel:tooltipAfterLabelCb}},chartScales={yAxes:[{id:"y-axis-heater",type:"linear",position:"left",display:!0,ticks:{suggestedMin:10,suggestedMax:150},scaleLabel:{display:!0,labelString:"Temperature (C)"}},{id:"y-axis-aht",type:"linear",position:"right",display:!0,gridLines:{color:"rgba(63,152,255,0.25)"},ticks:{suggestedMin:0,suggestedMax:100},scaleLabel:{display:!0,labelString:"Humidity (%)"}}]};function tooltipLabelCb(e,t){var a=t.datasets[e.datasetIndex];return prev=e.index>0?a.data[e.index-1]:0,val=a.data[e.index],lbl=a.label+": ",0==e.datasetIndex?lbl+val+"% RH":lbl+val+"C"}function tooltipAfterLabelCb(e,t){var a=t.datasets[e.datasetIndex],n=e.index;do{if(prev=n>0?a.data[n-1]:0,--n<0)break}while(null==prev);return val=a.data[e.index],delta=" "+(val-prev>=0?"+":"")+(val-prev).toFixed(1),0==e.datasetIndex?delta+"%":delta+"C"}function initSensorCharts(){sensor1Chart.options.elements.point.radius=2,sensor1Chart.options.scales=chartScales,sensor1Chart.options.tooltips=chartTooltips,sensor2Chart.options.elements.point.radius=2,sensor2Chart.options.scales=chartScales,sensor2Chart.options.tooltips=chartTooltips,sensor1Chart.data.labels=[];for(var e=0;e<sensor1Chart.data.datasets.length;e++)sensor1Chart.data.datasets[e].data=[];sensor2Chart.data.labels=[];for(e=0;e<sensor2Chart.data.datasets.length;e++)sensor2Chart.data.datasets[e].data=[]}function logSensor(e,t,a,n,o){var i=new Date-loggingStart,r="+"+parseInt(i/1e3/60).toString().padStart(2,"0")+":"+parseInt(i/1e3%60).toString().padStart(2,"0"),s=sensor1Chart.data.labels.length,l=sensor2Chart.data.labels.length;if(1==e){if(sensor1Chart.data.labels[s]=r,sensor1Chart.data.datasets[0].data[s]=a,sensor1Chart.data.datasets[1].data[s]=t,sensor1Chart.data.datasets[2].data[s]=n,sensor1Chart.data.datasets[3].data[s]=o,s>15){sensor1Chart.data.labels.shift();for(var c=0;c<sensor1Chart.data.datasets.length;c++)sensor1Chart.data.datasets[c].data.shift()}sensor1Chart.update()}if(2==e){if(sensor2Chart.data.labels[l]=r,sensor2Chart.data.datasets[0].data[l]=a,sensor2Chart.data.datasets[1].data[l]=t,l>15){sensor2Chart.data.labels.shift();for(c=0;c<sensor2Chart.data.datasets.length;c++)sensor2Chart.data.datasets[0].data.shift()}sensor2Chart.update()}}function durationToDate(){var e=$("#drying-duration").val(),t=Date.parse("2024-01-01T"+e+":00");return new Date(t)}function createDefaultDryerProfiles(){localStorage.setItem("DryerProfiles",'{"Profile":[{"Name":"PLA, 3h at 75C",  "Duration":180, "TargetTemp":75,  "Fan1":0,  "Fan2":50, "DynFan":true},{"Name":"PETG,6h at 95C",  "Duration":360, "TargetTemp":95,  "Fan1":0,  "Fan2":50, "DynFan":true},{"Name":"ASA, 5h at 100C", "Duration":300, "TargetTemp":100, "Fan1":0,  "Fan2":50, "DynFan":true},{"Name":"PA,  6h at 125C", "Duration":360, "TargetTemp":125, "Fan1":75, "Fan2":50, "DynFan":false}]}')}function deleteAllDryerProfiles(){localStorage.removeItem("DryerProfiles")}function createNewProfileItem(e,t,a,n,o,i){var r=JSON.parse('{"Name":"",  "Duration":0, "TargetTemp":0,  "Fan1":0,  "Fan2":0, "DynFan":false}');return r.Name=e,r.Duration=t,r.TargetTemp=parseInt(a),r.Fan1=parseInt(n),r.Fan2=parseInt(o),r.DynFan=!!i,r}function addProfileItem(e){if(null==dryerProfilesJson)return console.log("No valid JSON object for profiles found!"),!1;null!=e&&(pos=dryerProfilesJson.Profile.length,dryerProfilesJson.Profile[pos]=e)}function removeProfileItem(e){if(null==dryerProfilesJson)return console.log("No valid JSON object for profiles found!"),!1;if(null!=e){var t=0,a=!1;for(var n of dryerProfilesJson.Profile){if(n.Name==e){a=!0;break}t++}return a&&dryerProfilesJson.Profile.splice(t,1),a}}function storeLocalProfiles(){localStorage.setItem("DryerProfiles",JSON.stringify(dryerProfilesJson))}function getLocalProfile(e){for(var t of dryerProfilesJson.Profile)if(t.Name==e)return t;return null}function getLocalProfiles(){if(null!=(dryerProfiles=localStorage.getItem("DryerProfiles"))){var e=$("#dryer-profiles");for(var t of(e.empty().append($("<option>",{text:"None"})),(dryerProfilesJson=JSON.parse(dryerProfiles)).Profile))null!=t&&null!=t.Name&&e.append($("<option>",{text:t.Name}))}}function selectProfile(e){$("#dryer-profiles option").each((function(){$(this).val()==e&&($(this).selected=!0,$("#dryer-profiles").trigger("change"))}))}async function animateWiper(){var e=0,t=0,a=100,n=$("#WipeSeq").val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const a of n)a[0].toUpperCase().startsWith("R")&&(e=parseInt(a[0].substring(1))),a[0].toUpperCase().startsWith("S")&&(t=parseInt(a[0].substring(1)));var o=7*t;$("#lvc-wiper-image-1").hide(),$("#lvc-wiper-image-2").show(),await sleep(a),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").show(),await sleep(a);for(var i=0;i<e;i++)$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").show(),await sleep(o),$("#lvc-wiper-image-4").hide(),$("#lvc-wiper-image-3").show(),await sleep(o);$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-2").show(),await sleep(a),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-1").show(),await sleep(a)}async function animateCutter(e){for(var t=0;t<3;t++)$("#lvc-cutter-image-1").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").show(),await sleep(0==t?750:375),t<2&&($("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100));e&&animateCutterEnd()}async function animateCutterEnd(){$("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100)}function setFeederLed(e){$("#UseSplitter").is(":checked")?$("#lvc-feeder-led").css("opacity",0):$("#lvc-feeder-led").css("opacity",e?1:0)}function setSelectorLed(e){$("#lvc-selector-led").css("opacity",e?0:1)}function getRodPosition(e){var t=$("#Tools").val()-1,a=parseInt($("#Selector-Spacing").val()*t),n=parseInt(e-$("#lvc-rod").offset().left),o=$("#lvc-rod").width();return parseInt((o-n)*(a/o))}function positionCarrier(e){var t=$("#Tools").val(),a=parseInt($("#Selector-Spacing").val())*t;e*=$("#lvc-rod").width()/a,$("#lvc-carrier").css("right",90+e+"px")}function setSplitterOption(){$("#UseSplitter").is(":checked")?($("#lvc-bottom").addClass("hidden"),$("#lvc-feed").addClass("hidden"),$("#lvc-bottom-splitter").removeClass("hidden"),$('[id^="lvc-fitting-"]').each((function(){$(this).removeClass("hidden")})),$('[id^="lvc-in-splitter-"]').each((function(){$(this).removeClass("hidden")})),$("#btn-load-to-splitter").removeClass("disabled"),$("#btn-unload-from-splitter").removeClass("disabled")):($("#lvc-bottom").removeClass("hidden"),$("#lvc-feed").removeClass("hidden"),$("#lvc-bottom-splitter").addClass("hidden"),$('[id^="lvc-fitting-"]').each((function(){$(this).addClass("hidden")})),$('[id^="lvc-in-splitter-"]').each((function(){$(this).addClass("hidden")})),$("#btn-load-to-splitter").addClass("disabled"),$("#btn-unload-from-splitter").addClass("disabled"))}function loadUnloadSplitter(e){var t=getCurrentTool();-1!=t?e==t?1==feedLoadState[t]?$("#btn-unload-from-splitter").trigger("click"):$("#btn-load-to-splitter").trigger("click"):showToast(toolNotSelected):showToast(noToolSelected)}function loadUnload(e){var t;-1!=(t=getCurrentTool())?e==t?$("#UseSplitter").is(":checked")?2==feedLoadState[e]?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):isFeederLoaded?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):showToast(toolNotSelected):showToast(noToolSelected)}async function parseIncomingData(e){await parseResponse(e)}async function writeSerial(e){await sendWebSock(e)}$(document).ready((function(){$("#fan1-label, #fan1-label-sec").css("cursor","pointer"),$("#fan2-label, #fan2-label-sec").css("cursor","pointer"),$("#dryer-label").css("cursor","pointer"),$("#heater1-target-label, #heater1-target-label-sec").css("cursor","pointer"),$("#timeout-div").css("cursor","pointer"),$("#sensor1-label").css("cursor","pointer"),$("#sensor2-label").css("cursor","pointer"),$("#heater1-label").css("cursor","pointer"),$("#timeout-div").on("click",(function(){isDrying&&$("#stop-dryer-modal").modal("show")})),$("#sensor1-label, #sensor2-label, #heater1-label").on("click",(function(){$('.nav-item[data-section="#sec-dryer"]').trigger("click")})),$("#heater1-target-label, #heater1-target-label-sec").on("click",(function(){isDrying&&($("#input-target-temp").val(heater1Target),$("#input-target-temp").prop("max",$("#HeaterMaxTemp").val()),$("#input-target-temp").trigger("change"),$("#dryer-temp-modal").modal("show"))})),$("#dryer-label, #btn-dryer, #btn-dryer-sec").on("click",(function(){isDrying?$("#stop-dryer-modal").modal("show"):(getLocalProfiles(),$("#btn-modal-dryer-delete").prop("disabled","disabled"),$("#dryer-target-temp").prop("max",$("#HeaterMaxTemp").val()),$("#dryer-dyn-fan1").prop("checked",isFan1Dynamic),$("#dryer-modal").modal("show"))})),$("#fan1-label, #fan1-label-sec").on("click",(function(){var e=parseInt($("#fan1-label").text());$("#input-fan-speed").val(e),$("#input-fan-speed").trigger("change"),$("#fan-index").val(1),$("#fan-speed-modal").modal("show")})),$("#fan2-label, #fan2-label-sec").on("click",(function(){var e=parseInt($("#fan2-label").text());$("#input-fan-speed").val(e),$("#input-fan-speed").trigger("change"),$("#fan-index").val(2),$("#fan-speed-modal").modal("show")})),$("#dryer-profiles").on("change",(function(e){var t=$(e.target).find("option:selected").text();if("None"==t)$("#btn-modal-dryer-delete").prop("disabled","disabled"),$("#btn-modal-dryer-save").html(saveAsProfile);else{$("#btn-modal-dryer-delete").prop("disabled",""),$("#btn-modal-dryer-save").html(changeProfile);var a=getLocalProfile(t);if(null!=a){var n=a.TargetTemp;n>$("#HeaterMaxTemp").val()?(n=$("#HeaterMaxTemp").val(),$("#dryer-target-temp").css("background-color","var(--bs-warning)"),$("#dryer-target-temp").prop("title",tempIsLimited)):$("#dryer-target-temp").css("background-color","var(--bs-white)");var o=new Date(6e4*a.Duration).toISOString().substring(11,16);$("#drying-duration").val(o),$("#dryer-target-temp").val(n),$("#dryer-fan1-speed").val(a.Fan1),$("#dryer-fan2-speed").val(a.Fan2),$("#dryer-dyn-fan1").prop("checked",a.DynFan)}}})),$("#input-fan-speed").on("change",(async function(){$("#label-fan-speed").text($("#input-fan-speed").val()+"%")})),$("#input-fan-speed").on("input",(async function(){$("#label-fan-speed").text($("#input-fan-speed").val()+"%")})),$("#input-target-temp").on("change",(async function(){$("#label-target-temp").text($("#input-target-temp").val()+"C")})),$("#input-target-temp").on("input",(async function(){$("#label-target-temp").text($("#input-target-temp").val()+"C")})),$("#btn-modal-dryer-cancel").on("click",(async function(){$("#dryer-modal").modal("hide")})),$("#btn-modal-dryer-ok").on("click",(async function(){$("#dryer-modal").modal("hide");var e=durationToDate(),t=60*e.getHours()+e.getMinutes(),a=$("#dryer-target-temp").val(),n=$("#dryer-fan1-speed").val(),o=parseInt($("#dryer-fan2-speed").val())+2e3,i=$("#dryer-dyn-fan1").is(":checked")?1:0,r="M141 S"+a+" T"+t+" F"+n+" F"+o+" D"+i;console.log("Dryer: "+r),sendGcode(r,!1,!1),isDrying=!0,isFan1Dynamic=1==i,$("#btn-dryer-sec").text(stopDrying),isFan1Dynamic?showElement("#fan1-dynamic-sec",!1,!1):hideElement("#fan1-dynamic-sec",!1,!1)}));var e=null;$("#btn-modal-dryer-delete").on("click",(async function(){removeProfileItem($("#dryer-profiles").find("option:selected").text())&&(storeLocalProfiles(),getLocalProfiles(),selectProfile("None"))})),$("#btn-modal-dryer-save").on("click",(async function(){var t=$("#dryer-profiles").find("option:selected").text();if("None"!=t)e=getLocalProfile(t),$("#user-input-input").val(t);else{var a=durationToDate(),n=$("#dryer-target-temp").val();$("#user-input-input").val("Material, "+a.getHours()+"h at "+n+"C")}$("#user-input-title").text("Enter the Profile name"),$("#user-input-prompt").text("Enter a new name to create another profile or use the same name to overwrite the profile parameters."),$("#usrinput-modal").modal("show")})),$("#btn-user-input-modal-ok").on("click",(async function(){var t=$("#dryer-profiles").find("option:selected").text();$("#user-input-input").val()!=t&&(e=null);var a=$("#user-input-input").val(),n=durationToDate(),o=60*n.getHours()+n.getMinutes(),i=$("#dryer-target-temp").val(),r=$("#dryer-fan1-speed").val(),s=$("#dryer-fan2-speed").val(),l=$("#dryer-dyn-fan1").is(":checked");null!=e?(console.log(e.Name),e.Duration=o,e.TargetTemp=i,e.Fan1=r,e.Fan2=s,e.DynFan=l):addProfileItem(createNewProfileItem(a,o,i,r,s,l));storeLocalProfiles(),null==e&&(getLocalProfiles(),selectProfile(a))})),$("#btn-fan-speed-cancel").on("click",(async function(){$("#fan-speed-modal").modal("hide")})),$("#btn-fan-speed-ok").on("click",(async function(){$("#fan-speed-modal").modal("hide");var e=$("#input-fan-speed").val(),t=$("#fan-index").val();console.log("Fan speed on: "+t+" = "+e),sendGcode("M106 I"+t+" S"+e,!1,!1),isFan1Dynamic=!1,hideElement("#fan1-dynamic-sec",!1,!1)})),$("#btn-stop-dryer-modal-cancel").on("click",(async function(){$("#stop-dryer-modal").modal("hide")})),$("#btn-stop-dryer-modal-ok").on("click",(async function(){$("#stop-dryer-modal").modal("hide"),sendGcode("M141 S0"),isDrying=!1,$("#btn-dryer-sec").text(startDrying)})),$("#btn-target-temp-cancel").on("click",(async function(){$("#dryer-temp-modal").modal("hide")})),$("#btn-target-temp-ok").on("click",(async function(){$("#dryer-temp-modal").modal("hide"),sendGcode("M141 C"+$("#input-target-temp").val(),!1,!1)})),$("#btn-sensor-chart-modal-close").on("click",(async function(){$("#sensor-chart-modal").modal("hide")})),$("#btn-clear-data-1, #btn-clear-data-1-sec").on("click",(function(){sensor1Chart.data.labels=[];for(var e=0;e<4;e++)sensor1Chart.data.datasets[e].data=[];sensor1Chart.update(),loggingStart=0})),$("#btn-clear-data-2, #btn-clear-data-2-sec").on("click",(function(){sensor2Chart.data.labels=[];for(var e=0;e<2;e++)sensor2Chart.data.datasets[e].data=[];sensor2Chart.update(),loggingStart=0}))})),$(document).ready((function(){$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").hide(),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").hide(),$("#lvc-horn-image").tooltip({delay:{show:100,hide:100},trigger:"hover"}),$("#lvc-horn, #lvc-horn-image").on("click",(function(){-1!=getCurrentTool()?$("#card-lid").trigger("click"):showToast(noToolSelected)})),$("#lvc-rod").tooltip({delay:{show:100,hide:100},trigger:"manual"}),$("#lvc-rod").on("mousemove",(function(e){var t=getRodPosition(e.pageX);$("#lvc-rod").attr("data-bs-original-title",moveSelectorTo+t+millimeter).tooltip("update").tooltip("show")})),$("#lvc-rod").on("click",(async function(e){moveCarrierG1=!0,$("#selector-pwr-off").addClass("hidden");var t=getRodPosition(e.pageX);positionCarrier(t),sendGcode("G90",!1,!1),await getResponse(),sendGcode("G1X"+t,!1,!1),await getResponse(),sendGcode("G91",!1,!1),await getResponse()})),$("#lvc-home").on("click",(function(e){moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val(-1).trigger("change")})),$("#lvc-selector").on("click",(function(e){sendGcode("M18X",!1,!1),$("#selector-pwr-off").removeClass("hidden")})),$("#lvc-feeder").on("click",(function(e){sendGcode("M18Z",!1,!1),$("#feeder-pwr-off").removeClass("hidden")})),$("#lvc-feed").on("click",(function(e){loadUnload(getCurrentTool())})),$("#lvc-cutter").on("click",(function(e){sendGcode("G12C"),animateCutter(!0)})),$("#lvc-wiper").on("click",(function(e){sendGcode("G12"),animateWiper()})),$("#lvc-reset").on("click",(function(e){$("#btn-reset").trigger("click")})),$("#lvc-tensioner").on("click",(function(e){showInfo(notExpected),setTimeout((function(){cancelInfo()}),4e3)})),$(".lvc-fitting").on("click",(function(){var e=parseInt($(this).prop("id").substring(12));isNaN(e)||(feedLoadState[e]>=1?loadUnload(e):loadUnloadSplitter(e))})),$(".lvc-in-splitter").on("click",(function(){var e=parseInt($(this).prop("id").substring(16));isNaN(e)||(2==feedLoadState[e]?loadUnload(e):loadUnloadSplitter(e))}))}));const noToolSelected="No tool selected!",toolNotSelected="Tool not active! Please select this tool first for moving the Selector over that tool.",moveSelectorTo="Move Selector to ",millimeter=" mm",notExpected='You didn\'t really think that would work, did you?<br/><br/><img src="assets/img/Smiley.png" alt=":o)">',historySavedLocally="History has been saved locally.",noWebSerial="Your browser doesn't support Web Serial! Please use the latest version of either <i>Google Chrome</i> or <i>Microsoft Edge</i> browser&hellip;<br/><br/><small><b>Please notice:</b> This app will not work on a mobile phone or tablet since the Web Serial API isn't implemented in the browsers of those devices!</small>",savingSettings="Saving Settings&hellip;",reloadingSettings="Reloading Settings&hellip;",toolSwapsSaved="Tool-Swaps have been saved.",copiedToClipboard="Console output copied to Clipboard.",fileNotFound="File Not Found!",fileNotReadable="File is not readable!",fileReadError="An error occurred reading this file.",uploadAborted="Firmware upload aborted!",saveSettingFailed="Setting this value on the SMuFF has failed!<br/><br/>Please check console output for detailed information.",tmcVersionMismatch="Version mismatch on TMC driver!<br/>Please check your hardware setup!",failedReadSettings="Failed to read settings from SMuFF. Please check your setup!",failedReadingTestFiles='Can\'t read test-files from SMuFF. Please check the "test" folder on your SD-Card!',valUndefined="WTF? val undefined?! id: <b>",subSection="</b> subsection: <b>",subSectionEnd="</b>",speedsTranslated="Speeds have been translated! Please check whether they were calculated correctly.",uploadingFailed="Uploading firmware failed! See console for details.",abortingUpload="SMuFF not responding. Aborting upload!",smuffBusy="SMuFF is BUSY",connectingSMuFF="Connecting with SMuFF, please pick a serial port&hellip;",connectingDevice="Connecting with device, please wait&hellip;",connectionFailedRetry="Connection failed, retrying&hellip;",connectionFailed="Connection failed",connectionClosed="Connection has been closed from server",serialConnectionFail="Serial connection failed!",clickToConnect="Click here to connect&hellip;",disconnected="Disconnected&hellip;",openingPort="Opening serial port&hellip;",serialPortOpen="Serial port sucessfully opened",fetchingSettings="Fetching settings from SMuFF, please wait&hellip;",wiInitStart="<<< WebInterface Init Start >>>",wiInitEnd="<<< WebInterface Init End >>>",wiInitFailed="<<< WebInterface Init Failed >>>",plzWait="<br/>Please wait&hellip;",loadingFilament="<h2>Loading Filament for ",loadingFilamentSpl=" to Splitter</h2>",unloadingFilamentSpl=" from Splitter</h2>",unloadingFilament="<h2>Unloading Filament for ",closeH2="</h2>",purging1="<h2>Purging Tool ",purging2="</h2>Amount: ",purging3=" mm or ",purging4=" mm<br/>",fwWarning="This SMuFF-Firmware version is outdated for this app! Install at least version 2.26",ttpUnloadFromDDE="Unload from DDE",ttpUnloadFromSelector="Unload from Selector",ttpUnloadFromNozzle="Unload from Nozzle",ttpLoadToNozzle="Load to Nozzle",ttpLoadToSplitter="Load to Splitter",ttpLoadToDDE="Load to DDE",lidOnly="Lid",lidDDE="Lid / DDE",lidV6S="Lid / Revolver",lidV4="Revolver",noName="NO-NAME",servoMaps="Servo Angle Mappings",stepperMaps="Lid Stepper Mappings",stepperClosedAt="Closed @ mm",reqStepsMM="You have changed the micro stepping for <b>{ITEM}</b>.<br/><br/>Do you want me to correct the <i>Steps per Millimeter</i> setting to <b>{VAL}</b>?",pfButton="Button ",yes="Yes",no="No",never="Never",high="HIGH",low="LOW",pwm="PWM",output="OUTPUT",bootingMsg="<h2>SMuFF is booting&hellip;</h2>",noWiVersion="ATTENTION: Unable to check for latest WebInterface version! Your current version might be outdated!",tempIsLimited="Temperature is over the limit defined in Settings",saveAsProfile="Save as Profile &hellip;",changeProfile="Change Profile &hellip;",uploadSuccess="Firmware uploaded successfully. This dialog will close in a few seconds automatically and reload the page.",uploadFailed="Firmware upload has failed! Please try again.",dryerIdle="Idle",dryerHeating="Heating up",dryerCooling="Cooling down",dryerDrying="Drying",startDrying="Start Dryer",stopDrying="Stop Dryer";function getToolCount(){return""==$("#Tools").val()?-1:parseInt($("#Tools").val())}function setupMaterials(){var e=getToolCount();if(-1!=e){var t=$("#form-materials");t.empty(),t.append('<datalist id="datalistColors"></datalist>'),t.append('<datalist id="datalistMaterials"></datalist>');var a=t.find('datalist[id="datalistColors"]');for(key in Object.keys(colorNames)){var n='<option value="'+colorNames[key].label+'"/>';a.append(n)}for(key in a=t.find('datalist[id="datalistMaterials"]'),Object.keys(materialNames)){n='<option value="'+materialNames[key].label+'"/>';a.append(n)}for(var o=$("#materials-template"),i=0;i<e;i++){var r=o.clone(!0);r.prop("id","materials-tool-"+i),r.removeClass("hidden"),r.find("label").text("T"+i+":"),r.find("input").each((function(){$(this).prop("id",$(this).prop("name")+i),$(this).attr("data-section","S5"),$(this).attr("data-subsection","T"+i)})),t.append(r)}}}function setupServoMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();for(var a=$("#servomap-template"),n=0;n<e;n++){var o=a.clone(!0);o.prop("id","servomap-"+n),o.removeClass("hidden"),o.find("label").text("T"+n+":"),o.find("input").each((function(){$(this).prop("id",$(this).prop("name")+n),$(this).attr("data-section","S4"),$(this).attr("data-subsection","T"+n)})),t.append(o)}}}function setupStepperMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();var a=$("#servomap-template");$("#caption-closeat").text("Closed @ mm");for(var n=0;n<e;n++){var o=a.clone(!0);o.prop("id","steppermap-"+n),o.removeClass("hidden"),o.find("label").text("T"+n+":"),o.find("input").each((function(){$(this).prop("id","Revolver"+$(this).prop("name")+n),$(this).attr("data-section","S7"),$(this).removeAttr("data-subsection"),$(this).attr("max","10"),$(this).attr("step","0.1"),void 0!==stepperMappings[n]&&$(this).val(stepperMappings[n].toFixed(1))})),t.append(o)}}}function setupLiveControl(){var e=getToolCount();if(-1!=e){var t=$("#lvc-slot-container");t.empty();var a=$("#lvc-slot-template"),n=0,o=new Array,i=new Array;$(a).find('span[id="lvc-in-splitter"] >i').each((function(){o[n]=$(this).attr("data-bs-original-title"),i[n++]=$(this).attr("data-bs-placement")}));for(var r=e-2;r>0;r--){var s=a.clone(!0);s.prop("id","lvc-t-"+r),s.removeClass("hidden");var l=s.find('span[id="lvc-tool"]');l.prop("id","lvc-tool-"+r).data("tool",r),l.attr("data-bs-original-title","T"+r).tooltip("update"),(l=s.find('span[id="lvc-led"]')).prop("id","lvc-led-"+r),(l=s.find('img[id="lvc-fitting"]')).prop("id","lvc-fitting-"+r),l.attr("data-bs-original-title","Load/Unload").tooltip("update"),(l=s.find('span[id="lvc-in-splitter"]')).prop("id","lvc-in-splitter-"+r),n=0,l.find("i").each((function(){$(this).attr("data-bs-original-title",o[n]),$(this).attr("data-bs-placement",i[n++]).tooltip("update")})),t.append(s)}a.removeClass("d-flex").addClass("hidden");var c=e-1;$("#lvc-tool-Max").prop("id","lvc-tool-"+c).data("tool",c.toString()).attr("data-bs-original-title","T"+c).tooltip("update"),$("#lvc-led-Max").prop("id","lvc-led-"+c),$("#lvc-fitting-Max").prop("id","lvc-fitting-"+c),$("#lvc-in-splitter-Max").prop("id","lvc-in-splitter-"+c),$("#lvc-rod").width(e*$("#lvc-slot-template").width()),$('span[id^="lvc-tool-"]').unbind("click");$('span[id^="lvc-tool-"]').on("click",(function(){var e=$(this).prop("id").substring(9);moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val("T"+e).trigger("change")}))}}function setupSwaps(){var e=getToolCount();if(-1!=e){var t=$("#swap-tools-container #slots ul"),a=$("#swap-tools-container #tools ul");t.empty(),a.empty();for(var n=0;n<e;n++){var o=$("#slot-item-template").clone(!0);o.append("<span>Slot "+n+":</span>"),o.append('<span class="slot-tool-color">'+(""!=toolColors[n]?"(":"")+toolColors[n]+(""!=toolColors[n]?")":"")+"</span>"),o.attr("id","slot"+n),t.append(o);var i=$("#swap-item-template").clone(!0);i.text(i.text()+(void 0===swapTools[n]?n:swapTools[n])),i.attr("id","swap-tool"+n),i.attr("data-id","st-"+swapTools[n]),i.css("cursor","grab"),i.append('<i class="fa fa-reorder"></i>'),a.append(i)}}}var port,textEncoder,writableStream,writer,readableStream,reader,current_fs,next_fs,previous_fs,left,opacity,scale,animating;async function connectSerial(e=115200){try{port=await navigator.serial.requestPort(),showInfo(openingPort),await port.open({baudRate:e,bufferSize:64}).then((function(){$("#info-message").html(serialPortOpen),textEncoder=new TextEncoderStream,writableStream=textEncoder.readable.pipeTo(port.writable),writer=textEncoder.writable.getWriter(),listenToSerial(),connectHandler()}))}catch{cancelInfo(),showConnectingMessage("fast",serialConnectionFail,null)}}async function disconnectSerial(){try{reader&&(await reader.cancel(),await readableStream.catch((()=>{})),reader=null,readableStream=null),writer&&(await writer.close(),await writableStream,writer=null,writableStream=null),port&&(await port.close(),port=null)}catch(e){console.log(e)}}async function listenToSerial(){const e=new TextDecoderStream;readableStream=port.readable.pipeTo(e.writable),reader=e.readable.getReader(),portListener=!0;try{for(var t="";;){const{value:e,done:o}=await reader.read();if(e)-1!=e.indexOf("")&&(pauseTransmission=!0,console.log("XOff"),t+=e.replaceAll("","")),-1!=e.indexOf("")?(pauseTransmission=!1,console.log("XOn"),t+=e.replaceAll("","")):t+=e;for(;t.length;){var a=t.indexOf("\n");if(-1==a)break;var n=t.substring(0,a);await parseResponse(n),collectResponse&&"ok"!=n&&(responseBuffer+=n+"\n"),t=t.substring(a+1)}if(o){reader.releaseLock();break}}}catch(e){console.log(e),disconnectSerial()}portListener=!1,showConnect()}async function writeWebSerial(e){await writer.write(e)}$(document).ready((function(){$("#Tools").on("change",(function(){var e=getToolCount(),t=$("#tool-selection");t.empty(),t.append('<option value="-1">T--</option>');for(var a=0;a<e;a++)t.append('<option value="T'+a+'">T'+a+"</option>");for(a=MAX_TOOLS-1;a>=e;a--)$("#tst-t"+a).parent().hide();setupMaterials(),hasV6S||setupServoMappings(),setupLiveControl(),setupSwaps(),hasV6S&&setupStepperMappings()})),$("#SpdsInMms").on("click",(function(){setTimeout((function(){recalculateSpeeds()}),750)})),$("#Feeder-SharedStepper").on("change",(function(){setDisabled(!(hasSharedStepper=$(this).is(":checked")),".hasSharedStepper"),setDisabled(!hasSharedStepper,".hasNotExtCtrl")})),$("#Feeder-UseEStop2").on("change",(function(){setDisabled(!$(this).is(":checked"),".has2ndEndstop")})),$("#Feeder-ExtCtrl").on("change",(function(){hasExtCtrl=$(this).is(":checked"),hasDDE||hasSharedStepper||setDisabled(hasExtCtrl,".hasNotExtCtrl")})),$("#UseCutter").on("change",(function(){setDisabled(!$(this).is(":checked"),".hasCutter")})),$("#Revolver-UseServo").on("change",(function(){hasV6S&&$(this).removeAttr("checked"),setDisabled(!$(this).is(":checked"),".hasServo"),hasV6S||setDisabled(!$(this).is(":checked"),".hasServoOpt")})),$("#InvRelay").on("change",(function(){initDone&&setTimeout((async function(){sendGcode("M17",!0,!1),await getResponse()}),500)})),$("#Selector-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Selector-TMC-Params").show("slow"),$("#Selector-MS3").val(0).trigger("change")):$("#Selector-TMC-Params").hide("slow")})),$("#Feeder-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Feeder-TMC-Params").show("slow"),$("#Feeder-MS3").val(0).trigger("change")):$("#Feeder-TMC-Params").hide("slow")})),$("#Revolver-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Revolver-TMC-Params").show("slow"),$("#Revolver-MS3").val(0).trigger("change"),hasDDE||$("#Revolver-UseServo").prop("checked",!1).trigger("change")):$("#Revolver-TMC-Params").hide("slow")})),$("#Selector-MS3").on("change",(function(){$(this).val()>0&&$("#Selector-TMC-Mode").val(0).trigger("change")})),$("#Feeder-MS3").on("change",(function(){$(this).val()>0&&$("#Feeder-TMC-Mode").val(0).trigger("change")})),$("#Revolver-MS3").on("change",(function(){$(this).val()>0&&$("#Revolver-TMC-Mode").val(0).trigger("change")}))}));class Upload{constructor(){}doUpload(e,t,a,n,o){var i=new FormData(e);$.ajax({type:"POST",url:t,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",a,!1),e},success:function(e){null!=n&&n(e)},error:function(e){null!=o&&o(e)},async:!0,data:i,cache:!1,contentType:!1,processData:!1,timeout:6e4})}}function resetWizard(){$("#msform fieldset").each((function(){$(this).css("opacity",0),$(this).css("transform","scale(1)"),$(this).css("display","none")})),previous_fs=null,next_fs=null,$("#progressbar li").removeClass("active"),(current_fs=$("#fs-welcome")).css("opacity",1),current_fs.css("transform","scale(1)"),current_fs.css("display","block"),$("#progressbar li").eq($("fieldset").index(current_fs)).addClass("active")}$(document).ready((function(){$("#wizard-modal .next.action-button").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),next_fs=$(this).parent().next(),$("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active"),next_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=1-.2*(1-e),left=50*e+"%",opacity=1-e,current_fs.css({transform:"scale("+scale+")"}),next_fs.css({left:left,opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})})),$("#wizard-modal .previous.action-button").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),previous_fs=$(this).parent().prev(),$("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active"),previous_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=.8+.2*(1-e),left=50*(1-e)+"%",opacity=1-e,current_fs.css({left:left}),previous_fs.css({transform:"scale("+scale+")",opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})})),$("#wizard-modal .cancel").click((function(){hideWizard(),resetWizard(),$("#wizard-disable").is(":checked")&&(localStorage.setItem("ShowWizard",never),localStorage.setItem("LastWizardDevice",$("#devname-label").text()))})),$("#wizard-modal .submit").click((function(){return hideWizard(),localStorage.setItem("ShowWizard",no),localStorage.setItem("LastWizardDevice",$("#wizard-device").val()),storeWizard(),resetWizard(),!1})),$("input:checkbox[name^=wizard-]").change((function(){var e=$(this).is(":checked")?yes:no;$(this).parent().parent().next().text(e),"wizard-is-marlin"==$(this).prop("name")&&e==yes&&($("#wizard-is-duet").prop("checked",""),$("#wizard-is-pmmu").prop("checked",""),$("#wizard-is-duet").parent().parent().next().text(no),$("#wizard-is-pmmu").parent().parent().next().text(no)),"wizard-is-pmmu"==$(this).prop("name")&&e==yes&&($("#wizard-is-duet").prop("checked",""),$("#wizard-is-marlin").prop("checked",""),$("#wizard-is-duet").parent().parent().next().text(no),$("#wizard-is-marlin").parent().parent().next().text(no)),"wizard-is-duet"==$(this).prop("name")&&e==yes&&($("#wizard-is-pmmu").prop("checked",""),$("#wizard-is-marlin").prop("checked",""),$("#wizard-is-marlin").parent().parent().next().text(no),$("#wizard-is-pmmu").parent().parent().next().text(no)),$("#wizard-is-pmmu").is(":checked")||$("#wizard-is-marlin").is(":checked")||$("#wizard-is-duet").is(":checked")||($("#wizard-is-marlin").prop("checked","checked"),$("#wizard-is-marlin").parent().parent().next().text(yes))}))}));