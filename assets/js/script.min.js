window.innerWidth<768&&[].slice.call(document.querySelectorAll("[data-bss-disabled-mobile]")).forEach((function(e){e.classList.remove("animated"),e.removeAttribute("data-bss-hover-animate"),e.removeAttribute("data-aos")})),document.addEventListener("DOMContentLoaded",(function(){[].slice.call(document.querySelectorAll("[data-bss-tooltip]")).map((function(e){return new bootstrap.Tooltip(e)}));var e=document.querySelectorAll('[data-bs-toggle="toast"]');for(var t of e)t.addEventListener("click",(function(){var e=t.getAttribute("data-bs-target");if(e)try{var o=document.querySelector(e);if(!o)return;new bootstrap.Toast(o).show()}catch(e){console.error(e)}}))}),!1),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Sortable=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})))),n.forEach((function(t){var n,a,i;n=e,i=o[a=t],a in n?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i}))}return e}function n(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],0<=t.indexOf(o)||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],0<=t.indexOf(o)||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var s=i(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),r=i(/Edge/i),l=i(/firefox/i),c=i(/safari/i)&&!i(/chrome/i)&&!i(/android/i),d=i(/iP(ad|od|hone)/i),u=i(/chrome/i)&&i(/android/i),p={capture:!1,passive:!1};function h(e,t,o){e.addEventListener(t,o,!s&&p)}function f(e,t,o){e.removeEventListener(t,o,!s&&p)}function g(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function v(e,t,o,n){if(e){o=o||document;do{if(null!=t&&(">"===t[0]?e.parentNode===o&&g(e,t):g(e,t))||n&&e===o)return e;if(e===o)break}while(e=(a=e).host&&a!==document&&a.host.nodeType?a.host:a.parentNode)}var a;return null}var m,b=/\s+/g;function w(e,t,o){if(e&&t)if(e.classList)e.classList[o?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(b," ").replace(" "+t+" "," ");e.className=(n+(o?" "+t:"")).replace(b," ")}}function $(e,t,o){var n=e&&e.style;if(n){if(void 0===o)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(o=e.currentStyle),void 0===t?o:o[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=o+("string"==typeof o?"":"px")}}function S(e,t){var o="";if("string"==typeof e)o=e;else do{var n=$(e,"transform");n&&"none"!==n&&(o=n+" "+o)}while(!t&&(e=e.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(o)}function C(e,t,o){if(e){var n=e.getElementsByTagName(t),a=0,i=n.length;if(o)for(;a<i;a++)o(n[a],a);return n}return[]}function y(){return document.scrollingElement||document.documentElement}function T(e,t,o,n,a){if(e.getBoundingClientRect||e===window){var i,r,l,c,d,u,p;if(p=e!==window&&e.parentNode&&e!==y()?(r=(i=e.getBoundingClientRect()).top,l=i.left,c=i.bottom,d=i.right,u=i.height,i.width):(l=r=0,c=window.innerHeight,d=window.innerWidth,u=window.innerHeight,window.innerWidth),(t||o)&&e!==window&&(a=a||e.parentNode,!s))do{if(a&&a.getBoundingClientRect&&("none"!==$(a,"transform")||o&&"static"!==$(a,"position"))){var h=a.getBoundingClientRect();r-=h.top+parseInt($(a,"border-top-width")),l-=h.left+parseInt($(a,"border-left-width")),c=r+i.height,d=l+i.width;break}}while(a=a.parentNode);if(n&&e!==window){var f=S(a||e),g=f&&f.a,v=f&&f.d;f&&(c=(r/=v)+(u/=v),d=(l/=g)+(p/=g))}return{top:r,left:l,bottom:c,right:d,width:p,height:u}}}function k(e,t,o){for(var n=E(e,!0),a=T(e)[t];n;){var i=T(n)[o];if(!("top"===o||"left"===o?i<=a:a<=i))return n;if(n===y())break;n=E(n,!1)}return!1}function M(e,t,o){for(var n=0,a=0,i=e.children;a<i.length;){if("none"!==i[a].style.display&&i[a]!==_e.ghost&&i[a]!==_e.dragged&&v(i[a],o.draggable,e,!1)){if(n===t)return i[a];n++}a++}return null}function D(e,t){for(var o=e.lastElementChild;o&&(o===_e.ghost||"none"===$(o,"display")||t&&!g(o,t));)o=o.previousElementSibling;return o||null}function x(e,t){var o=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===_e.clone||t&&!g(e,t)||o++;return o}function I(e){var t=0,o=0,n=y();if(e)do{var a=S(e),i=a.a,s=a.d;t+=e.scrollLeft*i,o+=e.scrollTop*s}while(e!==n&&(e=e.parentNode));return[t,o]}function E(e,t){if(!e||!e.getBoundingClientRect)return y();var o=e,n=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var a=$(o);if(o.clientWidth<o.scrollWidth&&("auto"==a.overflowX||"scroll"==a.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==a.overflowY||"scroll"==a.overflowY)){if(!o.getBoundingClientRect||o===document.body)return y();if(n||t)return o;n=!0}}}while(o=o.parentNode);return y()}function O(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function F(e,t){return function(){if(!m){var o=arguments;1===o.length?e.call(this,o[0]):e.apply(this,o),m=setTimeout((function(){m=void 0}),t)}}}function W(e,t,o){e.scrollLeft+=t,e.scrollTop+=o}function _(e){var t=window.Polymer,o=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):o?o(e).clone(!0)[0]:e.cloneNode(!0)}function A(e,t){$(e,"position","absolute"),$(e,"top",t.top),$(e,"left",t.left),$(e,"width",t.width),$(e,"height",t.height)}function R(e){$(e,"position",""),$(e,"top",""),$(e,"left",""),$(e,"width",""),$(e,"height","")}var P="Sortable"+(new Date).getTime();var N=[],z={initializeByDefault:!0},L={mount:function(e){for(var t in z)!z.hasOwnProperty(t)||t in e||(e[t]=z[t]);N.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),N.push(e)},pluginEvent:function(e,t,n){var a=this;this.eventCanceled=!1,n.cancel=function(){a.eventCanceled=!0};var i=e+"Global";N.forEach((function(a){t[a.pluginName]&&(t[a.pluginName][i]&&t[a.pluginName][i](o({sortable:t},n)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](o({sortable:t},n)))}))},initializePlugins:function(e,o,n,a){for(var i in N.forEach((function(a){var i=a.pluginName;if(e.options[i]||a.initializeByDefault){var s=new a(e,o,e.options);s.sortable=e,s.options=e.options,e[i]=s,t(n,s.defaults)}})),e.options)if(e.options.hasOwnProperty(i)){var s=this.modifyOption(e,i,e.options[i]);void 0!==s&&(e.options[i]=s)}},getEventProperties:function(e,o){var n={};return N.forEach((function(a){"function"==typeof a.eventProperties&&t(n,a.eventProperties.call(o[a.pluginName],e))})),n},modifyOption:function(e,t,o){var n;return N.forEach((function(a){e[a.pluginName]&&a.optionListeners&&"function"==typeof a.optionListeners[t]&&(n=a.optionListeners[t].call(e[a.pluginName],o))})),n}};function U(e){var t=e.sortable,n=e.rootEl,a=e.name,i=e.targetEl,l=e.cloneEl,c=e.toEl,d=e.fromEl,u=e.oldIndex,p=e.newIndex,h=e.oldDraggableIndex,f=e.newDraggableIndex,g=e.originalEvent,v=e.putSortable,m=e.extraEventProperties;if(t=t||n&&n[P]){var b,w=t.options,$="on"+a.charAt(0).toUpperCase()+a.substr(1);!window.CustomEvent||s||r?(b=document.createEvent("Event")).initEvent(a,!0,!0):b=new CustomEvent(a,{bubbles:!0,cancelable:!0}),b.to=c||n,b.from=d||n,b.item=i||n,b.clone=l,b.oldIndex=u,b.newIndex=p,b.oldDraggableIndex=h,b.newDraggableIndex=f,b.originalEvent=g,b.pullMode=v?v.lastPutMode:void 0;var S=o({},m,L.getEventProperties(a,t));for(var C in S)b[C]=S[C];n&&n.dispatchEvent(b),w[$]&&w[$].call(t,b)}}function G(e,t,a){var i=2<arguments.length&&void 0!==a?a:{},s=i.evt,r=n(i,["evt"]);L.pluginEvent.bind(_e)(e,t,o({dragEl:V,parentEl:X,ghostEl:H,rootEl:Y,nextEl:q,lastDownEl:K,cloneEl:j,cloneHidden:Z,dragStarted:de,putSortable:ne,activeSortable:_e.active,originalEvent:s,oldIndex:J,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te,hideGhostForTarget:Ee,unhideGhostForTarget:Oe,cloneNowHidden:function(){Z=!0},cloneNowShown:function(){Z=!1},dispatchSortableEvent:function(e){B({sortable:t,name:e,originalEvent:s})}},r))}function B(e){U(o({putSortable:ne,cloneEl:j,targetEl:V,rootEl:Y,oldIndex:J,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te},e))}var V,X,H,Y,q,K,j,Z,J,Q,ee,te,oe,ne,ae,ie,se,re,le,ce,de,ue,pe,he,fe,ge=!1,ve=!1,me=[],be=!1,we=!1,$e=[],Se=!1,Ce=[],ye="undefined"!=typeof document,Te=d,ke=r||s?"cssFloat":"float",Me=ye&&!u&&!d&&"draggable"in document.createElement("div"),De=function(){if(ye){if(s)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),xe=function(e,t){var o=$(e),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),a=M(e,0,t),i=M(e,1,t),s=a&&$(a),r=i&&$(i),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+T(a).width,c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+T(i).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if("grid"===o.display)return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&s.float&&"none"!==s.float){var d="left"===s.float?"left":"right";return!i||"both"!==r.clear&&r.clear!==d?"horizontal":"vertical"}return a&&("block"===s.display||"flex"===s.display||"table"===s.display||"grid"===s.display||n<=l&&"none"===o[ke]||i&&"none"===o[ke]&&n<l+c)?"vertical":"horizontal"},Ie=function(t){function o(e,t){return function(n,a,i,s){var r=n.options.group.name&&a.options.group.name&&n.options.group.name===a.options.group.name;if(null==e&&(t||r))return!0;if(null==e||!1===e)return!1;if(t&&"clone"===e)return e;if("function"==typeof e)return o(e(n,a,i,s),t)(n,a,i,s);var l=(t?n:a).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&-1<e.indexOf(l)}}var n={},a=t.group;a&&"object"==e(a)||(a={name:a}),n.name=a.name,n.checkPull=o(a.pull,!0),n.checkPut=o(a.put),n.revertClone=a.revertClone,t.group=n},Ee=function(){!De&&H&&$(H,"display","none")},Oe=function(){!De&&H&&$(H,"display","")};function Fe(e){if(V){var t=function(e,t){var o;return me.some((function(n){if(!D(n)){var a=T(n),i=n[P].options.emptyInsertThreshold,s=e>=a.left-i&&e<=a.right+i,r=t>=a.top-i&&t<=a.bottom+i;return i&&s&&r?o=n:void 0}})),o}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var o={};for(var n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);o.target=o.rootEl=t,o.preventDefault=void 0,o.stopPropagation=void 0,t[P]._onDragOver(o)}}}function We(e){V&&V.parentNode[P]._isOutsideThisEl(e.target)}function _e(e,n){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=n=t({},n),e[P]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return xe(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==_e.supportPointer&&"PointerEvent"in window&&!c,emptyInsertThreshold:5};for(var i in L.initializePlugins(this,e,a),a)i in n||(n[i]=a[i]);for(var s in Ie(n),this)"_"===s.charAt(0)&&"function"==typeof this[s]&&(this[s]=this[s].bind(this));this.nativeDraggable=!n.forceFallback&&Me,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?h(e,"pointerdown",this._onTapStart):(h(e,"mousedown",this._onTapStart),h(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(h(e,"dragover",this),h(e,"dragenter",this)),me.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),t(this,function(){var e,t=[];return{captureAnimationState:function(){t=[],this.options.animation&&[].slice.call(this.el.children).forEach((function(e){if("none"!==$(e,"display")&&e!==_e.ghost){t.push({target:e,rect:T(e)});var n=o({},t[t.length-1].rect);if(e.thisAnimationDuration){var a=S(e,!0);a&&(n.top-=a.f,n.left-=a.e)}e.fromRect=n}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var o in e)if(e.hasOwnProperty(o))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[o][n])return Number(o);return-1}(t,{target:e}),1)},animateAll:function(o){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof o&&o());var a=!1,i=0;t.forEach((function(e){var t=0,o=e.target,s=o.fromRect,r=T(o),l=o.prevFromRect,c=o.prevToRect,d=e.rect,u=S(o,!0);u&&(r.top-=u.f,r.left-=u.e),o.toRect=r,o.thisAnimationDuration&&O(l,r)&&!O(s,r)&&(d.top-r.top)/(d.left-r.left)==(s.top-r.top)/(s.left-r.left)&&(t=function(e,t,o,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-o.top,2)+Math.pow(t.left-o.left,2))*n.animation}(d,l,c,n.options)),O(r,s)||(o.prevFromRect=s,o.prevToRect=r,t||(t=n.options.animation),n.animate(o,d,r,t)),t&&(a=!0,i=Math.max(i,t),clearTimeout(o.animationResetTimer),o.animationResetTimer=setTimeout((function(){o.animationTime=0,o.prevFromRect=null,o.fromRect=null,o.prevToRect=null,o.thisAnimationDuration=null}),t),o.thisAnimationDuration=t)})),clearTimeout(e),a?e=setTimeout((function(){"function"==typeof o&&o()}),i):"function"==typeof o&&o(),t=[]},animate:function(e,t,o,n){if(n){$(e,"transition",""),$(e,"transform","");var a=S(this.el),i=a&&a.a,s=a&&a.d,r=(t.left-o.left)/(i||1),l=(t.top-o.top)/(s||1);e.animatingX=!!r,e.animatingY=!!l,$(e,"transform","translate3d("+r+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),$(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),$(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){$(e,"transition",""),$(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),n)}}}}())}function Ae(e,t,o,n,a,i,l,c){var d,u,p=e[P],h=p.options.onMove;return!window.CustomEvent||s||r?(d=document.createEvent("Event")).initEvent("move",!0,!0):d=new CustomEvent("move",{bubbles:!0,cancelable:!0}),d.to=t,d.from=e,d.dragged=o,d.draggedRect=n,d.related=a||t,d.relatedRect=i||T(t),d.willInsertAfter=c,d.originalEvent=l,e.dispatchEvent(d),h&&(u=h.call(p,d,l)),u}function Re(e){e.draggable=!1}function Pe(){Se=!1}function Ne(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,o=t.length,n=0;o--;)n+=t.charCodeAt(o);return n.toString(36)}function ze(e){return setTimeout(e,0)}function Le(e){return clearTimeout(e)}ye&&document.addEventListener("click",(function(e){if(ve)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),ve=!1}),!0),_e.prototype={constructor:_e,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(ue=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,V):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,o=this.el,n=this.options,a=n.preventOnFilter,i=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,r=(s||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,d=n.filter;if(function(e){Ce.length=0;for(var t=e.getElementsByTagName("input"),o=t.length;o--;){var n=t[o];n.checked&&Ce.push(n)}}(o),!V&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||n.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!c||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=v(r,n.draggable,o,!1))&&r.animated||K===r)){if(J=x(r),ee=x(r,n.draggable),"function"==typeof d){if(d.call(this,e,r,this))return B({sortable:t,rootEl:l,name:"filter",targetEl:r,toEl:o,fromEl:o}),G("filter",t,{evt:e}),void(a&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(n){if(n=v(l,n.trim(),o,!1))return B({sortable:t,rootEl:n,name:"filter",targetEl:r,fromEl:o,toEl:o}),G("filter",t,{evt:e}),!0}))))return void(a&&e.cancelable&&e.preventDefault());n.handle&&!v(l,n.handle,o,!1)||this._prepareDragStart(e,s,r)}}},_prepareDragStart:function(e,t,o){var n,a=this,i=a.el,c=a.options,d=i.ownerDocument;if(o&&!V&&o.parentNode===i){var u=T(o);if(Y=i,X=(V=o).parentNode,q=V.nextSibling,K=o,oe=c.group,ae={target:_e.dragged=V,clientX:(t||e).clientX,clientY:(t||e).clientY},le=ae.clientX-u.left,ce=ae.clientY-u.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,V.style["will-change"]="all",n=function(){G("delayEnded",a,{evt:e}),_e.eventCanceled?a._onDrop():(a._disableDelayedDragEvents(),!l&&a.nativeDraggable&&(V.draggable=!0),a._triggerDragStart(e,t),B({sortable:a,name:"choose",originalEvent:e}),w(V,c.chosenClass,!0))},c.ignore.split(",").forEach((function(e){C(V,e.trim(),Re)})),h(d,"dragover",Fe),h(d,"mousemove",Fe),h(d,"touchmove",Fe),h(d,"mouseup",a._onDrop),h(d,"touchend",a._onDrop),h(d,"touchcancel",a._onDrop),l&&this.nativeDraggable&&(this.options.touchStartThreshold=4,V.draggable=!0),G("delayStart",this,{evt:e}),!c.delay||c.delayOnTouchOnly&&!t||this.nativeDraggable&&(r||s))n();else{if(_e.eventCanceled)return void this._onDrop();h(d,"mouseup",a._disableDelayedDrag),h(d,"touchend",a._disableDelayedDrag),h(d,"touchcancel",a._disableDelayedDrag),h(d,"mousemove",a._delayedDragTouchMoveHandler),h(d,"touchmove",a._delayedDragTouchMoveHandler),c.supportPointer&&h(d,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(n,c.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){V&&Re(V),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;f(e,"mouseup",this._disableDelayedDrag),f(e,"touchend",this._disableDelayedDrag),f(e,"touchcancel",this._disableDelayedDrag),f(e,"mousemove",this._delayedDragTouchMoveHandler),f(e,"touchmove",this._delayedDragTouchMoveHandler),f(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?h(document,"pointermove",this._onTouchMove):h(document,t?"touchmove":"mousemove",this._onTouchMove):(h(V,"dragend",this),h(Y,"dragstart",this._onDragStart));try{document.selection?ze((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(ge=!1,Y&&V){G("dragStarted",this,{evt:t}),this.nativeDraggable&&h(document,"dragover",We);var o=this.options;e||w(V,o.dragClass,!1),w(V,o.ghostClass,!0),_e.active=this,e&&this._appendGhost(),B({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ie){this._lastX=ie.clientX,this._lastY=ie.clientY,Ee();for(var e=document.elementFromPoint(ie.clientX,ie.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ie.clientX,ie.clientY))!==t;)t=e;if(V.parentNode[P]._isOutsideThisEl(e),t)do{if(t[P]&&t[P]._onDragOver({clientX:ie.clientX,clientY:ie.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;e=t}while(t=t.parentNode);Oe()}},_onTouchMove:function(e){if(ae){var t=this.options,o=t.fallbackTolerance,n=t.fallbackOffset,a=e.touches?e.touches[0]:e,i=H&&S(H,!0),s=H&&i&&i.a,r=H&&i&&i.d,l=Te&&fe&&I(fe),c=(a.clientX-ae.clientX+n.x)/(s||1)+(l?l[0]-$e[0]:0)/(s||1),d=(a.clientY-ae.clientY+n.y)/(r||1)+(l?l[1]-$e[1]:0)/(r||1);if(!_e.active&&!ge){if(o&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(H){i?(i.e+=c-(se||0),i.f+=d-(re||0)):i={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");$(H,"webkitTransform",u),$(H,"mozTransform",u),$(H,"msTransform",u),$(H,"transform",u),se=c,re=d,ie=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!H){var e=this.options.fallbackOnBody?document.body:Y,t=T(V,!0,Te,!0,e),o=this.options;if(Te){for(fe=e;"static"===$(fe,"position")&&"none"===$(fe,"transform")&&fe!==document;)fe=fe.parentNode;fe!==document.body&&fe!==document.documentElement?(fe===document&&(fe=y()),t.top+=fe.scrollTop,t.left+=fe.scrollLeft):fe=y(),$e=I(fe)}w(H=V.cloneNode(!0),o.ghostClass,!1),w(H,o.fallbackClass,!0),w(H,o.dragClass,!0),$(H,"transition",""),$(H,"transform",""),$(H,"box-sizing","border-box"),$(H,"margin",0),$(H,"top",t.top),$(H,"left",t.left),$(H,"width",t.width),$(H,"height",t.height),$(H,"opacity","0.8"),$(H,"position",Te?"absolute":"fixed"),$(H,"zIndex","100000"),$(H,"pointerEvents","none"),_e.ghost=H,e.appendChild(H),$(H,"transform-origin",le/parseInt(H.style.width)*100+"% "+ce/parseInt(H.style.height)*100+"%")}},_onDragStart:function(e,t){var o=this,n=e.dataTransfer,a=o.options;G("dragStart",this,{evt:e}),_e.eventCanceled?this._onDrop():(G("setupClone",this),_e.eventCanceled||((j=_(V)).draggable=!1,j.style["will-change"]="",this._hideClone(),w(j,this.options.chosenClass,!1),_e.clone=j),o.cloneId=ze((function(){G("clone",o),_e.eventCanceled||(o.options.removeCloneOnHide||Y.insertBefore(j,V),o._hideClone(),B({sortable:o,name:"clone"}))})),t||w(V,a.dragClass,!0),t?(ve=!0,o._loopId=setInterval(o._emulateDragOver,50)):(f(document,"mouseup",o._onDrop),f(document,"touchend",o._onDrop),f(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",a.setData&&a.setData.call(o,n,V)),h(document,"drop",o),$(V,"transform","translateZ(0)")),ge=!0,o._dragStartId=ze(o._dragStarted.bind(o,t,e)),h(document,"selectstart",o),de=!0,c&&$(document.body,"user-select","none"))},_onDragOver:function(e){var t,n,a,i,s=this.el,r=e.target,l=this.options,c=l.group,d=_e.active,u=oe===c,p=l.sort,h=ne||d,f=this,g=!1;if(!Se){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),r=v(r,l.draggable,s,!0),N("dragOver"),_e.eventCanceled)return g;if(V.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||f._ignoreWhileAnimating===r)return L(!1);if(ve=!1,d&&!l.disabled&&(u?p||(a=!Y.contains(V)):ne===this||(this.lastPutMode=oe.checkPull(this,d,V,e))&&c.checkPut(this,d,V,e))){if(i="vertical"===this._getDirection(e,r),t=T(V),N("dragOverValid"),_e.eventCanceled)return g;if(a)return X=Y,z(),this._hideClone(),N("revert"),_e.eventCanceled||(q?Y.insertBefore(V,q):Y.appendChild(V)),L(!0);var m=D(s,l.draggable);if(!m||function(e,t,o){var n=T(D(o.el,o.options.draggable));return t?e.clientX>n.right+10||e.clientX<=n.right&&e.clientY>n.bottom&&e.clientX>=n.left:e.clientX>n.right&&e.clientY>n.top||e.clientX<=n.right&&e.clientY>n.bottom+10}(e,i,this)&&!m.animated){if(m===V)return L(!1);if(m&&s===e.target&&(r=m),r&&(n=T(r)),!1!==Ae(Y,s,V,t,r,n,e,!!r))return z(),s.appendChild(V),X=s,U(),L(!0)}else if(r.parentNode===s){n=T(r);var b,S,C,y=V.parentNode!==s,M=!function(e,t,o){var n=o?e.left:e.top,a=o?e.right:e.bottom,i=o?e.width:e.height,s=o?t.left:t.top,r=o?t.right:t.bottom,l=o?t.width:t.height;return n===s||a===r||n+i/2===s+l/2}(V.animated&&V.toRect||t,r.animated&&r.toRect||n,i),I=i?"top":"left",E=k(r,"top","top")||k(V,"top","top"),O=E?E.scrollTop:void 0;if(ue!==r&&(S=n[I],be=!1,we=!M&&l.invertSwap||y),0!==(b=function(e,t,o,n,a,i,s,r){var l=n?e.clientY:e.clientX,c=n?o.height:o.width,d=n?o.top:o.left,u=n?o.bottom:o.right,p=!1;if(!s)if(r&&he<c*a){if(!be&&(1===pe?d+c*i/2<l:l<u-c*i/2)&&(be=!0),be)p=!0;else if(1===pe?l<d+he:u-he<l)return-pe}else if(d+c*(1-a)/2<l&&l<u-c*(1-a)/2)return function(e){return x(V)<x(e)?1:-1}(t);return(p=p||s)&&(l<d+c*i/2||u-c*i/2<l)?d+c/2<l?1:-1:0}(e,r,n,i,M?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,we,ue===r)))for(var F=x(V);F-=b,(C=X.children[F])&&("none"===$(C,"display")||C===H););if(0===b||C===r)return L(!1);pe=b;var _=(ue=r).nextElementSibling,A=!1,R=Ae(Y,s,V,t,r,n,e,A=1===b);if(!1!==R)return 1!==R&&-1!==R||(A=1===R),Se=!0,setTimeout(Pe,30),z(),A&&!_?s.appendChild(V):r.parentNode.insertBefore(V,A?_:r),E&&W(E,0,O-E.scrollTop),X=V.parentNode,void 0===S||we||(he=Math.abs(S-T(r)[I])),U(),L(!0)}if(s.contains(V))return L(!1)}return!1}function N(l,c){G(l,f,o({evt:e,isOwner:u,axis:i?"vertical":"horizontal",revert:a,dragRect:t,targetRect:n,canSort:p,fromSortable:h,target:r,completed:L,onMove:function(o,n){return Ae(Y,s,V,t,o,T(o),e,n)},changed:U},c))}function z(){N("dragOverAnimationCapture"),f.captureAnimationState(),f!==h&&h.captureAnimationState()}function L(t){return N("dragOverCompleted",{insertion:t}),t&&(u?d._hideClone():d._showClone(f),f!==h&&(w(V,ne?ne.options.ghostClass:d.options.ghostClass,!1),w(V,l.ghostClass,!0)),ne!==f&&f!==_e.active?ne=f:f===_e.active&&ne&&(ne=null),h===f&&(f._ignoreWhileAnimating=r),f.animateAll((function(){N("dragOverAnimationComplete"),f._ignoreWhileAnimating=null})),f!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(r===V&&!V.animated||r===s&&!r.animated)&&(ue=null),l.dragoverBubble||e.rootEl||r===document||(V.parentNode[P]._isOutsideThisEl(e.target),t||Fe(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function U(){Q=x(V),te=x(V,l.draggable),B({sortable:f,name:"change",toEl:s,newIndex:Q,newDraggableIndex:te,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){f(document,"mousemove",this._onTouchMove),f(document,"touchmove",this._onTouchMove),f(document,"pointermove",this._onTouchMove),f(document,"dragover",Fe),f(document,"mousemove",Fe),f(document,"touchmove",Fe)},_offUpEvents:function(){var e=this.el.ownerDocument;f(e,"mouseup",this._onDrop),f(e,"touchend",this._onDrop),f(e,"pointerup",this._onDrop),f(e,"touchcancel",this._onDrop),f(document,"selectstart",this)},_onDrop:function(e){var t=this.el,o=this.options;Q=x(V),te=x(V,o.draggable),G("drop",this,{evt:e}),X=V&&V.parentNode,Q=x(V),te=x(V,o.draggable),_e.eventCanceled||(be=we=ge=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Le(this.cloneId),Le(this._dragStartId),this.nativeDraggable&&(f(document,"drop",this),f(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),c&&$(document.body,"user-select",""),$(V,"transform",""),e&&(de&&(e.cancelable&&e.preventDefault(),o.dropBubble||e.stopPropagation()),H&&H.parentNode&&H.parentNode.removeChild(H),(Y===X||ne&&"clone"!==ne.lastPutMode)&&j&&j.parentNode&&j.parentNode.removeChild(j),V&&(this.nativeDraggable&&f(V,"dragend",this),Re(V),V.style["will-change"]="",de&&!ge&&w(V,ne?ne.options.ghostClass:this.options.ghostClass,!1),w(V,this.options.chosenClass,!1),B({sortable:this,name:"unchoose",toEl:X,newIndex:null,newDraggableIndex:null,originalEvent:e}),Y!==X?(0<=Q&&(B({rootEl:X,name:"add",toEl:X,fromEl:Y,originalEvent:e}),B({sortable:this,name:"remove",toEl:X,originalEvent:e}),B({rootEl:X,name:"sort",toEl:X,fromEl:Y,originalEvent:e}),B({sortable:this,name:"sort",toEl:X,originalEvent:e})),ne&&ne.save()):Q!==J&&0<=Q&&(B({sortable:this,name:"update",toEl:X,originalEvent:e}),B({sortable:this,name:"sort",toEl:X,originalEvent:e})),_e.active&&(null!=Q&&-1!==Q||(Q=J,te=ee),B({sortable:this,name:"end",toEl:X,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){G("nulling",this),Y=V=X=H=q=j=K=Z=ae=ie=de=Q=te=J=ee=ue=pe=ne=oe=_e.dragged=_e.ghost=_e.clone=_e.active=null,Ce.forEach((function(e){e.checked=!0})),Ce.length=se=re=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":V&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],o=this.el.children,n=0,a=o.length,i=this.options;n<a;n++)v(e=o[n],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||Ne(e));return t},sort:function(e,t){var o={},n=this.el;this.toArray().forEach((function(e,t){var a=n.children[t];v(a,this.options.draggable,n,!1)&&(o[e]=a)}),this),t&&this.captureAnimationState(),e.forEach((function(e){o[e]&&(n.removeChild(o[e]),n.appendChild(o[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return v(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var o=this.options;if(void 0===t)return o[e];var n=L.modifyOption(this,e,t);o[e]=void 0!==n?n:t,"group"===e&&Ie(o)},destroy:function(){G("destroy",this);var e=this.el;e[P]=null,f(e,"mousedown",this._onTapStart),f(e,"touchstart",this._onTapStart),f(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(f(e,"dragover",this),f(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),me.splice(me.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Z){if(G("hideClone",this),_e.eventCanceled)return;$(j,"display","none"),this.options.removeCloneOnHide&&j.parentNode&&j.parentNode.removeChild(j),Z=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Z){if(G("showClone",this),_e.eventCanceled)return;V.parentNode!=Y||this.options.group.revertClone?q?Y.insertBefore(j,q):Y.appendChild(j):Y.insertBefore(j,V),this.options.group.revertClone&&this.animate(V,j),$(j,"display",""),Z=!1}}else this._hideClone()}},ye&&h(document,"touchmove",(function(e){(_e.active||ge)&&e.cancelable&&e.preventDefault()})),_e.utils={on:h,off:f,css:$,find:C,is:function(e,t){return!!v(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e},throttle:F,closest:v,toggleClass:w,clone:_,index:x,nextTick:ze,cancelNextTick:Le,detectDirection:xe,getChild:M},_e.get=function(e){return e[P]},_e.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(_e.utils=o({},_e.utils,e.utils)),L.mount(e)}))},_e.create=function(e,t){return new _e(e,t)};var Ue,Ge,Be,Ve,Xe,He,Ye=[],qe=!(_e.version="1.13.0");function Ke(){Ye.forEach((function(e){clearInterval(e.pid)})),Ye=[]}function je(){clearInterval(He)}function Ze(e){var t=e.originalEvent,o=e.putSortable,n=e.dragEl,a=e.activeSortable,i=e.dispatchSortableEvent,s=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var l=o||a;s();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);r(),l&&!l.el.contains(d)&&(i("spill"),this.onSpill({dragEl:n,putSortable:o}))}}var Je,Qe=F((function(e,t,o,n){if(t.scroll){var a,i=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,l=t.scrollSpeed,c=y(),d=!1;Ge!==o&&(Ge=o,Ke(),Ue=t.scroll,a=t.scrollFn,!0===Ue&&(Ue=E(o,!0)));var u=0,p=Ue;do{var h,f=p,g=T(f),v=g.top,m=g.bottom,b=g.left,w=g.right,S=g.width,C=g.height,k=void 0,M=f.scrollWidth,D=f.scrollHeight,x=$(f),I=f.scrollLeft,O=f.scrollTop;h=f===c?(k=S<M&&("auto"===x.overflowX||"scroll"===x.overflowX||"visible"===x.overflowX),C<D&&("auto"===x.overflowY||"scroll"===x.overflowY||"visible"===x.overflowY)):(k=S<M&&("auto"===x.overflowX||"scroll"===x.overflowX),C<D&&("auto"===x.overflowY||"scroll"===x.overflowY));var F=k&&(Math.abs(w-i)<=r&&I+S<M)-(Math.abs(b-i)<=r&&!!I),_=h&&(Math.abs(m-s)<=r&&O+C<D)-(Math.abs(v-s)<=r&&!!O);if(!Ye[u])for(var A=0;A<=u;A++)Ye[A]||(Ye[A]={});Ye[u].vx==F&&Ye[u].vy==_&&Ye[u].el===f||(Ye[u].el=f,Ye[u].vx=F,Ye[u].vy=_,clearInterval(Ye[u].pid),0==F&&0==_||(d=!0,Ye[u].pid=setInterval(function(){n&&0===this.layer&&_e.active._onTouchMove(Xe);var t=Ye[this.layer].vy?Ye[this.layer].vy*l:0,o=Ye[this.layer].vx?Ye[this.layer].vx*l:0;"function"==typeof a&&"continue"!==a.call(_e.dragged.parentNode[P],o,t,e,Xe,Ye[this.layer].el)||W(Ye[this.layer].el,o,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==c&&(p=E(p,!1)));qe=d}}),30);function et(){}function tt(){}et.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var n=M(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),o&&o.animateAll()},drop:Ze},t(et,{pluginName:"revertOnSpill"}),tt.prototype={onSpill:function(e){var t=e.dragEl,o=e.putSortable||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Ze},t(tt,{pluginName:"removeOnSpill"});var ot,nt,at,it,st,rt=[],lt=[],ct=!1,dt=!1,ut=!1;function pt(e,t){lt.forEach((function(o,n){var a=t.children[o.sortableIndex+(e?Number(n):0)];a?t.insertBefore(o,a):t.appendChild(o)}))}function ht(){rt.forEach((function(e){e!==at&&e.parentNode&&e.parentNode.removeChild(e)}))}return _e.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?h(document,"dragover",this._handleAutoScroll):this.options.supportPointer?h(document,"pointermove",this._handleFallbackAutoScroll):t.touches?h(document,"touchmove",this._handleFallbackAutoScroll):h(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?f(document,"dragover",this._handleAutoScroll):(f(document,"pointermove",this._handleFallbackAutoScroll),f(document,"touchmove",this._handleFallbackAutoScroll),f(document,"mousemove",this._handleFallbackAutoScroll)),je(),Ke(),clearTimeout(m),m=void 0},nulling:function(){Xe=Ge=Ue=qe=He=Be=Ve=null,Ye.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var o=this,n=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,i=document.elementFromPoint(n,a);if(Xe=e,t||r||s||c){Qe(e,this.options,i,t);var l=E(i,!0);!qe||He&&n===Be&&a===Ve||(He&&je(),He=setInterval((function(){var i=E(document.elementFromPoint(n,a),!0);i!==l&&(l=i,Ke()),Qe(e,o.options,i,t)}),10),Be=n,Ve=a)}else{if(!this.options.bubbleScroll||E(i,!0)===y())return void Ke();Qe(e,this.options,E(i,!1),!1)}}},t(e,{pluginName:"scroll",initializeByDefault:!0})}),_e.mount(tt,et),_e.mount(new function(){function e(){this.defaults={swapClass:"sortable-swap-highlight"}}return e.prototype={dragStart:function(e){var t=e.dragEl;Je=t},dragOverValid:function(e){var t=e.completed,o=e.target,n=e.onMove,a=e.activeSortable,i=e.changed,s=e.cancel;if(a.options.swap){var r=this.sortable.el,l=this.options;if(o&&o!==r){var c=Je;Je=!1!==n(o)?(w(o,l.swapClass,!0),o):null,c&&c!==Je&&w(c,l.swapClass,!1)}i(),t(!0),s()}},drop:function(e){var t=e.activeSortable,o=e.putSortable,n=e.dragEl,a=o||this.sortable,i=this.options;Je&&w(Je,i.swapClass,!1),Je&&(i.swap||o&&o.options.swap)&&n!==Je&&(a.captureAnimationState(),a!==t&&t.captureAnimationState(),function(e,t){var o,n,a=e.parentNode,i=t.parentNode;a&&i&&!a.isEqualNode(t)&&!i.isEqualNode(e)&&(o=x(e),n=x(t),a.isEqualNode(i)&&o<n&&n++,a.insertBefore(t,a.children[o]),i.insertBefore(e,i.children[n]))}(n,Je),a.animateAll(),a!==t&&t.animateAll())},nulling:function(){Je=null}},t(e,{pluginName:"swap",eventProperties:function(){return{swapItem:Je}}})}),_e.mount(new function(){function e(e){for(var t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));e.options.supportPointer?h(document,"pointerup",this._deselectMultiDrag):(h(document,"mouseup",this._deselectMultiDrag),h(document,"touchend",this._deselectMultiDrag)),h(document,"keydown",this._checkKeyDown),h(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(t,o){var n="";rt.length&&nt===e?rt.forEach((function(e,t){n+=(t?", ":"")+e.textContent})):n=o.textContent,t.setData("Text",n)}}}return e.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(e){var t=e.dragEl;at=t},delayEnded:function(){this.isMultiDrag=~rt.indexOf(at)},setupClone:function(e){var t=e.sortable,o=e.cancel;if(this.isMultiDrag){for(var n=0;n<rt.length;n++)lt.push(_(rt[n])),lt[n].sortableIndex=rt[n].sortableIndex,lt[n].draggable=!1,lt[n].style["will-change"]="",w(lt[n],this.options.selectedClass,!1),rt[n]===at&&w(lt[n],this.options.chosenClass,!1);t._hideClone(),o()}},clone:function(e){var t=e.sortable,o=e.rootEl,n=e.dispatchSortableEvent,a=e.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||rt.length&&nt===t&&(pt(!0,o),n("clone"),a()))},showClone:function(e){var t=e.cloneNowShown,o=e.rootEl,n=e.cancel;this.isMultiDrag&&(pt(!1,o),lt.forEach((function(e){$(e,"display","")})),t(),st=!1,n())},hideClone:function(e){var t=this,o=(e.sortable,e.cloneNowHidden),n=e.cancel;this.isMultiDrag&&(lt.forEach((function(e){$(e,"display","none"),t.options.removeCloneOnHide&&e.parentNode&&e.parentNode.removeChild(e)})),o(),st=!0,n())},dragStartGlobal:function(e){e.sortable,!this.isMultiDrag&&nt&&nt.multiDrag._deselectMultiDrag(),rt.forEach((function(e){e.sortableIndex=x(e)})),rt=rt.sort((function(e,t){return e.sortableIndex-t.sortableIndex})),ut=!0},dragStarted:function(e){var t=this,o=e.sortable;if(this.isMultiDrag){if(this.options.sort&&(o.captureAnimationState(),this.options.animation)){rt.forEach((function(e){e!==at&&$(e,"position","absolute")}));var n=T(at,!1,!0,!0);rt.forEach((function(e){e!==at&&A(e,n)})),ct=dt=!0}o.animateAll((function(){ct=dt=!1,t.options.animation&&rt.forEach((function(e){R(e)})),t.options.sort&&ht()}))}},dragOver:function(e){var t=e.target,o=e.completed,n=e.cancel;dt&&~rt.indexOf(t)&&(o(!1),n())},revert:function(e){var t=e.fromSortable,o=e.rootEl,n=e.sortable,a=e.dragRect;1<rt.length&&(rt.forEach((function(e){n.addAnimationState({target:e,rect:dt?T(e):a}),R(e),e.fromRect=a,t.removeAnimationState(e)})),dt=!1,function(e,t){rt.forEach((function(o,n){var a=t.children[o.sortableIndex+(e?Number(n):0)];a?t.insertBefore(o,a):t.appendChild(o)}))}(!this.options.removeCloneOnHide,o))},dragOverCompleted:function(e){var t=e.sortable,o=e.isOwner,n=e.insertion,a=e.activeSortable,i=e.parentEl,s=e.putSortable,r=this.options;if(n){if(o&&a._hideClone(),ct=!1,r.animation&&1<rt.length&&(dt||!o&&!a.options.sort&&!s)){var l=T(at,!1,!0,!0);rt.forEach((function(e){e!==at&&(A(e,l),i.appendChild(e))})),dt=!0}if(!o)if(dt||ht(),1<rt.length){var c=st;a._showClone(t),a.options.animation&&!st&&c&&lt.forEach((function(e){a.addAnimationState({target:e,rect:it}),e.fromRect=it,e.thisAnimationDuration=null}))}else a._showClone(t)}},dragOverAnimationCapture:function(e){var o=e.dragRect,n=e.isOwner,a=e.activeSortable;if(rt.forEach((function(e){e.thisAnimationDuration=null})),a.options.animation&&!n&&a.multiDrag.isMultiDrag){it=t({},o);var i=S(at,!0);it.top-=i.f,it.left-=i.e}},dragOverAnimationComplete:function(){dt&&(dt=!1,ht())},drop:function(e){var t=e.originalEvent,o=e.rootEl,n=e.parentEl,a=e.sortable,i=e.dispatchSortableEvent,s=e.oldIndex,r=e.putSortable,l=r||this.sortable;if(t){var c=this.options,d=n.children;if(!ut)if(c.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),w(at,c.selectedClass,!~rt.indexOf(at)),~rt.indexOf(at))rt.splice(rt.indexOf(at),1),ot=null,U({sortable:a,rootEl:o,name:"deselect",targetEl:at,originalEvt:t});else{if(rt.push(at),U({sortable:a,rootEl:o,name:"select",targetEl:at,originalEvt:t}),t.shiftKey&&ot&&a.el.contains(ot)){var u,p,h=x(ot),f=x(at);if(~h&&~f&&h!==f)for(u=h<f?(p=h,f):(p=f,h+1);p<u;p++)~rt.indexOf(d[p])||(w(d[p],c.selectedClass,!0),rt.push(d[p]),U({sortable:a,rootEl:o,name:"select",targetEl:d[p],originalEvt:t}))}else ot=at;nt=l}if(ut&&this.isMultiDrag){if((n[P].options.sort||n!==o)&&1<rt.length){var g=T(at),v=x(at,":not(."+this.options.selectedClass+")");if(!ct&&c.animation&&(at.thisAnimationDuration=null),l.captureAnimationState(),!ct&&(c.animation&&(at.fromRect=g,rt.forEach((function(e){if(e.thisAnimationDuration=null,e!==at){var t=dt?T(e):g;e.fromRect=t,l.addAnimationState({target:e,rect:t})}}))),ht(),rt.forEach((function(e){d[v]?n.insertBefore(e,d[v]):n.appendChild(e),v++})),s===x(at))){var m=!1;rt.forEach((function(e){e.sortableIndex===x(e)||(m=!0)})),m&&i("update")}rt.forEach((function(e){R(e)})),l.animateAll()}nt=l}(o===n||r&&"clone"!==r.lastPutMode)&&lt.forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)}))}},nullingGlobal:function(){this.isMultiDrag=ut=!1,lt.length=0},destroyGlobal:function(){this._deselectMultiDrag(),f(document,"pointerup",this._deselectMultiDrag),f(document,"mouseup",this._deselectMultiDrag),f(document,"touchend",this._deselectMultiDrag),f(document,"keydown",this._checkKeyDown),f(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(e){if(!(void 0!==ut&&ut||nt!==this.sortable||e&&v(e.target,this.options.draggable,this.sortable.el,!1)||e&&0!==e.button))for(;rt.length;){var t=rt[0];w(t,this.options.selectedClass,!1),rt.shift(),U({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:t,originalEvt:e})}},_checkKeyDown:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},t(e,{pluginName:"multiDrag",utils:{select:function(e){var t=e.parentNode[P];t&&t.options.multiDrag&&!~rt.indexOf(e)&&(nt&&nt!==t&&(nt.multiDrag._deselectMultiDrag(),nt=t),w(e,t.options.selectedClass,!0),rt.push(e))},deselect:function(e){var t=e.parentNode[P],o=rt.indexOf(e);t&&t.options.multiDrag&&~o&&(w(e,t.options.selectedClass,!1),rt.splice(o,1))}},eventProperties:function(){var e=this,t=[],o=[];return rt.forEach((function(n){var a;t.push({multiDragElement:n,index:n.sortableIndex}),a=dt&&n!==at?-1:dt?x(n,":not(."+e.options.selectedClass+")"):x(n),o.push({multiDragElement:n,index:a})})),{items:a(rt),clones:[].concat(lt),oldIndicies:t,newIndicies:o}},optionListeners:{multiDragKey:function(e){return"ctrl"===(e=e.toLowerCase())?e="Control":1<e.length&&(e=e.charAt(0).toUpperCase()+e.substr(1)),e}}})}),_e}));var swapSortable,toastMain,toastVersion,MAX_TOOLS=12,autoScroll=!0,historyIndex=-1,swapTools=new Array(MAX_TOOLS),toolColors=new Array(MAX_TOOLS),feedLoadState=new Array(MAX_TOOLS),stepperMappings=new Array(MAX_TOOLS),isTestRunning=!1,boardOptions=new Array,hasMultiservo=!1,hasTmc=!1,hasV6S=!1,hasDDE=!1,hasNeoPixels=!1,hasExtCtrl=!1,hasSharedStepper=!1,hasLidState=!1,hasEStopMux=!1,tmcStatusInterval=0,testCancelled=0,lastFWVersion=0,lastWIVersion=0,curFWVersion=0,isShowingLoading=!1,isShowingUnloading=!1,versionMismatch=new Array,uploadCancelled=!1,moveCarrierG1=!1,isFeederLoaded=!1,smuffIsIdle=!1,curMS=0,newStepsMM=0,msItem="",tmcNotUsed=0;const githubUrl="technik-gegg.github.io",githubPrefix="https://"+githubUrl+"/SMuFF-WI/";var sitePrefix="",colorNames=[{label:"Aqua",value:0},{label:"Azure",value:0},{label:"Beige",value:0},{label:"Bisque",value:0},{label:"Black",value:0},{label:"Blue",value:0},{label:"Brown",value:0},{label:"BurlyWood",value:0},{label:"Chartreuse",value:0},{label:"Chocolate",value:0},{label:"Coral",value:0},{label:"Cornsilk",value:0},{label:"Crimson",value:0},{label:"Cyan",value:0},{label:"DimGray",value:0},{label:"FireBrick",value:0},{label:"Fuchsia",value:0},{label:"Gainsboro",value:0},{label:"Gold",value:0},{label:"Gray",value:0},{label:"Green",value:0},{label:"Honeydew",value:0},{label:"Indigo",value:0},{label:"Ivory",value:0},{label:"Khaki",value:0},{label:"Lavender",value:0},{label:"Lime",value:0},{label:"Linen",value:0},{label:"Magenta",value:0},{label:"Maroon",value:0},{label:"MintCream",value:0},{label:"MistyRose",value:0},{label:"Moccasin",value:0},{label:"Navy",value:0},{label:"Olive",value:0},{label:"Orange",value:0},{label:"Orchid",value:0},{label:"Pink",value:0},{label:"Plum",value:0},{label:"Purple",value:0},{label:"Red",value:0},{label:"Sienna",value:0},{label:"Silver",value:0},{label:"Tan",value:0},{label:"Turquoise",value:0},{label:"Transparent",value:0},{label:"Violet",value:0},{label:"White",value:0},{label:"Yellow",value:0}],materialNames=[{label:"PLA",value:0},{label:"PETG",value:0},{label:"PC",value:0},{label:"PA",value:0},{label:"ASA",value:0},{label:"ABS",value:0},{label:"CF",value:0},{label:"PVA",value:0},{label:"Flex",value:0},{label:"HIPS",value:0}];function showConnectingMessage(e,t,o=null){$("#connecting-message").fadeOut(e,(function(){$("#connecting-message").html(t).fadeIn(e),null!=o&&o()}))}function initUI(){$("#swap-tools-template-container").addClass("hidden").removeClass("d-flex"),$("#materials-tool-template").addClass("hidden").removeClass("d-flex"),$("#history-items-template-container").addClass("hidden").removeClass("d-flex"),$("#console-templates").addClass("hidden").removeClass("d-flex"),$("#materials-template").addClass("hidden").removeClass("d-flex"),$("#servomap-template").addClass("hidden").removeClass("d-flex"),$("#top-info, #sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-testrun, #sec-boardinfo, #sec-live-control").fadeOut("fast"),$("#content").css("padding-top","70px"),$("#nav-container").addClass("hidden"),$("#test-status").addClass("hidden"),$("#tmc-status").addClass("hidden"),$("#tmc-stat-0").addClass("hidden"),$("#tmc-stat-1").addClass("hidden"),$("#tmc-stat-2").addClass("hidden"),$("#tmc-stat-3").addClass("hidden"),$("#toast-placement").addClass("hidden").removeClass("d-flex").removeClass("d-inline"),$("#btn-wizard").css("display","none"),showChangesPending(!1),$("#tmcwarn-label").text(""),$("#version-label").text(""),$("#devname-label").text(""),$("#electronics-label").text(""),$("#mode-label").text(""),$("#console-text").text(""),$("#test-files").empty(),$("#test-files").append(new Option(localStorage.getItem("runningScript"),""))}function initUI2(){$("#relay-status").css("background-color",$(".card").css("color")),$("#relay-status").css("color",$(".card").css("background-color"))}function addSentGcode(e){if(null!=e){var t=$("#console-text-container"),o=$("#send-template").clone(!0);o.attr("id",""),o.removeClass("hidden"),o.text(e),t.append(o)}}async function addReceivedGcode(e){if(null!=e){$("#console-text-container span").length>3e3&&$("#console-text-container").find("span:first").remove();var t=$("#console-text-container"),o=$("#receive-template").clone(!0);o.attr("id",""),o.removeClass("hidden"),o.html(replaceTermAttr(e)),t.append(o),autoScroll&&t.scrollTop(t[0].scrollHeight)}}function replaceTermAttr(e){var t=e.replace(/\x1b\[0m/g,"</span>");t=t.replace(/\x1b\[1m/g,'<span class="bold">');for(var o=/\x1b\[(\d+)m/g;m=o.exec(t);){var n="";m[1]>=30&&m[1]<=37?n="fgc"+m[1]:m[1]>=40&&m[1]<=47&&(n="bgc"+m[1]),t=t.replace(new RegExp("\\x1b\\["+m[1]+"m","g"),'<span class="'+n+'">')}return t}function createHistoryItem(e){if(null!=e){for(var t=0,o=$("#historyitemscontainer"),n=0;n<o.children().length;n++){var a=$(o.children()[n]).find("span").text();if(null!=a&&a.toUpperCase().trim()==e.toUpperCase().trim())return void(a.toUpperCase().trim()==e.toUpperCase().trim()&&(historyIndex=n));t++}var i=$("#history-item-template").clone(!0),s=i.find("span");s.attr("id",""),i.find("i").attr("id",""),s.text(e),i.attr("id","history-item-"+t),i.css("cursor","pointer"),o.append(i),historyIndex=o.children().length}}function showLoading(e){if(!seenError){var t=$("#tool-selection").val();if(-1!=t)showInfo(e?loadingFilament+t+loadingFilamentSpl+plzWait:loadingFilament+t+closeH2+plzWait),isShowingLoading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showUnloading(e){if(!seenError){var t=$("#tool-selection").val();if(-1!=t)showInfo(e?unloadingFilament+t+unloadingFilamentSpl+plzWait:unloadingFilament+t+closeH2+plzWait),isShowingUnloading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showPurging(e){if(""!=e){var t=e.matchAll(/([A-Z]:)(\d+.?\d*)/g),o=-1,n=0,a=0;for(const e of t)switch(e[1]){case"T:":o=parseInt(e[2]);break;case"L:":n=parseInt(e[2]);break;case"C:":a=parseFloat(e[2])}if(-1!=o){var i=purging1+o+purging2+n+purging3+a+purging4+plzWait;setTimeout((function(){showInfo(i)}),500)}}else cancelInfo()}$(document).ready((function(){if($("#update-note").addClass("d-none"),$("#platform").addClass("d-none"),sitePrefix="",!location.host.startsWith(githubUrl)){if(console.log("Host: ",location.host),!location.host.startsWith("localhost")){isStandalone=!0,console.log("Running in standalone mode...");var e=location.origin;$('img[src^="assets/"]').each((function(){var t=$(this).prop("id");if("smuff-image"!==t&&"logo"!==t){var o=$(this).prop("src").replace(e,githubPrefix);o.indexOf("/wi/")>-1&&(o=o.replace("/wi/","")),$(this).prop("src",o)}})),sitePrefix=githubPrefix,console.log("Image sources changed to Github...")}$.get("platform.txt",(function(e){$("#platform").text(e)})).fail((function(){$("#platform").text("Unknown Platform")})),$("#platform").removeClass("d-none"),curWIVersion=parseFloat($("#version-info").text().substring(1)),$.get(githubPrefix+"wiversion.txt",(function(e){lastWIVersion=parseFloat(e),console.log("Lastest SMuFF-WI version: "+lastWIVersion),$("#update-note").text($("#update-note").text().replace("{VER}",lastWIVersion)),lastWIVersion>curFWVersion&&$("#update-note").removeClass("d-none")})).fail((function(){console.log("No able to retrieve lastest SMuFF-WI version!"),$("#update-note").text(noWiVersion).removeClass("d-none")}))}$.get(githubPrefix+"fwversion.txt",(function(e){console.log("Lastest SMuFF Firmware version: "+e),lastFWVersion=parseFloat(e)})),window.onscroll=function(){$(window).scrollTop()>35?($("#top-info").css("transform-origin","0 0"),$("#top-info").css("transform","scale(1, .65)"),$("#content").css("padding-top","160px"),$("#settings-header").css("top","105px")):($("#top-info").css("transform","scale(1, 1)"),$("#content").css("padding-top","200px"),$("#settings-header").css("top","200px"))};var t=$('<link href="'+$("#themes").val()+'" rel="stylesheet" />');if(t.appendTo("head"),null!=localStorage.getItem("Theme")){var o=localStorage.getItem("Theme");$("#themes").val(o),t.attr("href",o).promise().done((function(){initUI(),setTimeout((function(){initUI2()}),1e3)}))}else initUI(),initUI2();for(var n=0;n<3;n++)versionMismatch[n]=0;$("#themes").on("change",(function(){t.attr("href",$(this).val()).promise().done((function(){setTimeout((function(){initUI2()}),1e3)})),localStorage.setItem("Theme",$(this).val())}));var a=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e)}));toastVersion=a[0],toastMain=a[1],swapSortable=Sortable.create(toolsswaplist,{swap:!0,swapClass:"swapping-highlight",animation:250,store:{get:function(e){},set:function(e){var t=swapSortable.toArray(),o=0;t.forEach((function(e){swapTools[o++]=parseInt(e.substring(3))}))}}});var i,s=Sortable.create(historyitemscontainer,{swap:!1,swapClass:"swapping-highlight",animation:250,store:{get:function(){var e=localStorage.getItem("CmdHistory");if(void 0!==e){var t=JSON.parse(e);null!=t&&t.forEach((function(e){createHistoryItem(e)}))}},set:function(){for(var e="[ ",t=$("#historyitemscontainer"),o=0;o<t.children().length;o++){e+='"'+$(t.children()[o]).find("span").text()+'"',o<t.children().length-1&&(e+=",")}e+=" ]",localStorage.setItem("CmdHistory",e),showToast(historySavedLocally)}}});$("#accordion-settings input, #accordion-settings select").on("change",(function(){showChangesPending(!0);var e=$(this).prop("id");e.startsWith("Close-")&&async function(e,t){initDone&&e==getCurrentTool()&&await sendGcode('M205P"ServoClose"S'+t+"I99")}(parseInt(e.substring(6)),$(this).val());if("Device"==e&&(""==$(this).val()?$("#devname-label").text(noName):$("#devname-label").text($(this).val())),$(this).hasClass("form-check-input")){var t=$(this).prop("checked");switch(e){case"UsePurge":setCheckmark($("#card-purge"),t);break;case"SendStats":setCheckmark($("#card-sendstat"),t);break;case"Revolver-UseServo":t&&(hasDDE||$("#Revolver-TMC-Mode").val(0).trigger("change"));break;case"UseCutter":t?$("#lvc-cutter").removeClass("visually-hidden"):$("#lvc-cutter").addClass("visually-hidden");break;case"UseSplitter":setSplitterOption();break;case"Dlvl-1":case"Dlvl-2":case"Dlvl-4":case"Dlvl-8":return void changeDebugLevel()}checkForChange($(this))&&sendChange($(this)),"EmulPrusa"==$(this).prop("id")&&initDone&&($(this).is(":checked")?$("#btn-load-to-nozzle").removeClass("disabled"):$("#btn-load-to-nozzle").addClass("disabled"))}})),$("#accordion-settings input").on("focusout",(async function(){showChangesPending(!0),checkForChange($(this))&&(sendChange($(this)),"Revolver-ServoClose"==$(this).prop("id")&&$("#servo-closed-modal").modal("show"))})),$("#accordion-settings select").on("focusin",(async function(){initDone&&$(this).prop("id").endsWith("TMC-MS")&&0==(curMS=$(this).val())&&(curMS=1)})),$("#accordion-settings select").on("change",(async function(){if(initDone&&$(this).prop("id").endsWith("TMC-MS")){var e=$(this).prop("id");msItem=e.substring(0,e.length-("TMC-MS".length+1));var t=$(this).val(),o=$("#"+msItem+"-StepsMM").val();0==t&&(t=1),newStepsMM=parseInt(o/curMS*t),$("#request-steps-per-mm").html(reqStepsMM.replace("{ITEM}",msItem).replace("{VAL}",newStepsMM)),isNaN(newStepsMM)||$("#ms-changed-modal").modal("show")}showChangesPending(!0),checkForChange($(this))&&sendChange($(this))})),$("#console-container").on("hide.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","closed")})),$("#console-container").on("show.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","opened")})),$("#toast-placement").on("hide.bs.toast",(function(){$(this).addClass("hidden").removeClass("d-inline").removeClass("d-flex"),$(this).find(".toast").each((function(){$(this).removeClass("d-flex")}))})),$("#toast-placement").on("show.bs.toast",(function(){$(this).removeClass("hidden").addClass("d-inline").addClass("d-flex"),$(this).find(".toast").each((function(){$(this).addClass("d-flex")}))})),"closed"==localStorage.getItem("Console")&&$("#console-container").toggleClass("show"),$("#btn-selector-settings").trigger("click"),$("#btn-settings-general").trigger("click"),$("#connect, #connecting-message, #smuff-image").on("click",(function(){isStandalone?showConnectingMessage("slow",connectingDevice,openWebSock):"serial"in navigator?showConnectingMessage("slow",connectingSMuFF,connectSerial):(showError(noWebSerial),showConnectingMessage("slow",connectionFailed,null))})),$(".navbar-nav#main .nav-item").on("click",(async function(){var e=$(this).data("section");if(void 0!==e)if("#disconnect"==e)isStandalone||await disconnectSerial(),showConnect();else if($("li.nav-item").removeClass("activeSection"),$(this).addClass("activeSection"),$(".section:not("+e+")").hide(),$(e).fadeIn("slow"),"#sec-statusinfo"==e)0==tmcStatusInterval&&(tmcStatusInterval=setInterval((function(){refreshTMCStats()}),750));else if("#sec-live-control"==e)for(var t=0;t<getToolCount();t++)setFeedLoadState($("#lvc-in-splitter-"+t),feedLoadState[t]);else 0!=tmcStatusInterval&&(clearInterval(tmcStatusInterval),tmcStatusInterval=0)})),$("#console-text-container").on("scroll",(function(){autoScroll=$(this).scrollTop()+$(this).height()>=$(this)[0].scrollHeight})),$(".remove-history-entry").on("click",(function(){$(this).parent().remove()})),$("#gcode").keypress((function(e){13==e.which&&$("#btn-send-gcode").trigger("click")})),$("#gcode").keydown((function(e){var t=$("#historyitemscontainer");38==e.which&&(e.preventDefault(),--historyIndex<0&&(historyIndex=t.children().length-1),setGcodeHistory()),40==e.which&&(e.preventDefault(),++historyIndex>=t.children().length&&(historyIndex=0),setGcodeHistory())})),$("body").on("keydown",(function(e){var t=e.keyCode||e.which;t>=112&&t<=115&&(e.preventDefault(),sendPFKey(t-32)),e.ctrlKey&&"s"===e.key&&(e.preventDefault(),$("#btn-save-settings").trigger("click")),e.ctrlKey&&"r"===e.key&&(e.preventDefault(),$("#btn-reload-settings").trigger("click"))})),$("#version-info, #release-notes").on("click",(function(){$("#recent-changes-modal").modal("show")})),$("#logo, #smuff").on("click",(function(){location.href="https://sites.google.com/view/the-smuff/"})),$("#btn-send-gcode").on("click",(async function(){var e=$("#gcode").val();null!=e&&e.length>0&&(historyIndex=-1,createHistoryItem(e),sendGcode(e,!0,!0),await getResponse()),$("#gcode").val("")})),$("#btn-clear-gcode").on("click",(function(){$("#console-text-container").empty()})),$("#btn-pf1").on("click",(function(){sendPFKey(80)})),$("#btn-pf2").on("click",(function(){sendPFKey(81)})),$("#btn-pf3").on("click",(function(){sendPFKey(82)})),$("#btn-pf4").on("click",(function(){sendPFKey(83)})),$("#btn-home").on("click",(function(){sendGcode("G28",!0,!0),moveCarrierG1=!1})),$("#btn-motors-off").on("click",(function(){sendGcode("M18",!0,!0)})),$("#btn-tool-maint").on("click",(function(){sendGcode("TM",!0,!0)})),$("#btn-wipe").on("click",(function(){sendGcode("G12",!0,!0)})),$("#btn-cut").on("click",(function(){sendGcode("G12C",!0,!0)})),$("#btn-load").on("click",(async function(){sendGcode("M700",!0,!0),showLoading(!1),await getResponse(),cancelInfo()})),$("#btn-unload").on("click",(async function(){$("#UseCutter").is(":checked")&&animateCutter(!1),sendGcode("M701",!0,!0),showUnloading(!1),await getResponse(),cancelInfo(),$("#UseCutter").is(":checked")&&animateCutterEnd()})),$("#btn-load-to-nozzle").on("click",(function(){sendGcode("M700N",!0,!0),showLoading(!1)})),$("#btn-load-to-splitter").on("click",(async function(){sendGcode("M700S",!0,!0),showLoading(!0)})),$("#btn-unload-from-splitter").on("click",(async function(){sendGcode("M701S",!0,!0),showUnloading(!0)})),$("#btn-reset").on("click",(function(){sendGcode("M999",!0,!0)})),$("#btn-view-script").on("click",(async function(){var e=$("#test-files option:selected").text();""!=e&&(sendGcode('M20L"test/'+e+'.gcode"'),await getResponse(),""!=responseBuffer&&($("#script-name").text(e),$("#script-content").val(responseBuffer),$("#view-script-modal").modal("show")))})),$("#btn-run-test").on("click",(async function(){var e;if("stopped"==$(this).data("state")){var t=$("#test-files option:selected").text();localStorage.setItem("runningScript",t),sendGcode('M98P"'+t+'"',!0,!1),await getResponse(),e=!0,testCancelled=0}else localStorage.setItem("runningScript",""),sendChar(""),e=!1,testCancelled=(new Date).getTime();showTestRunning(e)})),$("#btn-save-settings").on("click",(function(){showToast(savingSettings),saveConfig(),removeValFeedback()})),$("#btn-reload-settings").on("click",(function(){showToast(reloadingSettings),requestInit(),removeValFeedback()})),$("#btn-reset-swaps").on("click",(function(){var e=swapSortable.toArray();e.sort(),swapSortable.sort(e,!0),swapSortable.save()})),$("#btn-save-swaps").on("click",(async function(){for(var e="{ ",t=MAX_TOOLS,o=0;o<t;o++)e+="'T"+o+"':"+swapTools[o],o<t-1&&(e+=",");sendGcode('M504P"Swaps"S"'+(e+="}")+'"',!1,!1),await getResponse()&&showToast(toolSwapsSaved)})),$("#btn-save-history").on("click",(function(){s.save()})),$("#btn-copy-to-clipboard").on("click",(async function(){var e="";$("#console-text-container span").each((function(){""!=$(this).text()&&($(this).hasClass("data-sent")&&(e+="[--- "),e+=$(this).text().replaceAll("\n",""),$(this).hasClass("data-sent")?e+=" ---]\n":e+="\n")})),await navigator.clipboard.writeText(e),showToast(copiedToClipboard)})),$("#btn-wizard").on("click",(function(){showWizard()})),$("#firmware-file").on("change",(function(e){1==e.target.files.length?($("#btn-upload-firmware").removeClass("disabled"),$("#btn-upload-firmware").prop("disabled",!1),i=e.target.files[0]):($("#btn-upload-firmware").addClass("disabled"),$("#btn-upload-firmware").prop("disabled",!0),i=null)})),$("#btn-upload-firmware").on("click",(function(){if(console.log(i),null!=i){var e=new FileReader;e.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:showToast(fileNotFound);break;case e.target.error.NOT_READABLE_ERR:ahowToast(fileNotReadable);break;case e.target.error.ABORT_ERR:break;default:showToast(fileReadError)}fwBuffer=null},e.onprogress=async function(e){e.loaded==e.total&&(await sendUploadRequest("firmware.tmp",e.total),console.log("file loaded completely"))},e.onabort=function(e){showToast(uploadAborted),fwBuffer=null},e.onloadstart=function(e){console.log(e.srcElement.readyState)},e.onload=async function(t){console.log(t.currentTarget.result),t.currentTarget.readyState==e.DONE&&($("#firmware-upload-modal").modal("show"),fwBuffer=new Uint8Array(t.currentTarget.result),setTimeout((function(){sendBuffer(fwBuffer)}),500))},e.readAsArrayBuffer(i)}})),$("#btn-modal-ok").on("click",(async function(){$("#restart-modal").modal("hide"),sendGcode("M999"),await getResponse()})),$("#btn-modal-wipe-ok").on("click",(async function(){$("#wipe-sequence-modal").modal("hide");var e="S"+$("#wipe-S").val()+"I"+$("#wipe-I").val()+"J"+$("#wipe-J").val()+"P"+$("#wipe-P").val()+"R"+$("#wipe-R").val();$("#WipeSeq").val(e),sendChange($("#WipeSeq"))})),$("#btn-servo-ok").on("click",(function(){$("#servo-closed-modal").modal("hide");var e=$("#Revolver-ServoClose").val();$('input[id^="Close-"]').each((async function(){$(this).val(e).trigger("focusout"),await getResponse()}))})),$("#btn-ms-changed-ok").on("click",(function(){$("#ms-changed-modal").modal("hide"),$('input[id="'+msItem+'-StepsMM"]').each((async function(){$(this).val(newStepsMM).trigger("focusout"),await getResponse()}))})),$("#btn-cancel-upload").on("click",(function(){uploadCancelled=!0})),$("#card-relay").on("click",(async function(){if(hasSharedStepper&&!isTestRunning){var e="I"==$(this).find("span#state").data("state")?"E":"I";$(this).find("span#state").data("state",e),setRelayState(e),sendGcode("M17"+e,!0,!1),await getResponse()}})),$("#card-lid").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";hasLidState||setLidIcon(e),sendGcode("M280R"+e,!0,!1),await getResponse()}})),$("#card-purge").on("click",(async function(){if(!hasExtCtrl&&!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"UsePurge"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#card-sendstat").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"SendStats"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#tmc-status").on("click",(function(){$('.nav-item[data-section="#sec-statusinfo"]').trigger("click")})),$("#changes-pending").on("click",(function(){$('.nav-item[data-section="#sec-settings"]').trigger("click")})),$("#tool-selection").on("change",(async function(){if(moveCarrierG1=!1,$("#selector-pwr-off").addClass("hidden"),-1==$(this).val())sendGcode("G28X",!0,!1),moveCarrier(0),await getResponse();else{var e=parseInt($(this).val().substring(1));sendGcode($(this).val(),!0,!1),moveCarrier(e),await getResponse()}})),$("[id^=history-item-]").on("click",(function(){$("#gcode").focus(),$("#gcode").val($(this).find("span").text())})),$("#WipeSeq").on("focus, click",(function(){var e=$(this).val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const t of e)console.log(t[0]),$("#wipe-"+t[0].toUpperCase()[0]).val(t[0].substring(1));$("#wipe-sequence-modal").modal("show")})),$("#Revolver-ServoClose").on("change",(async function(){initDone&&(sendGcode('M205P"ServoClose"S'+$(this).val()+"I99"),await getResponse())})),$("#Revolver-ServoOpen").on("change",(async function(){initDone&&(sendGcode('M205P"ServoOpen"S'+$(this).val()+"I99"),await getResponse())}))}));var tmcStatusBusy=!1;async function refreshTMCStats(){!tmcStatusBusy&&initDone&&(tmcStatusBusy=!0,$("#tmc-stat-0").hasClass("hidden")||(sendGcode("M122W0"),await getResponse()),$("#tmc-stat-1").hasClass("hidden")||(sendGcode("M122W1"),await getResponse()),$("#tmc-stat-2").hasClass("hidden")||(sendGcode("M122W2"),await getResponse()),$("#tmc-stat-3").hasClass("hidden")||(sendGcode("M122W3"),await getResponse()),tmcStatusBusy=!1)}function showTestRunning(e){if(!(1==e&&testCancelled>0&&(new Date).getTime()-testCancelled<4e3)){var t=$("#btn-run-test"),o=$("#test-status"),n=localStorage.getItem("runningScript");e?"running"!=t.data("state")&&(t.data("state","running"),t.find("i").removeClass("fa-play"),t.find("i").addClass("fa-stop"),o.removeClass("hidden"),o.html('Test <i>"'+n+'"</i> is running&hellip;'),isTestRunning=!0,$('.nav-item[data-section="#sec-dashboard"]').addClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').addClass("hidden"),$('.nav-item[data-section="#sec-settings"]').addClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').addClass("hidden"),$('.nav-item[data-section="#sec-statusinfo"]').addClass("hidden"),setDisabled(!0,".sec-status"),$("#sec-status").hide("slow")):"stopped"!=t.data("state")&&(t.data("state","stopped"),t.find("i").removeClass("fa-stop"),t.find("i").addClass("fa-play"),o.addClass("hidden"),o.text(o.text().replace(n,"{TEST}")),isTestRunning=!1,$('.nav-item[data-section="#sec-dashboard"]').removeClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').removeClass("hidden"),$('.nav-item[data-section="#sec-settings"]').removeClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').removeClass("hidden"),hasTmc&&$('.nav-item[data-section="#sec-statusinfo"]').removeClass("hidden"),setDisabled(!1,".sec-status"),$("#sec-status").show("slow"))}}function setCheckmark(e,t){var o=$(e).find("i");o.data("state",t),"send-stat"!=o.prop("id")?(o.removeClass("fa-check-circle fa-times-circle icon-checked icon-unchecked"),o.addClass("0"==t?"fa-times-circle icon-unchecked":"fa-check-circle icon-checked")):(o.removeClass("fa-repeat fa-times-circle fa-spin"),o.addClass("0"==t?"fa-times-circle":"fa-repeat fa-spin"))}function hideConnect(){$("#sec-start").fadeOut("slow").promise().done((function(){$("#content").css("padding-top","200px"),$("#content").scrollTop(0),$("#sec-dashboard, #top-info").fadeIn("fast"),$('li.nav-item[data-section="#sec-dashboard"]').addClass("activeSection"),$('li.nav-item[data-section!="#sec-dashboard"]').removeClass("activeSection")})),$("#nav-container").removeClass("hidden"),tmcNotUsed=0,hideStatusInfoNav(),$("#btn-wizard").css("display","block");var e=localStorage.getItem("LastWizardDevice");localStorage.getItem("ShowWizard")!==never&&(localStorage.getItem("ShowWizard")==no&&e==$("#devname-label").text()||showWizard())}function showConnect(){$("#sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-boardinfo, #sec-testrun, #sec-live-control, #top-info").fadeOut("fast").promise().done((function(){$("#content").css("padding-top","70px"),$("#sec-start").fadeIn("fast"),showConnectingMessage("slow",disconnected,null),setTimeout((function(){showConnectingMessage("slow",clickToConnect,null)}),2e3)})),$("#nav-container").addClass("hidden"),$("#btn-wizard").css("display","none")}async function sendChange(e){if(initDone){var t=buildM205Command(e);if(""!=t){e.removeClass("val-failed"),sendGcode(t);var o=await getResponse();e.addClass(o?"val-changed":"val-failed"),o||showToast(saveSettingFailed)}}}function setValue(e,t){try{if(void 0===e)return;for(var o of Object.keys(e)){var n,a=!1;t.indexOf("${key}")>-1?(n=t.replace("${key}",o),a=!0):n=t;var i=$("#"+n+(a?"":o));if(void 0!==i&&null!=i){if("checkbox"==i.prop("type")){var s,r;if("boolean"==typeof e[o])switch(s=e[o],e[o]){case!0:r=yes;break;case!1:r=no}else switch(e[o]){case 1:s=!0,r=high;break;case 0:s=!1,r=low;break;case"PWM":s=!1,r=pwm;break;case"OUTPUT":s=!0,r=output}i.prop("checked",s),i.attr("data-bs-original-title",r)}else if("color"==i.prop("type"))i.val("#"+e[o]);else{i.val(e[o]);var l=0;switch(o){case"LBtnDown":l=1;break;case"LBtnHold":l=2;break;case"RBtnDown":l=3;break;case"RBtnHold":l=4}l>0&&""!=e[o]&&$("#btn-pf"+l).text(pfButton+l+" ( "+e[o]+" )")}i.trigger("change")}else console.log("Control #"+o+" not found!");0}}catch(e){console.log("Failed to set value",e)}}function changeDebugLevel(){var e=0;$("#Dlvl-1").is(":checked")&&(e|=1),$("#Dlvl-2").is(":checked")&&(e|=2),$("#Dlvl-4").is(":checked")&&(e|=4),$("#Dlvl-8").is(":checked")&&(e|=8),console.log("Debug-Level: "+e),sendGcode("M111S"+e,!1,!1)}function setDebugLevel(e){var t=e.Level;$("#Dlvl-1").prop("checked",1&t),$("#Dlvl-2").prop("checked",2&t),$("#Dlvl-4").prop("checked",4&t),$("#Dlvl-8").prop("checked",8&t)}function setTMCstats(e){var t=e.TMCStatus.Axis;if(1==e.TMCStatus.InUse)for(var o of($("#tmc-stat-"+t).removeClass("hidden"),Object.keys(e.TMCStatus))){var n=$("#tmc-stat-"+t+"-"+o);"Version"==o&&(parseInt(e.TMCStatus[o])<1?versionMismatch[t]++:versionMismatch[t]>0&&versionMismatch[t]--),versionMismatch[t]>10&&(showToast(tmcVersionMismatch),$("#tmc-status").removeClass("hidden")),n.text(e.TMCStatus[o]),void 0!==n.parent().data("alert")&&("No"!=n.text()?(n.addClass("tmc-warning"),$("#tmc-status").removeClass("hidden")):(n.removeClass("tmc-warning"),$("#tmc-status").addClass("hidden")))}else $("#tmc-stat-"+t).addClass("hidden"),tmcNotUsed++;4==tmcNotUsed&&(hasTmc=!1,hideStatusInfoNav())}function setSettings(e,t){var o;try{if(o=JSON.parse(e),"Debug"==t&&(localStorage.setItem("DBG",e),setDebugLevel(o)),"TMC"==t&&(localStorage.setItem("TMC",e),setTMCstats(o)),"Basic"==t&&(localStorage.setItem("M503S1",e),setValue(o,""),setValue(o.Baudrates,"baudrate-")),"Steppers"==t&&(localStorage.setItem("M503S2",e),setValue(o.Selector,"Selector-"),setValue(o.Revolver,"Revolver-"),setValue(o.Feeder,"Feeder-")),"TMC Driver"==t&&(localStorage.setItem("M503S3",e),setValue(o.Selector,"Selector-TMC-"),setValue(o.Revolver,"Revolver-TMC-"),setValue(o.Feeder,"Feeder-TMC-")),"Servo mapping"==t&&(localStorage.setItem("M503S4",e),!hasV6S)){var n=getToolCount();setValue(o.Lid,"${key}-lid"),setValue(o.Wiper,"${key}-wiper"),setValue(o.Cutter,"${key}-cutter"),setValue(o.Spare1,"${key}-spare1"),setValue(o.Spare2,"${key}-spare2"),setValue(o.Relay,"${key}-relay"),setValue(o.Out6,"${key}-user1"),setValue(o.Out7,"${key}-user2")}if("Materials"==t){localStorage.setItem("M503S5",e);n=getToolCount();toolColors=new Array(n);for(var a=0;a<n;a++)setValue(o["T"+a],"materials-tool-"+a+' [id="${key}-'+a+'"]'),toolColors[a]=$("#materials-tool-"+a+' [id="Color-'+a+'"]').val()}if("Tool swaps"==t){localStorage.setItem("M503S6",e);for(a=0;a<MAX_TOOLS;a++)swapTools[a]=o["T"+a];setupSwaps()}if("Revolver mapping"==t){localStorage.setItem("M503S7",e);for(a=0;a<MAX_TOOLS;a++)stepperMappings[a]=o["T"+a];hasV6S&&setupStepperMappings()}if("Feed State"==t){for(a=0;a<MAX_TOOLS;a++)feedLoadState[a]=0,void 0!==o["T"+a]&&(feedLoadState[a]=o["T"+a]);setTimeout((function(){for(var e=0;e<getToolCount();e++)setFeedLoadState($("#lvc-in-splitter-"+e),feedLoadState[e])}),750)}t=""}catch(o){return seenParserError=!0,console.log(o),console.log('In Config type: "'+t+'" Data: ['+e+"]"),void showToast(failedReadSettings)}}function addTestFiles(e){try{var t=JSON.parse(e);$("#test-files").empty(),null!=t&&t.forEach((function(e){var t=e.indexOf(".gcode");if(-1!=t){var o=e.substring(0,t);$("#test-files").append(new Option(o,""))}}))}catch(e){console.log(e),showToast(failedReadingTestFiles)}}function setRelayState(e){var t=e.substring(0,1),o=$("#card-relay").find("span#state");o.data("state",t),o.text(t)}function setFWInfo(e){hasTmc=!1,hasV6S=!1,hasDDE=!1,hasMultiservo=!1;try{var t=e.split(":"),o=t[3].replace(" DATE","").trim();$("#version-label").text(t[2].replace(" ELECTRONICS","")),$("#electronics-label").text(o),$("#mode-label").text(t[5].replace(" OPTIONS","")),$("#acc-servo-pinmaps").addClass("d-none");try{if(t.length>5){console.log("Options: "+t[6]),$("#electronics-label").prop("title",t[6].replaceAll("|","; ")),boardOptions=t[6].split("|"),hasNeoPixels=!1,setDisabled(!0,".hasNeopixels"),setDisabled(!0,".hasBacklight"),setDisabled(!0,".hasTMC"),setDisabled(!0,".hasV6S"),setDisabled(!1,".has1stEndstop"),setDisabled(!1,".hasNotV6S"),setDisabled(!1,".hasPurge"),setDisabled(!0,".hasDDE");for(var n=0;n<boardOptions.length;n++)boardOptions[n]=boardOptions[n].trim(),addSentGcode(boardOptions[n]),"MULTISERVO"==boardOptions[n]&&(hasMultiservo=!0,$("#acc-servo-pinmaps").removeClass("d-none")),"TMC"==boardOptions[n]&&(hasTmc=!0,setDisabled(!1,".hasTMC")),"V6S"==boardOptions[n]&&(hasV6S=!0,setDisabled(!1,".hasV6S"),setDisabled(!0,".hasNotV6S")),"DDE"==boardOptions[n]&&(hasDDE=!0,setDisabled(!1,".hasDDE"),setDisabled(!0,".hasNotDDE")),"NEOPIXELS"==boardOptions[n]&&(hasNeoPixels=!0,setDisabled(!1,".hasNeopixels")),"ESTOP-MUX"==boardOptions[n]&&(hasEStopMux=!0,setDisabled(!1,".has1stEndstop")),boardOptions[n].startsWith("MINIPANEL V2")&&setDisabled(!1,".hasBacklight");hasV6S||hasDDE?($("#tmc-mode-revolver").removeClass("hidden").addClass("d-flex"),$("#tmc-section-revolver").removeClass("hidden").addClass("d-flex"),hasDDE&&($("#btn-revolver-settings").text(lidDDE),$(".hasDDE.servoOnly").removeClass("hidden")),hasV6S&&($("#btn-revolver-settings").text(lidV6S),$("#btn-servo-mappings").text(stepperMaps),$(".hasV6S.servoOnly").removeClass("hidden"))):($("#tmc-mode-revolver").addClass("hidden").removeClass("d-flex"),$("#tmc-section-revolver").addClass("hidden").removeClass("d-flex"),$("#btn-revolver-settings").text(lidOnly),$("#btn-servo-mappings").text(servoMaps),$(".hasV6S.hasDDE.servoOnly").addClass("hidden").removeClass("d-flex"))}}catch(e){console.log(e)}try{o=o.replaceAll(" ","_"),$("#pins-image").prop("src",sitePrefix+"assets/img/"+o+".png"),hasDDE?$("#wiring-image").prop("src",sitePrefix+"assets/img/"+o+"_Wiring_DDE.png"):$("#wiring-image").prop("src",sitePrefix+"assets/img/"+o+"_Wiring.png")}catch(e){hideBoardInfoNav()}hideStatusInfoNav(),(curFWVersion=parseFloat($("#version-label").text().trim().substring(1)))<2.26&&($("#version-label").addClass("version-warning"),$("#version-label").prop("title",fwWarning),showToast(fwWarning)),curFWVersion<lastFWVersion&&($("#latest-version-info").text(lastFWVersion),setTimeout((function(){toastVersion.show()}),3e3))}catch(e){console.log(e)}}function hideStatusInfoNav(){hasTmc||$('.nav-item[data-section="#sec-statusinfo"] .nav-link').addClass("hidden").removeClass("d-flex")}function hideBoardInfoNav(){hasTmc||$('.nav-item[data-section="#sec-boardinfo"] .nav-link').addClass("hidden").removeClass("d-flex")}function setStatus(e){var t=e.substring(14),o=0;hasLidState=!1;var n=t.matchAll(/([A-Z]{1,3}[\d|:]+).(\+?\w+|-?\d+|\-\w+)+/g);for(const e of n){var a="on"==e[2];switch(e[1]){case"T:":$("#tool-selection").val(e[2]),o=e[2];break;case"S:":setCheckmark($("#card-selector"),a),setSelectorLed(a);break;case"R:":setCheckmark($("#card-revolver"),a);break;case"F:":setCheckmark($("#card-feed1"),a),isFeederLoaded=a,setFeederLed(a);break;case"F2:":setCheckmark($("#card-feed2"),a);break;case"SD:":a?showSDWarning():cancelSDWarning();break;case"SC:":a&&setTimeout((function(){$("#btn-reload-settings").trigger("click")}),2e3);break;case"LID:":setLidIcon(a),hasLidState=!0;break;case"I:":smuffIsIdle=a;break;case"SPL:":-1!=(o=getCurrentTool())&&(feedLoadState[o]=e[2]);break;case"RLY:":setRelayState(e[2])}}o=getCurrentTool(),moveCarrierG1||(smuffIsIdle||($('[id^="lvc-led-"]').each((function(){$(this).prop("id").endsWith(o)||setToolLed($(this),!1)})),-1!=o&&setToolLed($("#lvc-led-"+o),!0)),moveCarrier(-1==o?0:o)),setIdleAnimation(smuffIsIdle)}function setFeedLoadState(e,t){var o=e.width()*parseInt(t);void 0!==e&&e.scrollLeft()!=o&&e.animate({scrollLeft:o+"px"},600);var n=e.parent().find('img[id^="lvc-fitting-"]');2==t?n.attr("data-bs-original-title",ttpUnloadFromNozzle).tooltip("update"):1==t?n.attr("data-bs-original-title",ttpLoadToNozzle).tooltip("update"):16==t?n.attr("data-bs-original-title",ttpUnloadFromSelector).tooltip("update"):32==t?n.attr("data-bs-original-title",ttpUnloadFromNozzle).tooltip("update"):64==t?n.attr("data-bs-original-title",ttpUnloadFromDDE).tooltip("update"):n.attr("data-bs-original-title",ttpLoadToSplitter).tooltip("update")}function moveCarrier(e){var t=$("#lvc-slot-template").width(),o=$("#lvc-carrier").width();$("#lvc-carrier").css("right",o+e*t+"px")}function setToolLed(e,t,o,n){if(t){var a=$("#ToolColor").find(":selected").text();void 0!==o&&(a=o),$(e).css("opacity",1),$(e).css("background-color",a).fadeIn(smuffIsIdle?"fast":"slow")}else{if(hasNeoPixels)var i=0;void 0!==n?(i=parseFloat($(e).css("opacity"))-n,$(e).css("opacity",i<0?0:i)):$(e).css("opacity",0).fadeOut("fast")}}var idleAnimTimer=0;function setIdleAnimation(e){if(""!=$("#AnimBPM").val()&&hasNeoPixels){var t=getToolCount();if(-1!=t){var o=60/$("#AnimBPM").val()*1e3/t/3,n=getCurrentTool(),a=0,i=!0,s=!1;e?$("#IdleAnim").is(":checked")&&0==idleAnimTimer&&(idleAnimTimer=setInterval((async function(){if(n==t-1&&i?(i=!1,s=!0):0!=n||i||(i=!0,s=!0),$("#lvc-led-"+n).css("opacity")<=.15&&(s=!1),s||(i?n++:n--),$('[id^="lvc-led-"').each((function(){setToolLed($(this),!1,null,.2)})),!s){var e="hsl("+a+",80%,50%);";setToolLed($("#lvc-led-"+n),!0,e),(a+=5)>360&&(a=0)}}),o)):(0!=idleAnimTimer&&clearInterval(idleAnimTimer),idleAnimTimer=0)}}}function setTestResults(e){try{var t=JSON.parse(e.substring(15));$("#tst-elapsed").text(t.Elapsed),$("#tst-loopcnt").text(t.Loops),$("#tst-cmdcnt").text(t.Cmds),$("#tst-changes").text(t.ToolChanges),$("#tst-feederr").text(t.FeederErrors),$("#tst-stallselector").text(t.SelectorStalls),$("#tst-stallfeeder").text(t.FeederStalls);for(var o=t.FeedsOk.split("|"),n=t.FeedsMissed.split("|"),a=0;a<o.length;a++){var i=o[a].trim(),s=n[a].trim();i.length>0&&$("#tst-ok-"+a).text(i),s.length>0&&$("#tst-fail-"+a).text(s)}}catch(e){console.log(e)}}function showToast(e){$("#toast-message").html(e),toastMain.show()}function initWizard(){$("#wizard-device").val($("#Device").val()),$("#wizard-tools").val($("#Tools").val()),$("#wizard-bowden-len").val($("#BowdenLen").val()),$("#wizard-is-marlin").prop("checked",!1),$("#wizard-is-pmmu").prop("checked",$("#EmulPrusa").is(":checked")),$("#wizard-is-duet").prop("checked",$("#UseDuet").is(":checked")),$("#wizard-has-shared-stepper").prop("checked",$("#Feeder-SharedStepper").is(":checked")),$("#wizard-has-cutter").prop("checked",$("#UseCutter").is(":checked")),$("#wizard-selector-res09").prop("checked",!1),$("#wizard-feeder-res09").prop("checked",!1);var e=$("#electronics-label").text().trim();(e.endsWith("E3 V1.2")||e.endsWith("E3 V2.0")||e.endsWith("E3 V3.0"))&&$("#wizard-has-tmc2209").prop("checked",!0),"SMuFF"==$("#mode-label").text().trim()&&$("#wizard-is-marlin").prop("checked",!0),$("#wizard-is-marlin").trigger("change"),$("#wizard-is-pmmu").trigger("change"),$("#wizard-is-duet").trigger("change"),$("#wizard-has-shared-stepper").trigger("change"),$("#wizard-has-cutter").trigger("change"),$("#wizard-has-tmc2209").trigger("change"),$("#wizard-selector-res09").trigger("change"),$("#wizard-feeder-res09").trigger("change"),hasDDE?($("#wizard-dde-res09").trigger("change"),$("#wizard-dde-row").removeClass("hidden")):$("#wizard-dde-row").addClass("hidden").removeClass("d-flex")}async function storeWizard(){var e=$("#wizard-device").val(),t=parseInt($("#wizard-tools").val()),o=parseFloat($("#wizard-bowden-len").val()),n=$("#wizard-is-pmmu").prop("checked"),a=$("#wizard-is-duet").prop("checked"),i=$("#wizard-has-shared-stepper").prop("checked"),s=$("#wizard-has-cutter").prop("checked"),r=$("#wizard-has-tmc2209").prop("checked"),l=$("#wizard-selector-res09").prop("checked"),c=$("#wizard-feeder-res09").prop("checked"),d=$("#wizard-dde-res09").prop("checked");setWizardOption("#Device",e),setWizardOption("#Tools",t),setWizardOption("#BowdenLen",o),setWizardBoolOption("#EmulPrusa",n),setWizardBoolOption("#Feeder-SharedStepper",i),setWizardBoolOption("#UseDuet",a),setWizardBoolOption("#UseCutter",s),r&&(setWizardListOption("#Selector-TMC-Mode",1),setWizardListOption("#Feeder-TMC-Mode",1),hasDDE&&setWizardListOption("#Revolver-TMC-Mode",1)),setWizardOption("#Selector-StepsMM",l?160:80),setWizardOption("#Feeder-StepsMM",c?820:410),hasDDE&&setWizardOption("#Revolver-StepsMM",d?820:410),$("#btn-save-settings").trigger("click")}function setWizardBoolOption(e,t){$(e).prop("checked")!=t&&$(e).trigger("click")}function setWizardOption(e,t){$(e).val()!=t&&$(e).val(t).trigger("focusout")}function setWizardListOption(e,t){$(e).val()!=t&&$(e).val(t).trigger("change")}function showWizard(){initWizard(),$("#wizard-modal").modal("show")}function hideWizard(){setTimeout((function(){$("#wizard-modal").modal("hide")}),500)}function resetWizard(){localStorage.setItem("ShowWizard",yes)}function showInfo(e){$("#info-message").html(e),$("#info-progressbar").css("width","0%").text("0%"),$("#info-modal").modal("show")}function cancelInfo(){$("#info-progressbar").css("width","100%").text("100%"),setTimeout((function(){$("#info-modal").modal("hide")}),500)}function showError(e){$("#serious-error-message").html(e),$("#serious-error-modal").modal("show")}function cancelError(){setTimeout((function(){$("#serious-error-modal").modal("hide")}),500)}function showSDWarning(){$("#sd-warning").modal("show")}function cancelSDWarning(){setTimeout((function(){$("#sd-warning").modal("hide")}),500)}function showChangesPending(e){e?$("#changes-pending").show():$("#changes-pending").hide(),changesPending=e}function replaceId(e){return e=(e=(e=(e=(e=e.replace("Selector-","")).replace("Feeder-","")).replace("Revolver-","")).replace("TMC-","")).replace("Output-","")}function normalizeId(e){var t=-1;return e.startsWith("Material-")&&(t=e.substring(9),e=e.substring(0,8)),e.startsWith("Color-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("PFactor-")&&(t=e.substring(8),e=e.substring(0,7)),e.startsWith("CValue-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Close-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("Output-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Mode-")&&(t=e.substring(5),e=e.substring(0,4)),e.startsWith("RevolverClose-")&&(t="T"+e.substring(14),e=e.substring(0,13)),e.startsWith("baudrate-")&&(t=e.substring(9),e=t),[e,t]}function buildM205Command(e){var t,o=e.prop("id");if("M"==o&&"C"==o&&"CV"==o&&"PF"==o&&"O"==o&&"P"==o)return"";var n=e.prop("localName"),a=e.prop("type"),i=(e.attr("data-section"),e.attr("data-subsection"));if(""==o&&console.log(">>> No ID <<< for prop: "+n+" of type: "+a),"input"!=n&&"select"!=n||(t="text"==a?'"'+e.val()+'"':"color"==a?'"'+e.val().substring(1)+'"':"checkbox"==a?e.is(":checked")?1:0:isNaN(e.val())?null:e.val()),null!=t){const e=normalizeId(o=replaceId(o));o.startsWith("baudrate-")?(o="Baudrates",t='"'+t+'"'):o=e[0],idx=e[1];var s="",r="";if(void 0!==i){switch(i){case"Selector":s="X",r="I"+idx;break;case"Revolver":s="Y",r="I"+idx;break;case"Feeder":s="Z",r="I"+idx;break;case"User1":case"User2":r="M",o=i}i.startsWith("T")&&(r="I"+i.substring(1))}return'M205P"'+o+'" S'+t+" "+s+r}return console.log("Skipping null value..."),""}function checkForChange(e){if(!initDone)return;var t=!1,o=replaceId(e.attr("id"));const n=normalizeId(o);if(o=n[0],idx=n[1],!o.startsWith("Dlvl-")){var a,i,s=e.attr("data-section"),r=e.attr("data-subsection"),l="checkbox"==e.prop("type"),c=JSON.parse(localStorage.getItem("M503"+s)),d="";if(void 0!==r?d=c[r][o]:void 0===(d=c[o])&&(d=c[idx],t=!0),void 0!==d){if(l?(e.tooltip("hide"),1==e.prop("checked")?"boolean"==typeof d?(a=!0,i=yes):"string"==typeof d?a=i=output:(a=1,i=high):"boolean"==typeof d?(a=!1,i=no):"string"==typeof d?a=i=pwm:(a=0,i=low),e.attr("data-bs-original-title",i),e.attr("aria-label",i)):a=e.val(),d!=a)try{return void 0!==r?c[r][o]=a:t?c[idx]=a:c[o]=a,localStorage.setItem("M503"+s,JSON.stringify(c)),!0}catch(e){console.log(e)}}else showToast(valUndefined+o+subSection+r+subSectionEnd),console.log("val undefined?!");return!1}}async function saveConfig(){sendGcode("M500"),getResponse()&&($("#restart-modal").modal("show"),showChangesPending(!1))}function removeValFeedback(){$("#accordion-settings input, #accordion-settings select").each((function(){$(this).removeClass("val-changed"),$(this).removeClass("val-failed")}))}function setGcodeHistory(){if(-1!=historyIndex){var e=$($("#historyitemscontainer").children())[historyIndex],t=$(e).find("span").text();$("#gcode").val(t),setTimeout((function(){$("#gcode").focus()}),100)}}function setLidIcon(e){var t=$("#card-lid").find("i");t.data("state",e),t.removeClass("fa-unlock fa-lock icon-unchecked icon-checked"),t.addClass("0"==e?"fa-unlock icon-unchecked":"fa-lock icon-checked"),setServoHorn(e)}function getCurrentTool(){var e=$("#tool-selection").val();return"-1"==e?-1:null!=e?parseInt(e.substring(1)):-1}function setServoHorn(e){var t=parseInt($("#Revolver-ServoOpen").val()),o=parseInt($("#Revolver-ServoClose").val()),n=getCurrentTool();-1!=n&&(o=parseInt($("#Close-"+n).val()));var a=e?90-o:90-t;if(!isNaN(a))if($("#lvc-horn").css({transform:"rotate("+a+"deg)"}),"#sec-live-control"==$(".nav-item.activeSection").data("section")){var i=e?o:t;$("#lvc-horn-image").attr("data-bs-original-title",i+" deg").tooltip("update")}else $("#sec-live-control .tooltip").each((function(){$(this).tooltip("hide")}))}async function recalculateSpeeds(){if(initDone){for(var e=[["Selector-MaxSpeed","X"],["Selector-AccelSpeed","X"],["Revolver-MaxSpeed","Y"],["Revolver-AccelSpeed","Y"],["Feeder-MaxSpeed","Z"],["Feeder-AccelSpeed","Z"],["Feeder-InsSpeed","Z"],["Feeder-PurgeSpeed","Z"]],t=0;t<e.length;t++){var o=$("#"+e[t][0]).val();if(""!=o)sendGcode('M205P"XlateSpeed"S'+o+e[t][1]),await getResponse()&&$("#"+e[t][0]).val(parseInt(xlatedSpeed));else console.log('Speed "'+e[t]+'" is not set!')}showToast(speedsTranslated)}}function setDisabled(e,t){var o=$(t+" input,"+t+" select"),n=$(t+" label,"+t+" span, "+t+" i, "+t+" div");e?(o.each((function(){$(this).attr("disabled","disabled"),$(this).css("opacity","0.5")})),n.each((function(){$(this).css("opacity","0.5")}))):(o.each((function(){$(this).removeAttr("disabled"),$(this).css("opacity","1")})),n.each((function(){$(this).css("opacity","1")})))}function setAutocompleteColors(e){new Autocomplete(e,{data:colorNames,maximumItems:5,treshold:1});$(e).on("focusout",(function(){$(this).parent().find()}))}function setAutocompleteMaterials(e){new Autocomplete(e,{data:materialNames,maximumItems:5,treshold:1})}async function sendUploadRequest(e,t){if(sendGcode('M997 P"/'+e+'" L'+t),!await getResponse())return showToast(uploadingFailed),!1;uploadCancelled=!1}async function sendUploadStart(){return sendGcode(String.fromCharCode(27,85),!1,!1),!!await getResponse()||(showToast(abortingUpload),!1)}async function sendBuffer(e){var t=e.length;$("#progress-upload .progress-bar").css("width","0%"),$("#progress-upload .progress-bar").text("0%");for(var o=0;o<t;o++){await sendChar(String.fromCharCode(e[o]));var n=parseFloat(o/t*100);if(o>0&&o%50==0&&await sleep(100),$("#progress-upload .progress-bar").css("width",n+"%"),$("#progress-upload .progress-bar").text(parseInt(n)+"%"),uploadCancelled)break;pauseTransmission&&await getResume()}$("#progress-upload .progress-bar").css("width","100%"),$("#progress-upload .progress-bar").text("100%"),$("#firmware-file").val(""),setTimeout((function(){$("#firmware-upload-modal").modal("hide")}),2e3)}var isStandalone=!1,initDone=!1,initStarted=!1,seenOk=!1,seenError=!1,seenParserError=!1,prevLine="",configType="",currentSerial=-1,xlatedSpeed=0,collectResponse=!1,responseBuffer="",isPurging=!1,isBooting=!1,pauseTransmission=!1;function sleep(e){return new Promise((t=>setTimeout(t,e)))}function getResponse(){return new Promise((e=>gotOk(e)))}function getResume(){return new Promise((e=>gotXon(e)))}async function gotOk(e){for(var t=1e4;!seenOk;)await sleep(10),(t-=10)<=0&&e(!1);collectResponse=!1,e(!seenError)}async function gotXon(e){for(var t=1e4;pauseTransmission;)await sleep(10),(t-=10)<=0&&e(!1);e(!0)}async function connectHandler(){isTestRunning?($(".nav-item.activeSection").removeClass("activeSection"),$('.nav-item[data-section="#sec-testrun"]').trigger("click")):await requestInit()?hideConnect():(isStandalone||await disconnectSerial(),showConnect())}async function sendGcode(e,t,o,n=!0){if(console.log("Gcode: "+e),seenOk=!1,seenError=!1,0!=e.length){e.trim().toUpperCase().startsWith("M20L")&&(responseBuffer="",collectResponse=!0),e.trim().toUpperCase().startsWith("G1")&&(e.toUpperCase().indexOf("X")>-1&&$("#selector-pwr-off").addClass("hidden"),e.toUpperCase().indexOf("Z")>-1&&$("#feeder-pwr-off").addClass("hidden")),e.trim().toUpperCase().startsWith("M500")&&showChangesPending(!1);var a=e;n&&(e+="\r\n"),await(isStandalone?writeSerial(e):writeWebSerial(e)),await sleep(5),t&&addSentGcode(a),o&&$("#gcode").focus()}}async function sendChar(e){await(isStandalone?writeSerial(e):writeWebSerial(e))}function sendCharSync(e){isStandalone?writeSerial(e):writeWebSerial(e)}function sendPFKey(e){var t=String.fromCharCode(27,91,79,e);console.log("Seq: "+t),addSentGcode("[PF"+String.fromCharCode(e-31,93)),sendGcode(t,!1,!0)}async function sendInitSeq(e){var t=3,o=!1;do{if(sendGcode(e,!1,!1),await getResponse()&&!seenParserError){o=!0;break}showInfo(connectionFailedRetry),await sleep(1e3),cancelInfo(),t--}while(t>0);return o}async function requestTMCInit(){if(curFWVersion>=3.11)await sendInitSeq("M122W99");else{await sendInitSeq("M17");for(var e=0;e<4&&await sendInitSeq("M122W"+e);e++);}initDone=!0}async function requestInit(){try{if(1==initStarted)return!1;initStarted=!0,initDone=!1,addSentGcode(wiInitStart),showInfo(fetchingSettings);var e=!0;if(isStandalone&&(await sendInitSeq("M155S0")||(e=!1)),await sendInitSeq("M115")||(e=!1),e){var t=[];t=curFWVersion>=3.11?['M205P"WebInterface"S1',"M111W1","M503SW0",'M20S"/test" F"" W',"M155S1"]:['M205P"WebInterface"S1',"M111W1","M503SW0","M503S6W","M503S7W","M503S8W",'M20S"/test" F"" W','M205P"SendStats"S1'];for(var o=0;o<t.length;o++){var n=parseInt(100/t.length*(o+1));if($("#info-progressbar").css("width",n+"%").text(n+"%"),isTestRunning||initDone)break;if(!await sendInitSeq(t[o])){e=!1;break}}addSentGcode(wiInitEnd)}else addSentGcode(wiInitFailed);return cancelInfo(),showChangesPending(!1),initStarted=!1,hasTmc?setTimeout((function(){requestTMCInit()}),100):initDone=!0,e}catch(e){console.log(e)}return!1}async function parseResponse(e){if(prevLine=e,seenParserError=!1,isBooting&&"start"!=e)return $("#info-message").html(bootingMsg+"<br/><p>"+e.substring(11)+"</p>"),void addReceivedGcode(e.replaceAll(" ","&nbsp;"));if(e.startsWith("ok")){if(seenOk=!0,(isShowingLoading||isShowingUnloading)&&((isShowingLoading&&!isPurging||isShowingUnloading)&&cancelInfo(),isShowingLoading=!1,isShowingUnloading=!1),!initDone)return}else if(e.startsWith("error:")||e.startsWith("echo: error"))seenError=!0,"BUSY"==e.substring(7)&&showToast(smuffBusy),console.log("Errors seen: "+seenError+" [ "+prevLine+" ]");else if("start"==e)isBooting=!1,cancelInfo(),initDone&&(setTimeout((function(){showInfo(fetchingSettings)}),1e3),requestInit());else if(e.indexOf("echo: ")>-1)if(e.indexOf(" dbg:")>-1)e.indexOf("setup start")>0&&(isBooting=!0,initDone=!0,showInfo(bootingMsg));else{if(e.indexOf(" Serial:")>-1)return currentSerial=parseInt(e.substring(e.indexOf(" Serial:")+9)),void $("#curSerial"+currentSerial).removeClass("hidden");if(e.indexOf(" states:")>-1)return void setStatus(e);if(e.indexOf(" testrun:")>-1)return setTestResults(e),void showTestRunning(!0);if(e.indexOf(" purging:")>-1)return void("done"==e.substring(e.indexOf(" purging:")+9)?(isPurging=!1,cancelInfo()):(isPurging=!0,showPurging(e.substring(e.indexOf(" purging:")+9))));if(e.indexOf(" speed:")>-1)return void(xlatedSpeed=e.substring(e.indexOf(" speed:")+7));if((e.indexOf(" INT")>-1||e.indexOf(" EXT")>-1)&&(setRelayState(e.substring(e.indexOf("echo: ")+6)),!initDone))return}else if(e.startsWith("FIRMWARE_NAME"))setFWInfo(e);else{if(e.startsWith("Unknown parameter 'WebInterface"))return initDone=!0,void showError("Apparently, this SMuFF-Firmware version is <b>less than 2.26</b>! Please update your firmware for this app.");if(e.startsWith("/*")){if(configType=e.replace("/*","").replace("*/","").trim(),!initDone)return void(configType.startsWith("Testscripts")&&(addTestFiles(configType.substring(12)),configType=""))}else if(e.startsWith('{"')){if(e.indexOf("TMCStatus")>-1&&(configType="TMC"),setSettings(e,configType),!initDone)return}else for(var t=["M17","M111","M122","M155","M205","M503"],o=0;o<t.length;o++)if(e.startsWith(t[o])){if(initDone)break;return}}addReceivedGcode(e.replaceAll(" ","&nbsp;"))}var websock=null,firstWebSockInit=!0,webSockOpenFailed=!1,collectWSData="";function openWebSock(){(websock=new WebSocket("ws://"+location.host+":8080/smuff-wi")).onopen=function(e){console.log("WebSocket connection is open..."),webSockOpenFailed=!1,setTimeout((function(){firstWebSockInit&&(firstWebSockInit=!1),connectHandler()}),50)},websock.onerror=function(e){console.log("WebSocket has reported an error: ",e),webSockOpenFailed=!0},websock.onclose=function(e){var t=connectionClosed;firstWebSockInit=!0,e.wasClean?console.log("WebSocket connection has been closed normally!"):(console.log("WebSocket connection has been killed!"),console.log("Code: "+e.code,"See: https://datatracker.ietf.org/doc/html/rfc6455#section-7.4.1"),t=connectionFailed),showConnectingMessage("fast",t,null)},websock.onmessage=function(e){(collectWSData+=e.data).endsWith("\n")&&(parseIncomingData(collectWSData.substring(0,collectWSData.length-1)),collectWSData="")}}async function sendWebSock(e){null!==websock&&"undefined"!==websock&&1==websock.readyState||openWebSock(),waitForSocketConnection(websock,(function(){0==websock.bufferedAmount?websock.send(e):(console.log("Waiting for WebSocket buffer to empty..."),waitForBufferEmpty(websock,(function(){websock.send(e)})))}))}function waitForBufferEmpty(e,t){setTimeout((function(){0!=e.bufferedAmount?waitForBufferEmpty(e,t):null!=t&&t()}),150)}function waitForSocketConnection(e,t){setTimeout((function(){1!==e.readyState?waitForSocketConnection(e,t):null!=t&&t()}),50)}async function animateWiper(){var e=0,t=0,o=100,n=$("#WipeSeq").val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const o of n)o[0].toUpperCase().startsWith("R")&&(e=parseInt(o[0].substring(1))),o[0].toUpperCase().startsWith("S")&&(t=parseInt(o[0].substring(1)));var a=7*t;$("#lvc-wiper-image-1").hide(),$("#lvc-wiper-image-2").show(),await sleep(o),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").show(),await sleep(o);for(var i=0;i<e;i++)$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").show(),await sleep(a),$("#lvc-wiper-image-4").hide(),$("#lvc-wiper-image-3").show(),await sleep(a);$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-2").show(),await sleep(o),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-1").show(),await sleep(o)}async function animateCutter(e){for(var t=0;t<3;t++)$("#lvc-cutter-image-1").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").show(),await sleep(0==t?750:375),t<2&&($("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100));e&&animateCutterEnd()}async function animateCutterEnd(){$("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100)}function setFeederLed(e){$("#UseSplitter").is(":checked")?$("#lvc-feeder-led").css("opacity",0):$("#lvc-feeder-led").css("opacity",e?1:0)}function setSelectorLed(e){$("#lvc-selector-led").css("opacity",e?0:1)}function getRodPosition(e){var t=$("#Tools").val()-1,o=parseInt($("#Selector-Spacing").val()*t),n=parseInt(e-$("#lvc-rod").offset().left),a=$("#lvc-rod").width();return parseInt((a-n)*(o/a))}function positionCarrier(e){var t=$("#Tools").val(),o=parseInt($("#Selector-Spacing").val())*t;e*=$("#lvc-rod").width()/o,$("#lvc-carrier").css("right",90+e+"px")}function setSplitterOption(){$("#UseSplitter").is(":checked")?($("#lvc-bottom").addClass("hidden"),$("#lvc-feed").addClass("hidden"),$("#lvc-bottom-splitter").removeClass("hidden"),$('[id^="lvc-fitting-"]').each((function(){$(this).removeClass("hidden")})),$('[id^="lvc-in-splitter-"]').each((function(){$(this).removeClass("hidden")})),$("#btn-load-to-splitter").removeClass("disabled"),$("#btn-unload-from-splitter").removeClass("disabled")):($("#lvc-bottom").removeClass("hidden"),$("#lvc-feed").removeClass("hidden"),$("#lvc-bottom-splitter").addClass("hidden"),$('[id^="lvc-fitting-"]').each((function(){$(this).addClass("hidden")})),$('[id^="lvc-in-splitter-"]').each((function(){$(this).addClass("hidden")})),$("#btn-load-to-splitter").addClass("disabled"),$("#btn-unload-from-splitter").addClass("disabled"))}function loadUnloadSplitter(e){var t=getCurrentTool();-1!=t?e==t?1==feedLoadState[t]?$("#btn-unload-from-splitter").trigger("click"):$("#btn-load-to-splitter").trigger("click"):showToast(toolNotSelected):showToast(noToolSelected)}function loadUnload(e){var t;-1!=(t=getCurrentTool())?e==t?$("#UseSplitter").is(":checked")?2==feedLoadState[e]?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):isFeederLoaded?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):showToast(toolNotSelected):showToast(noToolSelected)}async function parseIncomingData(e){await parseResponse(e)}async function writeSerial(e){await sendWebSock(e)}$(document).ready((function(){$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").hide(),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").hide(),$("#lvc-horn-image").tooltip({delay:{show:100,hide:100},trigger:"hover"}),$("#lvc-horn, #lvc-horn-image").on("click",(function(){-1!=getCurrentTool()?$("#card-lid").trigger("click"):showToast(noToolSelected)})),$("#lvc-rod").tooltip({delay:{show:100,hide:100},trigger:"manual"}),$("#lvc-rod").on("mousemove",(function(e){var t=getRodPosition(e.pageX);$("#lvc-rod").attr("data-bs-original-title",moveSelectorTo+t+millimeter).tooltip("update").tooltip("show")})),$("#lvc-rod").on("click",(async function(e){moveCarrierG1=!0,$("#selector-pwr-off").addClass("hidden");var t=getRodPosition(e.pageX);positionCarrier(t),sendGcode("G90",!1,!1),await getResponse(),sendGcode("G1X"+t,!1,!1),await getResponse(),sendGcode("G91",!1,!1),await getResponse()})),$("#lvc-home").on("click",(function(e){moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val(-1).trigger("change")})),$("#lvc-selector").on("click",(function(e){sendGcode("M18X",!1,!1),$("#selector-pwr-off").removeClass("hidden")})),$("#lvc-feeder").on("click",(function(e){sendGcode("M18Z",!1,!1),$("#feeder-pwr-off").removeClass("hidden")})),$("#lvc-feed").on("click",(function(e){loadUnload(getCurrentTool())})),$("#lvc-cutter").on("click",(function(e){sendGcode("G12C"),animateCutter(!0)})),$("#lvc-wiper").on("click",(function(e){sendGcode("G12"),animateWiper()})),$("#lvc-reset").on("click",(function(e){$("#btn-reset").trigger("click")})),$("#lvc-tensioner").on("click",(function(e){showInfo(notExpected),setTimeout((function(){cancelInfo()}),4e3)})),$(".lvc-fitting").on("click",(function(){var e=parseInt($(this).prop("id").substring(12));isNaN(e)||(feedLoadState[e]>=1?loadUnload(e):loadUnloadSplitter(e))})),$(".lvc-in-splitter").on("click",(function(){var e=parseInt($(this).prop("id").substring(16));isNaN(e)||(2==feedLoadState[e]?loadUnload(e):loadUnloadSplitter(e))}))}));const noToolSelected="No tool selected!",toolNotSelected="Tool not active! Please select this tool first for moving the Selector over that tool.",moveSelectorTo="Move Selector to ",millimeter=" mm",notExpected='You didn\'t really think that would work, did you?<br/><br/><img src="assets/img/Smiley.png" alt=":o)">',historySavedLocally="History has been saved locally.",noWebSerial="Your browser doesn't support Web Serial! Please use the latest version of either <i>Google Chrome</i> or <i>Microsoft Edge</i> browser&hellip;<br/><br/><small><b>Please notice:</b> This app will not work on a mobile phone or tablet since the Web Serial API isn't implemented in the browsers of those devices!</small>",savingSettings="Saving Settings&hellip;",reloadingSettings="Reloading Settings&hellip;",toolSwapsSaved="Tool-Swaps have been saved.",copiedToClipboard="Console output copied to Clipboard.",fileNotFound="File Not Found!",fileNotReadable="File is not readable!",fileReadError="An error occurred reading this file.",uploadAborted="Firmware upload aborted!",saveSettingFailed="Setting this value on the SMuFF has failed!<br/><br/>Please check console output for detailed information.",tmcVersionMismatch="Version mismatch on TMC driver!<br/>Please check your hardware setup!",failedReadSettings="Failed to read settings from SMuFF. Please check your setup!",failedReadingTestFiles='Can\'t read test-files from SMuFF. Please check the "test" folder on your SD-Card!',valUndefined="WTF? val undefined?! id: <b>",subSection="</b> subsection: <b>",subSectionEnd="</b>",speedsTranslated="Speeds have been translated! Please check whether they were calculated correctly.",uploadingFailed="Uploading firmware failed! See console for details.",abortingUpload="SMuFF not responding. Aborting upload!",smuffBusy="SMuFF is BUSY",connectingSMuFF="Connecting with SMuFF, please pick a serial port&hellip;",connectingDevice="Connecting with device, please wait&hellip;",connectionFailedRetry="Connection failed, retrying&hellip;",connectionFailed="Connection failed",connectionClosed="Connection has been closed from server",serialConnectionFail="Serial connection failed!",clickToConnect="Click here to connect&hellip;",disconnected="Disconnected&hellip;",openingPort="Opening serial port&hellip;",serialPortOpen="Serial port sucessfully opened",fetchingSettings="Fetching settings from SMuFF, please wait&hellip;",wiInitStart="<<< WebInterface Init Start >>>",wiInitEnd="<<< WebInterface Init End >>>",wiInitFailed="<<< WebInterface Init Failed >>>",plzWait="<br/>Please wait&hellip;",loadingFilament="<h2>Loading Filament for ",loadingFilamentSpl=" to Splitter</h2>",unloadingFilamentSpl=" from Splitter</h2>",unloadingFilament="<h2>Unloading Filament for ",closeH2="</h2>",purging1="<h2>Purging Tool ",purging2="</h2>Amount: ",purging3=" mm or ",purging4=" mm<br/>",fwWarning="This SMuFF-Firmware version is outdated for this app! Install at least version 2.26",ttpUnloadFromDDE="Unload from DDE",ttpUnloadFromSelector="Unload from Selector",ttpUnloadFromNozzle="Unload from Nozzle",ttpLoadToNozzle="Load to Nozzle",ttpLoadToSplitter="Load to Splitter",ttpLoadToDDE="Load to DDE",lidOnly="Lid",lidDDE="Lid / DDE",lidV6S="Lid / Revolver",lidV4="Revolver",noName="NO-NAME",servoMaps="Servo Angle Mappings",stepperMaps="Lid Stepper Mappings",stepperClosedAt="Closed @ mm",reqStepsMM="You have changed the micro stepping for <b>{ITEM}</b>.<br/><br/>Do you want me to correct the <i>Steps per Millimeter</i> setting to <b>{VAL}</b>?",pfButton="Button ",yes="Yes",no="No",never="Never",high="HIGH",low="LOW",pwm="PWM",output="OUTPUT",bootingMsg="<h2>SMuFF is booting&hellip;</h2>",noWiVersion="ATTENTION: Unable to check for latest WebInterface version! Your current version might be outdated!";function getToolCount(){return""==$("#Tools").val()?-1:parseInt($("#Tools").val())}function setupMaterials(){var e=getToolCount();if(-1!=e){var t=$("#form-materials");t.empty(),t.append('<datalist id="datalistColors"></datalist>'),t.append('<datalist id="datalistMaterials"></datalist>');var o=t.find('datalist[id="datalistColors"]');for(key in Object.keys(colorNames)){var n='<option value="'+colorNames[key].label+'"/>';o.append(n)}for(key in o=t.find('datalist[id="datalistMaterials"]'),Object.keys(materialNames)){n='<option value="'+materialNames[key].label+'"/>';o.append(n)}for(var a=$("#materials-template"),i=0;i<e;i++){var s=a.clone(!0);s.prop("id","materials-tool-"+i),s.removeClass("hidden"),s.find("label").text("T"+i+":"),s.find("input").each((function(){$(this).prop("id",$(this).prop("name")+i),$(this).attr("data-section","S5"),$(this).attr("data-subsection","T"+i)})),t.append(s)}}}function setupServoMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();for(var o=$("#servomap-template"),n=0;n<e;n++){var a=o.clone(!0);a.prop("id","servomap-"+n),a.removeClass("hidden"),a.find("label").text("T"+n+":"),a.find("input").each((function(){$(this).prop("id",$(this).prop("name")+n),$(this).attr("data-section","S4"),$(this).attr("data-subsection","T"+n)})),t.append(a)}}}function setupStepperMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();var o=$("#servomap-template");$("#caption-closeat").text("Closed @ mm");for(var n=0;n<e;n++){var a=o.clone(!0);a.prop("id","steppermap-"+n),a.removeClass("hidden"),a.find("label").text("T"+n+":"),a.find("input").each((function(){$(this).prop("id","Revolver"+$(this).prop("name")+n),$(this).attr("data-section","S7"),$(this).removeAttr("data-subsection"),$(this).attr("max","10"),$(this).attr("step","0.1"),void 0!==stepperMappings[n]&&$(this).val(stepperMappings[n].toFixed(1))})),t.append(a)}}}function setupLiveControl(){var e=getToolCount();if(-1!=e){var t=$("#lvc-slot-container");t.empty();var o=$("#lvc-slot-template"),n=0,a=new Array,i=new Array;$(o).find('span[id="lvc-in-splitter"] >i').each((function(){a[n]=$(this).attr("data-bs-original-title"),i[n++]=$(this).attr("data-bs-placement")}));for(var s=e-2;s>0;s--){var r=o.clone(!0);r.prop("id","lvc-t-"+s),r.removeClass("hidden");var l=r.find('span[id="lvc-tool"]');l.prop("id","lvc-tool-"+s).data("tool",s),l.attr("data-bs-original-title","T"+s).tooltip("update"),(l=r.find('span[id="lvc-led"]')).prop("id","lvc-led-"+s),(l=r.find('img[id="lvc-fitting"]')).prop("id","lvc-fitting-"+s),l.attr("data-bs-original-title","Load/Unload").tooltip("update"),(l=r.find('span[id="lvc-in-splitter"]')).prop("id","lvc-in-splitter-"+s),n=0,l.find("i").each((function(){$(this).attr("data-bs-original-title",a[n]),$(this).attr("data-bs-placement",i[n++]).tooltip("update")})),t.append(r)}o.removeClass("d-flex").addClass("hidden");var c=e-1;$("#lvc-tool-Max").prop("id","lvc-tool-"+c).data("tool",c.toString()).attr("data-bs-original-title","T"+c).tooltip("update"),$("#lvc-led-Max").prop("id","lvc-led-"+c),$("#lvc-fitting-Max").prop("id","lvc-fitting-"+c),$("#lvc-in-splitter-Max").prop("id","lvc-in-splitter-"+c),$("#lvc-rod").width(e*$("#lvc-slot-template").width()),$('span[id^="lvc-tool-"]').unbind("click");$('span[id^="lvc-tool-"]').on("click",(function(){var e=$(this).prop("id").substring(9);moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val("T"+e).trigger("change")}))}}function setupSwaps(){var e=getToolCount();if(-1!=e){var t=$("#swap-tools-container #slots ul"),o=$("#swap-tools-container #tools ul");t.empty(),o.empty();for(var n=0;n<e;n++){var a=$("#slot-item-template").clone(!0);a.append("<span>Slot "+n+":</span>"),a.append('<span class="slot-tool-color">'+(""!=toolColors[n]?"(":"")+toolColors[n]+(""!=toolColors[n]?")":"")+"</span>"),a.attr("id","slot"+n),t.append(a);var i=$("#swap-item-template").clone(!0);i.text(i.text()+(void 0===swapTools[n]?n:swapTools[n])),i.attr("id","swap-tool"+n),i.attr("data-id","st-"+swapTools[n]),i.css("cursor","grab"),i.append('<i class="fa fa-reorder"></i>'),o.append(i)}}}var port,textEncoder,writableStream,writer,readableStream,reader,current_fs,next_fs,previous_fs,left,opacity,scale,animating;async function connectSerial(e=115200){try{port=await navigator.serial.requestPort(),showInfo(openingPort),await port.open({baudRate:e,bufferSize:64}).then((function(){$("#info-message").html(serialPortOpen),textEncoder=new TextEncoderStream,writableStream=textEncoder.readable.pipeTo(port.writable),writer=textEncoder.writable.getWriter(),listenToSerial(),connectHandler()}))}catch{cancelInfo(),showConnectingMessage("fast",serialConnectionFail,null)}}async function disconnectSerial(){try{reader&&(await reader.cancel(),await readableStream.catch((()=>{})),reader=null,readableStream=null),writer&&(await writer.close(),await writableStream,writer=null,writableStream=null),port&&(await port.close(),port=null)}catch(e){console.log(e)}}async function listenToSerial(){const e=new TextDecoderStream;readableStream=port.readable.pipeTo(e.writable),reader=e.readable.getReader(),portListener=!0;try{for(var t="";;){const{value:e,done:a}=await reader.read();if(e)-1!=e.indexOf("")&&(pauseTransmission=!0,console.log("XOff"),t+=e.replaceAll("","")),-1!=e.indexOf("")?(pauseTransmission=!1,console.log("XOn"),t+=e.replaceAll("","")):t+=e;for(;t.length;){var o=t.indexOf("\n");if(-1==o)break;var n=t.substring(0,o);await parseResponse(n),collectResponse&&"ok"!=n&&(responseBuffer+=n+"\n"),t=t.substring(o+1)}if(a){reader.releaseLock();break}}}catch(e){console.log(e),disconnectSerial()}portListener=!1,showConnect()}async function writeWebSerial(e){await writer.write(e)}function resetWizard(){$("#msform fieldset").each((function(){$(this).css("opacity",0),$(this).css("transform","scale(1)"),$(this).css("display","none")})),previous_fs=null,next_fs=null,$("#progressbar li").removeClass("active"),(current_fs=$("#fs-welcome")).css("opacity",1),current_fs.css("transform","scale(1)"),current_fs.css("display","block"),$("#progressbar li").eq($("fieldset").index(current_fs)).addClass("active")}$(document).ready((function(){$("#Tools").on("change",(function(){var e=getToolCount(),t=$("#tool-selection");t.empty(),t.append('<option value="-1">T--</option>');for(var o=0;o<e;o++)t.append('<option value="T'+o+'">T'+o+"</option>");for(o=MAX_TOOLS-1;o>=e;o--)$("#tst-t"+o).parent().hide();setupMaterials(),hasV6S||setupServoMappings(),setupLiveControl(),setupSwaps(),hasV6S&&setupStepperMappings()})),$("#SpdsInMms").on("click",(function(){setTimeout((function(){recalculateSpeeds()}),750)})),$("#Feeder-SharedStepper").on("change",(function(){setDisabled(!(hasSharedStepper=$(this).is(":checked")),".hasSharedStepper")})),$("#Feeder-UseEStop2").on("change",(function(){setDisabled(!$(this).is(":checked"),".has2ndEndstop")})),$("#Feeder-ExtCtrl").on("change",(function(){hasExtCtrl=$(this).is(":checked"),hasDDE||hasSharedStepper||setDisabled(hasExtCtrl,".hasNotExtCtrl")})),$("#UseCutter").on("change",(function(){setDisabled(!$(this).is(":checked"),".hasCutter")})),$("#Revolver-UseServo").on("change",(function(){hasV6S&&$(this).removeAttr("checked"),setDisabled(!$(this).is(":checked"),".hasServo"),hasV6S||setDisabled(!$(this).is(":checked"),".hasServoOpt")})),$("#InvRelay").on("change",(function(){initDone&&setTimeout((async function(){sendGcode("M17",!0,!1),await getResponse()}),500)})),$("#Selector-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Selector-TMC-Params").show("slow"),$("#Selector-MS3").val(0).trigger("change")):$("#Selector-TMC-Params").hide("slow")})),$("#Feeder-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Feeder-TMC-Params").show("slow"),$("#Feeder-MS3").val(0).trigger("change")):$("#Feeder-TMC-Params").hide("slow")})),$("#Revolver-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Revolver-TMC-Params").show("slow"),$("#Revolver-MS3").val(0).trigger("change"),hasDDE||$("#Revolver-UseServo").prop("checked",!1).trigger("change")):$("#Revolver-TMC-Params").hide("slow")})),$("#Selector-MS3").on("change",(function(){$(this).val()>0&&$("#Selector-TMC-Mode").val(0).trigger("change")})),$("#Feeder-MS3").on("change",(function(){$(this).val()>0&&$("#Feeder-TMC-Mode").val(0).trigger("change")})),$("#Revolver-MS3").on("change",(function(){$(this).val()>0&&$("#Revolver-TMC-Mode").val(0).trigger("change")}))})),$(".next").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),next_fs=$(this).parent().next(),$("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active"),next_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=1-.2*(1-e),left=50*e+"%",opacity=1-e,current_fs.css({transform:"scale("+scale+")"}),next_fs.css({left:left,opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})})),$(".previous").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),previous_fs=$(this).parent().prev(),$("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active"),previous_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=.8+.2*(1-e),left=50*(1-e)+"%",opacity=1-e,current_fs.css({left:left}),previous_fs.css({transform:"scale("+scale+")",opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})})),$(".cancel").click((function(){hideWizard(),resetWizard(),$("#wizard-disable").is(":checked")&&(localStorage.setItem("ShowWizard",never),localStorage.setItem("LastWizardDevice",$("#devname-label").text()))})),$(".submit").click((function(){return hideWizard(),localStorage.setItem("ShowWizard",no),localStorage.setItem("LastWizardDevice",$("#wizard-device").val()),storeWizard(),resetWizard(),!1})),$("input:checkbox[name^=wizard-]").change((function(){var e=$(this).is(":checked")?yes:no;$(this).parent().parent().next().text(e),"wizard-is-marlin"==$(this).prop("name")&&e==yes&&($("#wizard-is-duet").prop("checked",""),$("#wizard-is-pmmu").prop("checked",""),$("#wizard-is-duet").parent().parent().next().text(no),$("#wizard-is-pmmu").parent().parent().next().text(no)),"wizard-is-pmmu"==$(this).prop("name")&&e==yes&&($("#wizard-is-duet").prop("checked",""),$("#wizard-is-marlin").prop("checked",""),$("#wizard-is-duet").parent().parent().next().text(no),$("#wizard-is-marlin").parent().parent().next().text(no)),"wizard-is-duet"==$(this).prop("name")&&e==yes&&($("#wizard-is-pmmu").prop("checked",""),$("#wizard-is-marlin").prop("checked",""),$("#wizard-is-marlin").parent().parent().next().text(no),$("#wizard-is-pmmu").parent().parent().next().text(no)),$("#wizard-is-pmmu").is(":checked")||$("#wizard-is-marlin").is(":checked")||$("#wizard-is-duet").is(":checked")||($("#wizard-is-marlin").prop("checked","checked"),$("#wizard-is-marlin").parent().parent().next().text(yes))}));